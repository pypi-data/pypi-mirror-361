export const __webpack_ids__=["87402"];export const __webpack_modules__={45955:function(t,s,e){e.r(s),e.d(s,{HaNumberSelector:()=>h});var i=e(73742),a=e(59048),o=e(26292),n=e(31733),l=e(39884);e(22534),e(40581),e(37492);class h extends a.oi{willUpdate(t){t.has("value")&&(""!==this._valueStr&&this.value===Number(this._valueStr)||(this._valueStr=null==this.value||isNaN(this.value)?"":this.value.toString()))}render(){const t="box"===this.selector.number?.mode||void 0===this.selector.number?.min||void 0===this.selector.number?.max;let s;if(!t&&(s=this.selector.number.step??1,"any"===s)){s=1;const t=(this.selector.number.max-this.selector.number.min)/100;for(;s>t;)s/=10}return a.dy` ${this.label&&!t?a.dy`${this.label}${this.required?"*":""}`:a.Ld} <div class="input"> ${t?a.Ld:a.dy` <ha-slider labeled .min="${this.selector.number.min}" .max="${this.selector.number.max}" .value="${this.value??""}" .step="${s}" .disabled="${this.disabled}" .required="${this.required}" @change="${this._handleSliderChange}" .ticks="${this.selector.number?.slider_ticks}"> </ha-slider> `} <ha-textfield .inputMode="${"any"===this.selector.number?.step||(this.selector.number?.step??1)%1!=0?"decimal":"numeric"}" .label="${t?this.label:void 0}" .placeholder="${this.placeholder}" class="${(0,n.$)({single:t})}" .min="${this.selector.number?.min}" .max="${this.selector.number?.max}" .value="${this._valueStr??""}" .step="${this.selector.number?.step??1}" helperPersistent .helper="${t?this.helper:void 0}" .disabled="${this.disabled}" .required="${this.required}" .suffix="${this.selector.number?.unit_of_measurement}" type="number" autoValidate ?no-spinner="${!t}" @input="${this._handleInputChange}"> </ha-textfield> </div> ${!t&&this.helper?a.dy`<ha-input-helper-text .disabled="${this.disabled}">${this.helper}</ha-input-helper-text>`:a.Ld} `}_handleInputChange(t){t.stopPropagation(),this._valueStr=t.target.value;const s=""===t.target.value||isNaN(t.target.value)?void 0:Number(t.target.value);this.value!==s&&(0,l.B)(this,"value-changed",{value:s})}_handleSliderChange(t){t.stopPropagation();const s=Number(t.target.value);this.value!==s&&(0,l.B)(this,"value-changed",{value:s})}constructor(...t){super(...t),this.required=!0,this.disabled=!1,this._valueStr=""}}h.styles=a.iv`.input{display:flex;justify-content:space-between;align-items:center;direction:ltr}ha-slider{flex:1;margin-right:16px;margin-inline-end:16px;margin-inline-start:0}ha-textfield{--ha-textfield-input-width:40px}.single{--ha-textfield-input-width:unset;flex:1}`,(0,i.__decorate)([(0,o.Cb)({attribute:!1})],h.prototype,"hass",void 0),(0,i.__decorate)([(0,o.Cb)({attribute:!1})],h.prototype,"selector",void 0),(0,i.__decorate)([(0,o.Cb)({type:Number})],h.prototype,"value",void 0),(0,i.__decorate)([(0,o.Cb)({type:Number})],h.prototype,"placeholder",void 0),(0,i.__decorate)([(0,o.Cb)()],h.prototype,"label",void 0),(0,i.__decorate)([(0,o.Cb)()],h.prototype,"helper",void 0),(0,i.__decorate)([(0,o.Cb)({type:Boolean})],h.prototype,"required",void 0),(0,i.__decorate)([(0,o.Cb)({type:Boolean})],h.prototype,"disabled",void 0),h=(0,i.__decorate)([(0,o.Mo)("ha-selector-number")],h)},94496:function(t,s,e){e.a(t,async function(t,i){try{e.r(s),e.d(s,{DialogStatisticsFixUnsupportedUnitMetadata:()=>g});e(2394),e(81738),e(22960);var a=e(73742),o=(e(98334),e(19064)),n=e(59048),l=e(26292),h=e(28105),r=e(74266),c=e(39884),d=e(6514),u=(e(83378),e(87979),e(5786),e(69760),e(466)),m=(e(45955),e(993),e(7214)),_=e(72242),p=e(95814),b=e(35982),v=t([d,u,r]);[d,u,r]=v.then?(await v)():v;class g extends n.oi{showDialog(t){this._params=t;const s=new Date;s.setMinutes(s.getMinutes()-s.getMinutes()%5,0),this._moment=(0,o.X)(s),this._fetchStats()}closeDialog(){this._params=void 0,this._moment=void 0,this._stats5min=void 0,this._statsHour=void 0,this._origAmount=void 0,this._amount=void 0,this._chosenStat=void 0,this._busy=!1,(0,c.B)(this,"dialog-closed",{dialog:this.localName})}render(){if(!this._params)return n.Ld;let t;return t=this._chosenStat?this._renderAdjustStat():this._renderPickStatistic(),n.dy` <ha-dialog open scrimClickAction escapeKeyAction @closed="${this.closeDialog}" .heading="${this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.title")}"> ${t} </ha-dialog> `}shouldUpdate(t){if(1!==t.size||!t.has("hass"))return!0;const s=t.get("hass");return!s||s.localize!==this.hass.localize}_renderPickStatistic(){let t;if(this._stats5min&&this._statsHour)if(this._statsHour.length<1&&this._stats5min.length<1)t=n.dy`<p> ${this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.no_statistics_found")} </p>`;else{const s=this._stats5min.length>=1?this._stats5min:this._statsHour,e=(0,m.dO)(this.hass,this._params.statistic.statistic_id,this._params.statistic),i=[];for(const t of s){const s=Math.round(100*t.change)/100;i.push(n.dy` <ha-list-item twoline hasMeta .stat="${t}" @click="${this._setChosenStatistic}"> <span>${s} ${e}</span> <span slot="secondary"> ${(0,r.o0)(new Date(t.start),this.hass.locale,this.hass.config)} </span> <ha-icon-next slot="meta"></ha-icon-next> </ha-list-item> `)}t=n.dy`${i}`}else t=n.dy`<ha-spinner></ha-spinner>`;return n.dy` <div class="text-content"> ${this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.info_text_1")} </div> <div class="text-content"> <b>${this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.statistic")}</b> ${this._params.statistic.statistic_id} </div> <ha-selector-datetime .label="${this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.pick_a_time")}" .hass="${this.hass}" .selector="${this._dateTimeSelector}" .value="${this._moment}" @value-changed="${this._dateTimeSelectorChanged}"></ha-selector-datetime> <div class="stat-list">${t}</div> <mwc-button slot="secondaryAction" .label="${this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.outliers")}" @click="${this._fetchOutliers}"></mwc-button> <mwc-button slot="primaryAction" dialogAction="cancel" .label="${this.hass.localize("ui.common.close")}"></mwc-button> `}_clearChosenStatistic(){this._chosenStat=void 0}_setChosenStatistic(t){const s=t.currentTarget.stat,e=Math.round(100*s.change)/100;this._chosenStat=s,this._origAmount=e,this._amount=e}_dateTimeSelectorChanged(t){this._moment=t.detail.value,this._fetchStats()}_renderAdjustStat(){const t=(0,m.dO)(this.hass,this._params.statistic.statistic_id,this._params.statistic);return n.dy` <div class="text-content"> <b>${this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.statistic")}</b> ${this._params.statistic.statistic_id} </div> <div class="table-row"> <span>${this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.start")}</span> <span>${(0,r.o0)(new Date(this._chosenStat.start),this.hass.locale,this.hass.config)}</span> </div> <div class="table-row"> <span>${this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.end")}</span> <span>${(0,r.o0)(new Date(this._chosenStat.end),this.hass.locale,this.hass.config)}</span> </div> <ha-selector-number .label="${this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.new_value")}" .hass="${this.hass}" .selector="${this._amountSelector(t||void 0)}" .value="${this._amount}" .disabled="${this._busy}" @value-changed="${this._amountChanged}"></ha-selector-number> <mwc-button slot="primaryAction" .label="${this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.adjust")}" .disabled="${this._busy}" @click="${this._fixIssue}"></mwc-button> <mwc-button slot="secondaryAction" .label="${this.hass.localize("ui.common.back")}" .disabled="${this._busy}" @click="${this._clearChosenStatistic}"></mwc-button> `}_amountChanged(t){this._amount=t.detail.value}async _fetchStats(){this._stats5min=void 0,this._statsHour=void 0;const t=this._params.statistic.statistic_id,s=new Date(this._moment.replace(" ","T")),e=new Date(s.getTime());e.setTime(e.getTime()-72e5);const i=new Date(s.getTime());i.setTime(i.getTime()+108e5);const a=await(0,m.dL)(this.hass,e,i,[t],"hour");if(this._statsHour=t in a?a[t].slice(0,5):[],0===this._statsHour.length)return void(this._stats5min=[]);const o=new Date(s.getTime());o.setTime(o.getTime()-6e5);const n=new Date(s.getTime());n.setTime(n.getTime()+9e5);const l=await(0,m.dL)(this.hass,o,n,[t],"5minute");this._stats5min=t in l?l[t].slice(0,5):[]}async _fetchOutliers(){this._stats5min=void 0,this._statsHour=void 0;const t=this._params.statistic.statistic_id,s=new Date(0),e=new Date,i=await(0,m.dL)(this.hass,s,e,[t],"hour"),a=t in i?i[t]:[];if(0===a.length)return;const o=await(0,m.dL)(this.hass,s,e,[t],"5minute"),n=t in o?o[t]:[];n.shift();const l=[];a.forEach(t=>{l.push({hour:t,fiveMin:[]})});const h={hour:null,fiveMin:[]};let r=0;n.forEach(t=>{let s=!1;for(;r<l.length;r++){const e=l[r].hour;if(e&&t.start>=e.start&&t.end<=e.end){l[r].fiveMin.push(t),s=!0;break}}s||h.fiveMin.push(t)}),l.push(h);let c=[],d=0;const u=t=>{const s=Math.abs(t.change??0);(c.length<10||s>d)&&(c.push(t),c=c.sort((t,s)=>Math.abs(s.change??0)-Math.abs(t.change??0)),c=c.slice(0,10),d=c[c.length-1].change??0)};l.forEach(t=>{0===t.fiveMin.length&&t.hour?u(t.hour):t.fiveMin.forEach(t=>{u(t)})}),this._statsHour=c,this._stats5min=[]}async _fixIssue(){const t=(0,m.dO)(this.hass,this._params.statistic.statistic_id,this._params.statistic);this._busy=!0;try{await(0,m.j2)(this.hass,this._params.statistic.statistic_id,this._chosenStat.start,this._amount-this._origAmount,t||null)}catch(t){return this._busy=!1,void(0,_.showAlertDialog)(this,{text:this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.error_sum_adjusted",{message:t.message||t})})}(0,b.C)(this,{message:this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.sum_adjusted")}),this.closeDialog()}static get styles(){return[p.Qx,p.yu,n.iv`@media all and (max-width:450px),all and (max-height:500px){ha-dialog{--mdc-dialog-max-height:100%;height:100%}}@media all and (min-width:850px){ha-dialog{--mdc-dialog-max-height:80%;--mdc-dialog-max-height:80%}}@media all and (min-width:451px) and (min-height:501px){ha-dialog{--mdc-dialog-max-width:480px}}.text-content,ha-selector-datetime,ha-selector-number{margin-bottom:20px}ha-list-item{margin:0 -24px;--mdc-list-side-padding:24px}.table-row{display:flex;justify-content:space-between;margin-bottom:20px}.stat-list{min-height:360px;display:flex;flex-direction:column}.stat-list ha-spinner{margin:0 auto}`]}constructor(...t){super(...t),this._busy=!1,this._dateTimeSelector={datetime:{}},this._amountSelector=(0,h.Z)(t=>({number:{step:.01,unit_of_measurement:t,mode:"box"}}))}}(0,a.__decorate)([(0,l.Cb)({attribute:!1})],g.prototype,"hass",void 0),(0,a.__decorate)([(0,l.SB)()],g.prototype,"_params",void 0),(0,a.__decorate)([(0,l.SB)()],g.prototype,"_busy",void 0),(0,a.__decorate)([(0,l.SB)()],g.prototype,"_moment",void 0),(0,a.__decorate)([(0,l.SB)()],g.prototype,"_stats5min",void 0),(0,a.__decorate)([(0,l.SB)()],g.prototype,"_statsHour",void 0),(0,a.__decorate)([(0,l.SB)()],g.prototype,"_chosenStat",void 0),(0,a.__decorate)([(0,l.SB)()],g.prototype,"_amount",void 0),g=(0,a.__decorate)([(0,l.Mo)("dialog-statistics-adjust-sum")],g),i()}catch(t){i(t)}})},62702:function(t,s,e){function i(t,s){return(t<0?"-":"")+Math.abs(t).toString().padStart(s,"0")}e.d(s,{r:()=>i})},19064:function(t,s,e){e.d(s,{X:()=>n});var i=e(62702),a=e(53163),o=e(1097);function n(t,s){const e=(0,o.Q)(t,s?.in);if(!(0,a.J)(e))throw new RangeError("Invalid time value");const n=s?.format??"extended",l=s?.representation??"complete";let h="";const r="extended"===n?"-":"",c="extended"===n?":":"";if("time"!==l){const t=(0,i.r)(e.getDate(),2),s=(0,i.r)(e.getMonth()+1,2);h=`${(0,i.r)(e.getFullYear(),4)}${r}${s}${r}${t}`}if("date"!==l){h=`${h}${""===h?"":" "}${(0,i.r)(e.getHours(),2)}${c}${(0,i.r)(e.getMinutes(),2)}${c}${(0,i.r)(e.getSeconds(),2)}`}return h}},53163:function(t,s,e){function i(t){return t instanceof Date||"object"==typeof t&&"[object Date]"===Object.prototype.toString.call(t)}e.d(s,{J:()=>o});var a=e(1097);function o(t){return!(!i(t)&&"number"!=typeof t||isNaN(+(0,a.Q)(t)))}}};
//# sourceMappingURL=87402.c53edde6f91efc63.js.map