"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["39280"],{44548:function(t,e,r){r.a(t,async function(t,n){try{r.d(e,{AH:function(){return p},Ai:function(){return w},Al:function(){return A},vA:function(){return b}});var o=r(26306),a=r(34635),i=r(73228),s=r(11736),u=r(59085),c=r(46021),l=r(56858),f=r(7722),_=r(21343),g=r(29426),y=r(72937),d=r(27537),m=r(38763),h=t([d]);d=(h.then?(await h)():h)[0];var v=function(t,e,r,n){var o=r((0,d.zW)(t,e),n);return o instanceof Date?(0,d.Nm)(o,e):o},p=function(t,e,r,n,o){return r.time_zone===m.c_.server?v(t,n.time_zone,e,o):e(t,o)},b=function(t,e,r,n,o){return r.time_zone===m.c_.server?v(t,n.time_zone,e,o):e(t,o)},w=function(t,e,r,n,o){return b(t,r,n,o,n.time_zone===m.c_.server?(0,d.zW)(e,o.time_zone):e)},A=function(t,e,r,n,d){var m,h;if(b(t,o.b,n,d)&&b(e,a.h,n,d)){var v=(w(e,t,i.d,n,d)+1)*(r?1:-1);m=p(t,s.z,n,d,v),h=p(p(e,s.z,n,d,v),u.V,n,d)}else if(b(t,function(t){return(0,c.b)(t).getMilliseconds()===t.getMilliseconds()},n,d)&&b(e,function(t){return(0,l.i)(t).getMilliseconds()===t.getMilliseconds()},n,d)){var A=(w(e,t,f.j,n,d)+1)*(r?1:-1);m=p(t,_.E,n,d,A),h=p(e,_.E,n,d,A)}else{var H=(w(e,t,g._,n,d)+1)*(r?1:-1);m=p(t,y.n,n,d,H),h=p(e,y.n,n,d,H)}return{start:m,end:h}};n()}catch(H){n(H)}})},97711:function(t,e,r){r.a(t,async function(t,n){try{r.d(e,{p:function(){return w}});var o=r(46021),a=r(56858),i=r(21343),s=r(66233),u=r(90964),c=r(98853),l=r(59085),f=r(40635),_=r(66297),g=r(2061),y=r(68503),d=r(25025),m=r(20215),h=r(38039),v=r(44548),p=r(34302),b=t([p,v]);[p,v]=b.then?(await b)():b;var w=function(t,e){var r=new Date,n=(0,p.Bt)(t.locale);switch(e){case"today":return[(0,v.AH)(r,o.b,t.locale,t.config,{weekStartsOn:n}),(0,v.AH)(r,a.i,t.locale,t.config,{weekStartsOn:n})];case"yesterday":return[(0,v.AH)((0,i.E)(r,-1),o.b,t.locale,t.config,{weekStartsOn:n}),(0,v.AH)((0,i.E)(r,-1),a.i,t.locale,t.config,{weekStartsOn:n})];case"this_week":return[(0,v.AH)(r,s.z,t.locale,t.config,{weekStartsOn:n}),(0,v.AH)(r,u.v,t.locale,t.config,{weekStartsOn:n})];case"this_month":return[(0,v.AH)(r,c.N,t.locale,t.config),(0,v.AH)(r,l.V,t.locale,t.config)];case"this_quarter":return[(0,v.AH)(r,f.x,t.locale,t.config),(0,v.AH)(r,_.x,t.locale,t.config)];case"this_year":return[(0,v.AH)(r,g.e,t.locale,t.config),(0,v.AH)(r,y.w,t.locale,t.config)];case"now-7d":return[(0,v.AH)(r,d.k,t.locale,t.config,7),(0,v.AH)(r,d.k,t.locale,t.config,0)];case"now-30d":return[(0,v.AH)(r,d.k,t.locale,t.config,30),(0,v.AH)(r,d.k,t.locale,t.config,0)];case"now-12m":return[(0,v.AH)((0,m.W)(r,12),c.N,t.locale,t.config),(0,v.AH)((0,m.W)(r,1),l.V,t.locale,t.config)];case"now-1h":return[(0,v.AH)(r,h.b,t.locale,t.config,1),(0,v.AH)(r,h.b,t.locale,t.config,0)];case"now-12h":return[(0,v.AH)(r,h.b,t.locale,t.config,12),(0,v.AH)(r,h.b,t.locale,t.config,0)];case"now-24h":return[(0,v.AH)(r,h.b,t.locale,t.config,24),(0,v.AH)(r,h.b,t.locale,t.config,0)]}return[r,r]};n()}catch(A){n(A)}})},64564:function(t,e,r){r.d(e,{v:function(){return o}});var n=r(75706),o=(r(2394),function(t,e){var r,o={},a=(0,n.Z)(t);try{for(a.s();!(r=a.n()).done;){var i=r.value,s=e(i);s in o?o[s].push(i):o[s]=[i]}}catch(u){a.e(u)}finally{a.f()}return o})},6640:function(t,e,r){r.a(t,async function(t,n){try{r.d(e,{Bm:function(){return E},Cj:function(){return x},E4:function(){return et},EH:function(){return $},G9:function(){return Q},Jj:function(){return K},KU:function(){return O},P:function(){return C},ST:function(){return ot},UB:function(){return J},ZC:function(){return L},_Z:function(){return B},b:function(){return X},gy:function(){return P},iK:function(){return W},jB:function(){return U},kJ:function(){return Y},mt:function(){return at},o1:function(){return D},rl:function(){return j},vE:function(){return R},xZ:function(){return z},yH:function(){return N}});var o=r(10354),a=r(42385),i=r(75706),s=r(29694),u=r(75778),c=(r(40777),r(12212),r(14487),r(55204),r(39710),r(26847),r(24819),r(2394),r(18574),r(81738),r(22960),r(6989),r(87799),r(48454),r(54480),r(69920),r(1455),r(11353),r(67886),r(65451),r(46015),r(38334),r(94880),r(75643),r(29761),r(56389),r(48694),r(44261),r(67398),r(27530),r(7722)),l=r(26306),f=r(34635),_=r(11736),g=r(73228),y=r(21343),d=r(72937),m=r(46021),h=r(56858),v=r(46363),p=r(5657),b=r(28105),w=r(44548),A=r(45691),H=r(64564),Z=r(7214),k=r(97711),M=r(28598),T=t([A,k,w,M]);[A,k,w,M]=T.then?(await T)():T;var S=[],E=function(){return{stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},D=function(){return{stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}},W=function(){return{type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}},j=function(){return{type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}},C=function(){return{type:"battery",stat_energy_from:"",stat_energy_to:""}},O=function(){return{type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},x=function(){return{type:"water",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},z=function(t){return t.callWS({type:"energy/info"})},P=99387==r.j?(st=(0,u.Z)((0,s.Z)().m(function t(e){return(0,s.Z)().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,e.loadBackendTranslation("issues","energy");case 1:return t.a(2,e.callWS({type:"energy/validate"}))}},t)})),function(t){return st.apply(this,arguments)}):null,L=function(t){return t.callWS({type:"energy/get_prefs"})},B=99387==r.j?(it=(0,u.Z)((0,s.Z)().m(function t(e,r){var n;return(0,s.Z)().w(function(t){for(;;)if(0===t.n)return n=e.callWS(Object.assign({type:"energy/save_prefs"},r)),q(e),t.a(2,n)},t)})),function(t,e){return it.apply(this,arguments)}):null,I=function(){var t=(0,u.Z)((0,s.Z)().m(function t(e,r,n,o,a){var i,u=arguments;return(0,s.Z)().w(function(t){for(;;)if(0===t.n)return i=u.length>5&&void 0!==u[5]?u[5]:"hour",t.a(2,e.callWS({type:"energy/fossil_energy_consumption",start_time:r.toISOString(),end_time:null==a?void 0:a.toISOString(),energy_statistic_ids:n,co2_statistic_id:o,period:i}))},t)}));return function(e,r,n,o,a){return t.apply(this,arguments)}}(),K=function(t){return(0,H.v)(t.energy_sources,function(t){return t.type})},N=function(t,e,r){var n,o=[],s=(0,i.Z)(t.energy_sources);try{for(s.s();!(n=s.n()).done;){var u=n.value;if(!r||r.includes(u.type))if("solar"!==u.type)if("gas"!==u.type&&"water"!==u.type)if("battery"!==u.type){var c,l=(0,i.Z)(u.flow_from);try{for(l.s();!(c=l.n()).done;){var f=c.value;o.push(f.stat_energy_from),f.stat_cost&&o.push(f.stat_cost);var _=e.cost_sensors[f.stat_energy_from];_&&o.push(_)}}catch(v){l.e(v)}finally{l.f()}var g,y=(0,i.Z)(u.flow_to);try{for(y.s();!(g=y.n()).done;){var d=g.value;o.push(d.stat_energy_to),d.stat_compensation&&o.push(d.stat_compensation);var m=e.cost_sensors[d.stat_energy_to];m&&o.push(m)}}catch(v){y.e(v)}finally{y.f()}}else o.push(u.stat_energy_from),o.push(u.stat_energy_to);else{o.push(u.stat_energy_from),u.stat_cost&&o.push(u.stat_cost);var h=e.cost_sensors[u.stat_energy_from];h&&o.push(h)}else o.push(u.stat_energy_from)}}catch(v){s.e(v)}finally{s.f()}return r&&!r.includes("device")||o.push.apply(o,(0,a.Z)(t.device_consumption.map(function(t){return t.stat_consumption}))),o},V=function(){var t=(0,u.Z)((0,s.Z)().m(function t(e,r,n,u,m){var h,v,p,b,A,H,k,M,T,S,E,D,W,j,C,O,x,P,L,B,K,V,q,G,J,U,F,Q,R,X,Y,$,tt,et,rt,nt,ot,at,it,st,ut,ct,lt;return(0,s.Z)().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,z(e);case 1:h=t.v,p=0,b=Object.values(e.entities);case 2:if(!(p<b.length)){t.n=6;break}if("co2signal"===(A=b[p]).platform){t.n=3;break}return t.a(3,5);case 3:if((H=e.states[A.entity_id])&&"%"===H.attributes.unit_of_measurement){t.n=4;break}return t.a(3,5);case 4:return v=H.entity_id,t.a(3,6);case 5:p++,t.n=2;break;case 6:k=[],M=(0,i.Z)(r.energy_sources);try{for(M.s();!(T=M.n()).done;)if("grid"===(S=T.value).type){E=(0,i.Z)(S.flow_from);try{for(E.s();!(D=E.n()).done;)W=D.value,k.push(W.stat_energy_from)}catch(s){E.e(s)}finally{E.f()}}}catch(s){M.e(s)}finally{M.f()}return j=N(r,h,["grid","solar","battery","gas","device"]),C=N(r,h,["water"]),O=[].concat((0,a.Z)(j),(0,a.Z)(C)),x=(0,c.j)(u||new Date,n),P=(0,l.b)(n)&&(!u||(0,f.h)(u))&&x>35?"month":x>2?"day":"hour",L=e.config.unit_system.length||"",B={energy:"kWh",volume:"km"===L?"m³":"ft³"},K={volume:"km"===L?"L":"gal"},V=j.length?(0,Z.dL)(e,n,u,j,P,B,["change"]):{},q=C.length?(0,Z.dL)(e,n,u,C,P,K,["change"]):{},F={},Q={},m&&(J=(0,w.vA)(n,l.b,e.locale,e.config)&&(0,w.vA)(u||new Date,f.h,e.locale,e.config)?(0,w.AH)(n,_.z,e.locale,e.config,-(0,w.Ai)(u||new Date,n,g.d,e.locale,e.config)-1):(0,w.AH)(n,y.E,e.locale,e.config,-1*(x+1)),U=(0,d.n)(n,-1),j.length&&(F=(0,Z.dL)(e,J,U,j,P,B,["change"])),C.length&&(Q=(0,Z.dL)(e,J,U,C,P,K,["change"]))),void 0!==v&&(R=I(e,n,k,v,u,x>35?"month":x>2?"day":"hour"),m&&(X=I(e,J,k,v,U,x>35?"month":x>2?"day":"hour"))),Y={},$=O.length?(0,Z.Py)(e,O):[],t.n=7,Promise.all([V,q,F,Q,$,R,X]);case 7:return tt=t.v,et=(0,o.Z)(tt,7),rt=et[0],nt=et[1],ot=et[2],at=et[3],it=et[4],st=et[5],ut=et[6],ct=Object.assign(Object.assign({},rt),nt),m&&(G=Object.assign(Object.assign({},ot),at)),O.length&&it.forEach(function(t){Y[t.statistic_id]=t}),lt={start:n,end:u,startCompare:J,endCompare:U,info:h,prefs:r,stats:ct,statsMetadata:Y,statsCompare:G,co2SignalEntity:v,fossilEnergyConsumption:st,fossilEnergyConsumptionCompare:ut},t.a(2,lt)}},t)}));return function(e,r,n,o,a){return t.apply(this,arguments)}}(),q=function(t){S.forEach(function(e){var r=J(t,{key:e});r.clearPrefs(),r._active&&r.refresh()})},G=function(t){if(t._refreshTimeout&&clearTimeout(t._refreshTimeout),t._active&&(!t.end||t.end>new Date)){var e=new Date;e.getMinutes()>=20&&e.setHours(e.getHours()+1),e.setMinutes(20,0,0),t._refreshTimeout=window.setTimeout(function(){return t.refresh()},e.getTime()-Date.now())}},J=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r="_energy";if(e.key){if(!e.key.startsWith("energy_"))throw new Error("Key need to start with energy_");r="_".concat(e.key)}if(t.connection[r])return t.connection[r];S.push(e.key);var n=(0,p._)(t.connection,r,(0,u.Z)((0,s.Z)().m(function e(){return(0,s.Z)().w(function(e){for(;;)switch(e.n){case 0:if(n.prefs){e.n=2;break}return e.n=1,L(t);case 1:n.prefs=e.v;case 2:return G(n),e.a(2,V(t,n.prefs,n.start,n.end,n.compare))}},e)}))),a=n.subscribe;n.subscribe=function(t){var e=a(t);return n._active++,void 0===n._refreshTimeout&&G(n),function(){n._active--,n._active<1&&(clearTimeout(n._refreshTimeout),n._refreshTimeout=void 0),e()}},n._active=0,n.prefs=e.prefs;var i=new Date,c=(0,A.Zs)(i,t.locale,t.config).split(":")[0],l=localStorage.getItem("energy-default-period-".concat(r))||"today",f="today"===l&&"0"===c?"yesterday":l,_=(0,k.p)(t,f),g=(0,o.Z)(_,2),y=g[0],d=g[1];n.start=(0,w.AH)(y,m.b,t.locale,t.config),n.end=(0,w.AH)(d,h.i,t.locale,t.config);var b=function(){n._updatePeriodTimeout=window.setTimeout(function(){n.start=(0,w.AH)(new Date,m.b,t.locale,t.config),n.end=(0,w.AH)(new Date,h.i,t.locale,t.config),b()},(0,v.T)((0,w.AH)(new Date,h.i,t.locale,t.config),1).getTime()-Date.now())};return b(),n.clearPrefs=function(){n.prefs=void 0},n.setPeriod=function(e,r){var o;n._updatePeriodTimeout&&(clearTimeout(n._updatePeriodTimeout),n._updatePeriodTimeout=void 0),n.start=e,n.end=r,n.start.getTime()===(0,w.AH)(new Date,m.b,t.locale,t.config).getTime()&&(null===(o=n.end)||void 0===o?void 0:o.getTime())===(0,w.AH)(new Date,h.i,t.locale,t.config).getTime()&&b()},n.setCompare=function(t){n.compare=t},n},U=function(t){return t.callWS({type:"energy/solar_forecast"})},F=["volume","energy"],Q=function(t,e){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=(0,i.Z)(t.energy_sources);try{for(o.s();!(r=o.n()).done;){var a=r.value;if("gas"===a.type&&(!e||e!==a.stat_energy_from)){var s=n[a.stat_energy_from];if(F.includes(null==s?void 0:s.unit_class))return s.unit_class}}}catch(u){o.e(u)}finally{o.f()}},R=function(t,e){return"energy"===Q(e,void 0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})?"kWh":"km"===t.config.unit_system.length?"m³":"ft³"},X=function(t){return"km"===t.config.unit_system.length?"L":"gal"},Y="/docs/energy/faq/#troubleshooting-missing-entities",$=(0,b.Z)(function(t){return{summedData:tt(t),compareSummedData:t.statsCompare?tt(t,!0):void 0}}),tt=function(t,e){var r,n={},a=(0,i.Z)(t.prefs.energy_sources);try{for(a.s();!(r=a.n()).done;){var s=r.value;if("solar"!==s.type)if("battery"!==s.type){if("grid"===s.type){var u,c=(0,i.Z)(s.flow_from);try{for(c.s();!(u=c.n()).done;){var l=u.value;n.from_grid?n.from_grid.push(l.stat_energy_from):n.from_grid=[l.stat_energy_from]}}catch(m){c.e(m)}finally{c.f()}var f,_=(0,i.Z)(s.flow_to);try{for(_.s();!(f=_.n()).done;){var g=f.value;n.to_grid?n.to_grid.push(g.stat_energy_to):n.to_grid=[g.stat_energy_to]}}catch(m){_.e(m)}finally{_.f()}}}else n.to_battery?(n.to_battery.push(s.stat_energy_to),n.from_battery.push(s.stat_energy_from)):(n.to_battery=[s.stat_energy_to],n.from_battery=[s.stat_energy_from]);else n.solar?n.solar.push(s.stat_energy_from):n.solar=[s.stat_energy_from]}}catch(m){a.e(m)}finally{a.f()}var y={total:{},timestamps:[]},d=new Set;return Object.entries(n).forEach(function(r){var n=(0,o.Z)(r,2),a=n[0],i=n[1],s={},u={},c=0;i.forEach(function(r){var n=e?t.statsCompare[r]:t.stats[r];if(n){n.forEach(function(t){if(null!==t.change&&void 0!==t.change){var e=t.change;c+=e,s[t.start]=t.start in s?s[t.start]+e:e,d.add(t.start)}}),u[r]={}}}),y[a]=s,y.total[a]=c}),y.timestamps=Array.from(d).sort(),y},et=(0,b.Z)(function(t,e){return{consumption:rt(t),compareConsumption:e?rt(e):void 0}}),rt=function(t){var e={used_total:{},grid_to_battery:{},battery_to_grid:{},solar_to_battery:{},solar_to_grid:{},used_solar:{},used_grid:{},used_battery:{},total:{used_total:0,grid_to_battery:0,battery_to_grid:0,solar_to_battery:0,solar_to_grid:0,used_solar:0,used_grid:0,used_battery:0}};return t.timestamps.forEach(function(r){var n,o,a,i,s,u=nt({from_grid:t.from_grid&&(null!==(n=t.from_grid[r])&&void 0!==n?n:0),to_grid:t.to_grid&&(null!==(o=t.to_grid[r])&&void 0!==o?o:0),solar:t.solar&&(null!==(a=t.solar[r])&&void 0!==a?a:0),to_battery:t.to_battery&&(null!==(i=t.to_battery[r])&&void 0!==i?i:0),from_battery:t.from_battery&&(null!==(s=t.from_battery[r])&&void 0!==s?s:0)}),c=u.grid_to_battery,l=u.battery_to_grid,f=u.used_solar,_=u.used_grid,g=u.used_battery,y=u.used_total,d=u.solar_to_battery,m=u.solar_to_grid;e.used_total[r]=y,e.total.used_total+=y,e.grid_to_battery[r]=c,e.total.grid_to_battery+=c,e.battery_to_grid[r]=l,e.total.battery_to_grid+=l,e.used_battery[r]=g,e.total.used_battery+=g,e.used_grid[r]=_,e.total.used_grid+=_,e.used_solar[r]=f,e.total.used_solar+=f,e.solar_to_battery[r]=d,e.total.solar_to_battery+=d,e.solar_to_grid[r]=m,e.total.solar_to_grid+=m}),e},nt=function(t){var e,r,n,o,a,i,s=Math.max(t.to_grid||0,0),u=Math.max(t.to_battery||0,0),c=Math.max(t.solar||0,0),l=Math.max(t.from_grid||0,0),f=Math.max(t.from_battery||0,0),_=(l||0)+(c||0)+(f||0)-(s||0)-(u||0),g=0,y=Math.max(_,0),d=Math.max(0,Math.min(u,l-y));g+=d,u-=d,l-=d,u-=n=Math.min(c,u),c-=n,s-=o=Math.min(c,s),c-=o,f-=r=Math.min(f,s),s-=r;var m=Math.min(l,u);return g+=m,l-=m,u-=m,y-=e=Math.min(y,c),c-=e,f-=a=Math.min(f,y),y-=a,y-=l-=i=Math.min(y,l),{used_solar:e,used_grid:i,used_battery:a,used_total:_,grid_to_battery:g,battery_to_grid:r,solar_to_battery:n,solar_to_grid:o}},ot=function(t,e,r){if(!e)return"0 ".concat(r);var n=["Wh","kWh","MWh","GWh","TWh"],o=r,a=e,i=n.findIndex(function(t){return t===r});if(i>=0){for(;Math.abs(a)<1&&i>0;)a*=1e3,i--;for(;Math.abs(a)>=1e3&&i<n.length-1;)a/=1e3,i++;o=n[i]}return(0,M.uf)(a,t.locale,{maximumFractionDigits:Math.abs(a)<10?2:Math.abs(a)<100?1:0})+" "+o},at=function(t,e){if(e.total.solar){var r=et(e,void 0),n=r.consumption;r.compareConsumption;if(!t){var o=e.total.solar;return n.total.used_solar/o*100}var a=0,i=0,s=[];e.timestamps.forEach(function(t){var e,r,o,u;a+=null!==(e=n.used_solar[t])&&void 0!==e?e:0,i+=null!==(r=n.solar_to_grid[t])&&void 0!==r?r:0,n.grid_to_battery[t]&&s.push({type:"grid",value:n.grid_to_battery[t]}),n.solar_to_battery[t]&&s.push({type:"solar",value:n.solar_to_battery[t]});for(var c=null!==(o=n.battery_to_grid[t])&&void 0!==o?o:0,l=null!==(u=n.used_battery[t])&&void 0!==u?u:0,f=function(t){var e=s[s.length-1],r=e.type;if(t>=e.value){var n=e.value;return s.pop(),{energy:n,type:r}}return e.value-=t,{energy:t,type:r}};l>0&&s.length;){var _=f(l),g=_.energy;"solar"===_.type&&(a+=g),l-=g}for(;c>0&&s.length;){var y=f(c),d=y.energy;"solar"===y.type&&(i+=d),c-=d}});var u=a+i;return!!u?a/u*100:void 0}};n()}catch(ut){n(ut)}var it,st})}}]);
//# sourceMappingURL=39280.10e36c8d6b6e314b.js.map