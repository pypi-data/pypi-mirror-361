import"../chunks/CWj6FrbW.js";import{o as ge}from"../chunks/c6gPyZYp.js";import{p as pe,s as g,a as q,u as $,b as I,f as G,c as me,g as e,d as E,e as n,t as fe,h as ve,i as c,n as H,j as be,r as he}from"../chunks/C8SLBV5c.js";import{f as B,a as R}from"../chunks/CkybfRqV.js";import{i as J}from"../chunks/hCS139x6.js";import{F as ye,g as xe,a as we,b as X,S as ke,c as T,t as A,r as Se,n as ze}from"../chunks/DQxlGI9A.js";import{D as K}from"../chunks/BS0E_GqS.js";import{B as je}from"../chunks/DHY4M7zv.js";import{g as x}from"../chunks/CqS7hfz2.js";import{g as L,u as Ne}from"../chunks/C0O8QyND.js";var De=B("<!> <!> <!> <!>",1),Oe=B("<!> <!>",1),Ce=B('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),Ie=B('<div class="text-center">No data with this selection.</div>'),Pe=B('<h1 class="mt-2 mb-4">The Energy Balance &ndash; Nodal</h1> <!> <div class="mt-4"><!></div>',1);function Ke(ee,te){pe(te,!0);let Y=g(null),P=g(null),b=g(!1),h=g(!1),w=g(q([])),k=g(q([])),S=g(q([]));const re=A(["Hourly","Daily","Weekly","Monthly"]);let s=g(null),l=g(null),i=g(null),_=g(null),y=g("Hourly"),ne=c(()=>{if(!e(s)||!e(s).solution_name)return"";let r=e(s).solution_name.split(".");return[r[r.length-1],e(s).scenario_name,"balance",e(i),e(l),e(_)].join("_")}),oe=c(()=>{if(e(P)===null)return"";let r=e(P).data.find(u=>u.carrier===e(i));return r?r[0]||r.units||"":e(P).data[0][0]||e(P).data[0].units||""});const ae=c(()=>({animation:!1,normalized:!0,elements:{point:{radius:0}},responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Time"}},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:`Power [${e(oe)}]`}}},borderWidth:1,plugins:{zoom:{pan:{enabled:!0,modifierKey:"ctrl",mode:"x"},zoom:{drag:{enabled:!0},wheel:{enabled:!0},mode:"x"},limits:{x:{minRange:10}}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}));$(()=>{e(S),E(()=>{e(S).length>0&&(e(_)==null||!e(S).includes(Number(e(_))))&&n(_,e(S)[0].toString(),!0)})}),$(()=>{e(w),E(()=>{e(w).length>0&&(e(l)==null||!e(w).includes(e(l)))&&n(l,e(w)[0],!0)})}),$(()=>{e(k),E(()=>{e(k).length>0&&(e(i)==null||!e(k).includes(e(i)))&&n(i,e(k)[0],!0)})}),$(()=>{e(s),e(_),e(l),e(i),e(y),E(le)}),ge(()=>{n(_,L("year")||e(_),!0),n(l,L("node")||e(l),!0),n(i,L("carrier")||e(i),!0),n(y,L("window_size")||e(y),!0)}),$(()=>{e(_),e(l),e(i),e(y),fe().then(()=>{Ne({year:e(_),node:e(l),carrier:e(i),window_size:e(y)})})});let se=c(()=>({Daily:24,Weekly:168,Monthly:720})[e(y)]||1);async function le(){if(e(l)==null||e(i)==null||e(_)==null||e(s)==null)return;n(h,!0);let r=Math.floor((Number(e(_))-e(s).detail.system.reference_year)/e(s).detail.system.interval_between_years);await(async u=>{var p=ve(u,2);n(Y,p[0],!0),n(P,p[1],!0)})(await Promise.all([xe(e(s).solution_name,e(l),e(i),e(s).scenario_name,r,e(se)),we(e(s).solution_name,x("flow_export",e(s).version),e(s).scenario_name)])),n(h,!1)}let ie=c(()=>e(F).length===0?[]:Object.keys(e(F)[0].data)),F=c(()=>!e(s)||!e(l)||!e(i)||!e(_)||!e(Y)?[]:(Se(),Object.entries(e(Y)).flatMap(([r,u])=>{if(!u||!u.data||u.data.length===0)return[];let p={node:[e(l)]};"technology"in u.data[0]&&(p={technology:u.data.map(t=>t.technology)});const m=u.data.filter(t=>Object.entries(p).every(([o,d])=>d.includes(t[o]))).reduce((t,o)=>{const d=o.technology||o.node||o.label||"";return(t[d]=t[d]||[]).push(o),t},{});return Object.entries(m).map(([t,o])=>({label:t,data:o.reduce((d,a)=>{for(const f in a)!isNaN(Number(a[f]))&&!["year","technology","node","label"].includes(f)&&(d[f]=(d[f]||0)+Number(a[f]));return d},{})})).map(t=>{var W;if(Object.keys(t.data).length==0)return null;const o=e(s).version,d={[x("flow_storage_discharge",o)]:v=>v+" (discharge)",[x("flow_transport_in",o)]:v=>v+" (transport in)",[x("flow_import",o)]:()=>"Import",[x("shed_demand",o)]:()=>"Shed Demand",[x("flow_storage_charge",o)]:v=>v+" (charge)",[x("flow_transport_out",o)]:v=>v+" (transport out)",[x("flow_export",o)]:()=>"Export"};let a=ze(),f=a;return r=="demand"?{data:Object.values(t.data),label:"Demand",type:"line",stack:"ownCustomStack",fill:!1,borderColor:"black",backgroundColor:"white",borderWidth:2,stepped:!0,pointRadius:Object.keys(t.data).length==1?2:0}:{data:Object.values(t.data),label:((W=d[r])==null?void 0:W.call(d,t.label))||t.label,fill:"origin",borderColor:a,backgroundColor:f,stepped:!0,cubicInterpolationMode:"monotone",pointRadius:Object.keys(t.data).length==1?2:0}}).filter(t=>t!==null)})));var Q=Pe(),U=I(G(Q),2);ye(U,{children:(r,u)=>{var p=Oe(),M=G(p);X(M,{title:"Solution Selection",children:(t,o)=>{const d=c(()=>e(h)||e(b));ke(t,{get disabled(){return e(d)},get selected_solution(){return e(s)},set selected_solution(a){n(s,a,!0)},get carriers(){return e(k)},set carriers(a){n(k,a,!0)},get nodes(){return e(w)},set nodes(a){n(w,a,!0)},get years(){return e(S)},set years(a){n(S,a,!0)},get loading(){return e(b)},set loading(a){n(b,a,!0)}})}});var m=I(M,2);{var C=t=>{X(t,{title:"Data Selection",children:(o,d)=>{var a=De(),f=G(a);T(f,{label:"Year",content:(z,j=H)=>{const N=c(()=>A(e(S).map(O=>O.toString()))),D=c(()=>e(h)||e(b));K(z,{get formId(){return j()},get options(){return e(N)},get disabled(){return e(D)},get value(){return e(_)},set value(O){n(_,O,!0)}})}});var W=I(f,2);T(W,{label:"Node",content:(z,j=H)=>{const N=c(()=>A(e(w))),D=c(()=>e(h)||e(b));K(z,{get formId(){return j()},get options(){return e(N)},get disabled(){return e(D)},get value(){return e(l)},set value(O){n(l,O,!0)}})}});var v=I(W,2);T(v,{label:"Carrier",content:(z,j=H)=>{const N=c(()=>A(e(k))),D=c(()=>e(h)||e(b));K(z,{get formId(){return j()},get options(){return e(N)},get disabled(){return e(D)},get value(){return e(i)},set value(O){n(i,O,!0)}})}});var _e=I(v,2);T(_e,{label:"Smoothing Window Size",content:(z,j=H)=>{const N=c(()=>e(h)||e(b));K(z,{get formId(){return j()},get options(){return re},get disabled(){return e(N)},get value(){return e(y)},set value(D){n(y,D,!0)}})}}),R(o,a)}})};J(m,t=>{!e(b)&&e(s)&&t(C)})}R(r,p)}});var V=I(U,2),ue=be(V);{var de=r=>{var u=Ce();R(r,u)},ce=(r,u)=>{{var p=m=>{var C=Ie();R(m,C)},M=m=>{const C=c(()=>e(F)[0].data.length==1?"bar":"line");je(m,{get type(){return e(C)},get options(){return e(ae)},get labels(){return e(ie)},get datasets(){return e(F)},get plot_name(){return e(ne)},zoom:!0})};J(r,m=>{e(F).length==0?m(p):m(M,!1)},u)}};J(ue,r=>{e(h)?r(de):r(ce,!1)})}he(V),R(ee,Q),me()}export{Ke as component};
