import"../chunks/CWj6FrbW.js";import{o as Ae}from"../chunks/c6gPyZYp.js";import{p as Be,s as _,a as $,u as q,b as N,f as J,c as Me,g as e,i,d as R,e as r,t as We,h as Ee,n as ae,j as He,r as Le}from"../chunks/C8SLBV5c.js";import{f as x,a as w}from"../chunks/CkybfRqV.js";import{i as W,b as be}from"../chunks/hCS139x6.js";import{A as ye,T as Ze}from"../chunks/t5k47KUb.js";import{F as Ke,d as Ve,f as we,b as se,S as Ye,c as re,e as ie,t as de}from"../chunks/DQxlGI9A.js";import{B as xe}from"../chunks/DHY4M7zv.js";import{D as ue}from"../chunks/BS0E_GqS.js";import{g as qe}from"../chunks/CqS7hfz2.js";import{g as ce,u as Ge}from"../chunks/C0O8QyND.js";var Je=x("<!> <!> <!>",1),Qe=x("<!> <!> <!>",1),Ue=x("<!> <!>",1),Xe=x("<!> <!>",1),$e=x('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),Re=x('<div class="text-center">No technologies with this selection.</div>'),et=x('<div class="text-center">No carriers with this selection.</div>'),tt=x('<div class="text-center">No solution selected.</div>'),at=x('<div class="text-center">No locations with this selection.</div>'),rt=x('<div class="text-center">No data with this selection.</div>'),lt=x("<!> <!>",1),ot=x('<h1 class="mt-2 mb-4">The Energy Balance &ndash; Storage</h1> <!> <div class="mt-4"><!></div>',1);function pt(Se,ke){Be(ke,!0);let m=_(null),P=null,D=null,O=null,T=null,_e=_($({})),E=_($([]));const ze=["Hourly","Daily","Weekly","Monthly"];let n=_(null),p=_(null),S=_(""),H=_("Hourly"),Q=_(!0),I=_($([])),A=_($([])),L=_(!1),B=_(!1),le=_(void 0),oe=_(void 0),Ce=i(()=>e(G).length>0?e(_e)[e(G)[0]]:""),ge=i(()=>{if(!e(n)||!e(n).solution_name)return"";let t=e(n).solution_name.split(".");return[t[t.length-1],e(n).scenario_name,"storage_level",e(p)].join("_")}),Fe=i(()=>e(ge)+"_flows"),je=i(()=>fe("Storage Level",t=>{var a;return(a=e(oe))==null?void 0:a.zoom_rect(t.chart.scales.x.min,t.chart.scales.x.max)})),Ne=i(()=>fe("Storage Flow",t=>{var a;return(a=e(le))==null?void 0:a.zoom_rect(t.chart.scales.x.min,t.chart.scales.x.max)}));function fe(t,a){return{animation:!1,normalized:!0,elements:{point:{radius:0},line:{borderWidth:1}},responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Time"}},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:`${t} [${e(Ce)}]`}}},plugins:{zoom:{pan:{enabled:!0,modifierKey:"ctrl",mode:"x",onPanComplete:a},zoom:{drag:{enabled:!0},wheel:{enabled:!0},mode:"x",onZoomComplete:a},limits:{x:{minRange:10}}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}}}let U=i(()=>{var t;return(t=e(m))!=null&&t.data?ie(e(m).data.data.map(a=>a.node)).sort():[]}),Z=i(()=>{var a;if(!((a=e(m))!=null&&a.data)||!e(n))return[];let t=Array.from(e(m).data.data.map(l=>l.technology));return ie(e(m).data.data.filter(l=>t.includes(l.technology)).map(l=>e(n).detail.reference_carrier[l.technology]))}),G=i(()=>{var a;return!((a=e(m))!=null&&a.data)||!e(n)||e(Z).length===0?[]:ie(e(m).data.data.map(l=>l.technology)).filter(l=>e(n).detail.reference_carrier[l]==e(p))});q(()=>{e(G),R(()=>{r(I,e(G),!0)})}),q(()=>{e(U),R(()=>{r(A,e(U),!0)})}),q(()=>{e(Z),R(()=>{e(Z).length>0&&(!e(p)||!e(Z).includes(e(p)))&&(r(p,e(Z)[0],!0),te())})}),q(()=>{e(E),R(()=>{e(E).length>0&&(!e(S)||!e(E).includes(Number(e(S))))&&(r(S,e(E)[0].toString(),!0),te())})}),q(()=>{e(p),e(Q),e(I),e(A),R(te)}),Ae(()=>{r(p,ce("carrier")||e(p),!0),r(S,ce("year")||e(S),!0),r(H,ce("window_size")||e(H),!0)}),q(()=>{e(S),e(p),e(H),We().then(()=>{Ge({year:e(S),carrier:e(p),window_size:e(H)})})}),q(()=>{Pe()});async function Pe(){var l;if(e(n)===null||!e(S))return;r(B,!0);let t=Math.floor((Number(e(S))-e(n).detail.system.reference_year)/e(n).detail.system.interval_between_years),a={Daily:24,Weekly:168,Monthly:720}[e(H)]||1;await(async s=>{var o=Ee(s,5);r(m,o[0],!0),P=o[1],D=o[2],O=o[3],T=o[4]})(await Promise.all(["storage_level","flow_storage_charge","flow_storage_discharge","flow_storage_spillage","flow_storage_inflow"].map(s=>Ve(e(n).solution_name,qe(s,e(n).version),e(n).scenario_name,t,a)))),(l=e(m).unit)!=null&&l.data&&r(_e,Object.fromEntries(e(m).unit.data.map(s=>[s.technology,s[0]||s.units])),!0),r(B,!1),te()}let ve=i(()=>e(ee).length===0?[]:Object.keys(e(ee)[0].data)),ee=i(()=>{var o;if(e(A).length==0||e(I).length==0||!((o=e(m))!=null&&o.data)||!(P!=null&&P.data)||!(D!=null&&D.data)||!(T!=null&&T.data)||!(O!=null&&O.data))return[];let t={technology:e(I)},a={node:e(A)},l=we(e(m).data.data,t,a,[],!1,"line","").map(h=>({...h,fill:"origin"}));if(e(Q))return l;let s={};for(const h in l[0].data)s[h]=l.map(g=>g.data[h]).reduce((g,u)=>g+u,0);return[{data:Object.values(s),label:"Storage level",type:"line",borderColor:"black",fill:"origin",stepped:!0}]}),X=_($([]));function te(){var g;if(e(n)===null||e(B)||e(A).length==0||e(I).length==0){r(X,[],!0);return}if(!((g=e(m))!=null&&g.data)||!(P!=null&&P.data)||!(D!=null&&D.data)||!(T!=null&&T.data)||!(O!=null&&O.data)){r(X,[],!0);return}let t={technology:e(I)},a={node:e(A)},[l,s,o,h]=[{data:P.data,label_suffix:"_charge",negate:!1},{data:D.data,label_suffix:"_discharge",negate:!0},{data:T.data,label_suffix:"_inflow",negate:!1},{data:O.data,label_suffix:"_spillage",negate:!0}].map(({data:u,label_suffix:c,negate:d})=>we(u.data,t,a,[],!1,"line",c).map(F=>({data:Object.fromEntries(Object.entries(F.data).map(([k,f])=>[k,d?-f:f])),label:F.label,type:F.type,stepped:!0,fill:"origin"})));if(e(Q)){r(X,l.concat(s).concat(o).concat(h),!0);return}r(X,[{data:l,label:"Flow Storage Charge",borderColor:"rgb(54, 162, 235)"},{data:s,label:"Flow Storage Discharge",borderColor:"rgb(255, 99, 132)"},{data:o,label:"Flow Storage Inflow",borderColor:"rgb(255, 99, 132)"},{data:h,label:"Flow Storage Spillage",borderColor:"rgb(255, 99, 132)"}].map(({data:u,label:c,borderColor:d})=>u.length===0?null:{data:Object.keys(u[0].data).map(F=>u.reduce((k,f)=>k+f.data[F],0)),label:c,type:"line",fill:"origin",borderColor:d,backgroundColor:d,stepped:!0}).filter(u=>u!==null),!0)}var me=ot(),pe=N(J(me),2);Ke(pe,{children:(t,a)=>{var l=Xe(),s=J(l);se(s,{title:"Solution Selection",children:(g,u)=>{const c=i(()=>e(B)||e(L));Ye(g,{get disabled(){return e(c)},get selected_solution(){return e(n)},set selected_solution(d){r(n,d,!0)},get loading(){return e(L)},set loading(d){r(L,d,!0)},get years(){return e(E)},set years(d){r(E,d,!0)}})}});var o=N(s,2);{var h=g=>{var u=Ue(),c=J(u);se(c,{title:"Variable Selection",children:(k,f)=>{var K=Je(),V=J(K);re(V,{label:"Year",content:(b,j=ae)=>{const v=i(()=>de(e(E).map(C=>C.toString()))),y=i(()=>e(B)||e(L));ue(b,{get formId(){return j()},get options(){return e(v)},get disabled(){return e(y)},get value(){return e(S)},set value(C){r(S,C,!0)}})}});var Y=N(V,2);re(Y,{label:"Carrier",content:(b,j=ae)=>{const v=i(()=>de(e(Z))),y=i(()=>e(B)||e(L));ue(b,{get formId(){return j()},get options(){return e(v)},get disabled(){return e(y)},get value(){return e(p)},set value(C){r(p,C,!0)}})}});var z=N(Y,2);re(z,{label:"Smoothing Window Size",content:(b,j=ae)=>{const v=i(()=>de(ze)),y=i(()=>e(B)||e(L));ue(b,{get formId(){return j()},get options(){return e(v)},get disabled(){return e(y)},get value(){return e(H)},set value(C){r(H,C,!0)}})}}),w(k,K)}});var d=N(c,2);{var F=k=>{se(k,{title:"Data Selection",children:(f,K)=>{var V=Qe(),Y=J(V);re(Y,{label:"Technology Subdivision",content:(j,v=ae)=>{Ze(j,{get formId(){return v()},get value(){return e(Q)},set value(y){r(Q,y,!0)}})}});var z=N(Y,2);ye(z,{label:"Technologies",get elements(){return e(G)},get value(){return e(I)},set value(b){r(I,b,!0)}});var M=N(z,2);ye(M,{label:"Node",get elements(){return e(U)},get value(){return e(A)},set value(b){r(A,b,!0)}}),w(f,V)}})};W(d,k=>{e(p)&&e(U).length>0&&k(F)})}w(g,u)};W(o,g=>{e(n)&&g(h)})}w(t,l)}});var he=N(pe,2),De=He(he);{var Oe=t=>{var a=$e();w(t,a)},Te=(t,a)=>{{var l=o=>{var h=Re();w(o,h)},s=(o,h)=>{{var g=c=>{var d=et();w(c,d)},u=(c,d)=>{{var F=f=>{var K=tt();w(f,K)},k=(f,K)=>{{var V=z=>{var M=at();w(z,M)},Y=(z,M)=>{{var b=v=>{var y=rt();w(v,y)},j=v=>{var y=lt(),C=J(y);be(xe(C,{type:"line",get labels(){return e(ve)},get datasets(){return e(ee)},get options(){return e(je)},get plot_name(){return e(ge)},zoom:!0}),ne=>r(le,ne,!0),()=>e(le));var Ie=N(C,2);be(xe(Ie,{type:"line",get labels(){return e(ve)},get datasets(){return e(X)},get options(){return e(Ne)},get plot_name(){return e(Fe)},zoom:!0}),ne=>r(oe,ne,!0),()=>e(oe)),w(v,y)};W(z,v=>{e(ee).length==0?v(b):v(j,!1)},M)}};W(f,z=>{e(U).length==0?z(V):z(Y,!1)},K)}};W(c,f=>{e(n)==null?f(F):f(k,!1)},d)}};W(o,c=>{e(Z).length==0?c(g):c(u,!1)},h)}};W(t,o=>{e(G).length==0?o(l):o(s,!1)},a)}};W(De,t=>{e(L)||e(B)?t(Oe):t(Te,!1)})}Le(he),w(Se,me),Me()}export{pt as component};
