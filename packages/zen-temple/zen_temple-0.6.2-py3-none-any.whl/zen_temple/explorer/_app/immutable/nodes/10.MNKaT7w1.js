import"../chunks/CWj6FrbW.js";import{o as Ve}from"../chunks/c6gPyZYp.js";import{p as qe,s as o,a as E,u as V,b as h,f as N,c as Ge,e as n,g as e,i as u,t as He,n as W,j as Je,r as Ke,h as Qe}from"../chunks/C8SLBV5c.js";import{f as x,a as y}from"../chunks/CkybfRqV.js";import{i as p}from"../chunks/hCS139x6.js";import{F as Ue,b as de,S as We,c as X,e as _e,h as Xe,t as Ze,r as et,f as Se}from"../chunks/DQxlGI9A.js";import{T as je,A as Z}from"../chunks/t5k47KUb.js";import{R as Ee}from"../chunks/Bog2sjMX.js";import{B as tt}from"../chunks/DHY4M7zv.js";import{g as q}from"../chunks/CqS7hfz2.js";import{g as Pe,u as at}from"../chunks/C0O8QyND.js";var rt=x("<!> <!>",1),nt=x("<!> <!>",1),lt=x("<!> <!> <!>",1),ot=x("<!> <!>",1),st=x("<!> <!> <!>",1),it=x('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),ut=x('<div class="text-center">No solution selected</div>'),ct=x('<div class="text-center">No data with this selection.</div>'),dt=x('<h1 class="mt-2 mb-4">The Transition Pathway &ndash; Emissions</h1> <!> <div class="mt-4"><!></div>',1);function St(we,Ce){qe(Ce,!0);let P=o(null),d=o(null),R=o(null),ee=o(null),te=o(null),w=o(null),me=o(E({})),ve=o(E({})),C=o(!1),F=o(!1),ge=o(E([])),T=o(E([]));const Te=[{label:"Location",value:"location"},{label:"Technology & Carrier",value:"technology_carrier"}],ke=["Annual","Cumulative"];let s=o(null),_=o(!0),b=o("Annual"),G=o(E([])),H=o(E([])),$=o("location"),J=o(!1),K=o(E([])),O=o(E([])),Fe=u(()=>{var a;if(!((a=e(s))!=null&&a.solution_name))return"";let t=e(s).solution_name.split(".");return[t[t.length-1],e(s).scenario_name,e(ae)].join("_")}),Oe=u(()=>e(_)?Object.values(e(me))[0]||"":Object.values(e(ve))[0]||""),Be=u(()=>({responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:`Emissions [${e(Oe)}]`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}})),ae=u(()=>{var t,a,i;return e(_)?q("carbon_emissions_carrier",(t=e(s))==null?void 0:t.version):e(b)=="Annual"?q("carbon_emissions_annual",(a=e(s))==null?void 0:a.version):q("carbon_emissions_cumulative",(i=e(s))==null?void 0:i.version)}),Q=u(()=>{var t;return(t=e(P))!=null&&t.data?_e(e(P).data.data.map(a=>a.technology)):[]}),U=u(()=>{var t;return(t=e(d))!=null&&t.data?_e(e(d).data.data.map(a=>a.carrier)):[]}),re=u(()=>{var t,a,i,r,l,v;return!((t=e(P))!=null&&t.data)&&!((a=e(d))!=null&&a.data)?[]:_e([...((r=(i=e(P))==null?void 0:i.data)==null?void 0:r.data)||[],...((v=(l=e(d))==null?void 0:l.data)==null?void 0:v.data)||[]].map(g=>g.location))});V(()=>{n(H,e(Q),!0)}),V(()=>{n(G,e(U),!0)}),V(()=>{n(K,e(re),!0)}),V(()=>{n(O,e(T),!0)}),Ve(()=>{let t=Pe("subdivision");n(_,t!==null?t==="true":e(_),!0),n(b,Pe("cumulation")||e(b),!0)}),V(()=>{e(_),e(b),He().then(()=>{at({subdivision:e(_)?"true":"false",cumulation:e(b)})})});function Ie(){Le()}async function Le(){var t,a,i;e(s)!==null&&(n(F,!0),await(async r=>{var l=Qe(r,6);n(P,l[0],!0),n(d,l[1],!0),n(te,l[2],!0),n(w,l[3],!0),n(R,l[4],!0),n(ee,l[5],!0)})(await Promise.all(["carbon_emissions_technology","carbon_emissions_carrier","carbon_emissions_annual_limit","carbon_emissions_budget","carbon_emissions_annual","carbon_emissions_cumulative"].map(r=>Xe(e(s).solution_name,q(r,e(s).version),e(s).scenario_name,e(s).detail.system.reference_year,e(s).detail.system.interval_between_years)))),(t=e(d).data)!=null&&t.data&&(e(d).data.data=e(d).data.data.map(r=>({...r,location:r.location||r.node}))),(a=e(d).unit)!=null&&a.data&&n(me,Object.fromEntries(e(d).unit.data.map(r=>[r.carrier,r[0]||r.units])),!0),(i=e(R).unit)!=null&&i.data&&n(ve,Object.fromEntries(e(R).unit.data.map(r=>[r.carrier,r[0]||r.units])),!0),e(w).data&&e(w).data.data.length>0&&(e(w).data.data[0]=Object.fromEntries(e(T).map(r=>[r,e(w).data.data[0][e(T)[0]]]))),n(F,!1))}let fe=u(()=>e(_)?e($)=="location"?{technology_carrier:e(Q).concat(e(U))}:{location:e(re)}:{}),pe=u(()=>e(_)?e($)=="location"?{location:e(K)}:{technology_carrier:e(H).concat(e(G))}:{}),be=u(()=>e(T).filter(t=>!e(O).includes(t))),Ne=u(()=>{var i,r,l,v;if(e(s)===null||!((i=e(R))!=null&&i.data)||!((r=e(ee))!=null&&r.data)||!((l=e(d))!=null&&l.data)||!((v=e(P))!=null&&v.data))return[];let t;e(_)?t={data:e(d).data.data.map(g=>({...g,technology_carrier:g.carrier})).concat(e(P).data.data.map(g=>({...g,technology_carrier:g.technology}))),meta:e(d).data.meta,errors:[]}:e(b)=="Annual"?t=e(R).data:t=e(ee).data,et();const a=Se(t.data,e(fe),e(pe),e(be),e(J));return a.length==1&&(a[0].label=e(ae)),a}),Re=u(()=>{var i;if(e(s)===null||e(te)===null||e(w)===null)return[];let t=null;if(e(ae)==q("carbon_emissions_annual",(i=e(s))==null?void 0:i.version)?t=e(te).data:t=e(w).data,(t==null?void 0:t.data)==null||t.data.length==0)return[];let a=Se(t.data,e(fe),e(pe),e(be),e(J));return a.length==0?[]:(a[0].label=e(b)=="Annual"?"Annual Emissions Limit":"Carbon Emissions Budget",a[0].type="line",a)}),he=u(()=>e(Ne).concat(e(Re)));var ye=dt(),xe=h(N(ye),2);Ue(xe,{children:(t,a)=>{var i=st(),r=N(i);de(r,{title:"Solution Selection",children:(c,A)=>{const z=u(()=>e(F)||e(C));We(c,{get disabled(){return e(z)},solution_selected:Ie,get selected_solution(){return e(s)},set selected_solution(m){n(s,m,!0)},get nodes(){return e(ge)},set nodes(m){n(ge,m,!0)},get years(){return e(T)},set years(m){n(T,m,!0)},get loading(){return e(C)},set loading(m){n(C,m,!0)}})}});var l=h(r,2);{var v=c=>{de(c,{title:"Variable Selection",children:(A,z)=>{var m=rt(),Y=N(m);X(Y,{label:"Subdivision",content:(D,B=W)=>{je(D,{get formId(){return B()},get value(){return e(_)},set value(I){n(_,I,!0)}})}});var le=h(Y,2);{var oe=f=>{X(f,{label:"Cumulation",content:(B,I=W)=>{const se=u(()=>Ze(ke)),ie=u(()=>e(F)||e(C));Ee(B,{get formId(){return I()},get options(){return e(se)},get disabled(){return e(ie)},get value(){return e(b)},set value(ue){n(b,ue,!0)}})}})};p(le,f=>{e(_)||f(oe)})}y(A,m)}})};p(l,c=>{!e(C)&&e(s)&&c(v)})}var g=h(l,2);{var ne=c=>{de(c,{title:"Data Selection",children:(A,z)=>{var m=ot(),Y=N(m);{var le=f=>{var D=lt(),B=N(D);X(B,{label:"Aggregation",content:(j,L=W)=>{Ee(j,{get formId(){return L()},get options(){return Te},get value(){return e($)},set value(M){n($,M,!0)}})}});var I=h(B,2);X(I,{label:"Normalization",content:(j,L=W)=>{je(j,{get formId(){return L()},get value(){return e(J)},set value(M){n(J,M,!0)}})}});var se=h(I,2);{var ie=S=>{Z(S,{label:"Location",get elements(){return e(re)},get value(){return e(K)},set value(j){n(K,j,!0)}})},ue=S=>{var j=nt(),L=N(j);{var M=k=>{Z(k,{label:"Technology",get elements(){return e(Q)},get value(){return e(H)},set value(ce){n(H,ce,!0)}})};p(L,k=>{e(Q).length>0&&k(M)})}var De=h(L,2);{var Me=k=>{Z(k,{label:"Carrier",get elements(){return e(U)},get value(){return e(G)},set value(ce){n(G,ce,!0)}})};p(De,k=>{e(U).length>0&&k(Me)})}y(S,j)};p(se,S=>{e($)=="location"?S(ie):S(ue,!1)})}y(f,D)};p(Y,f=>{e(_)&&f(le)})}var oe=h(Y,2);Z(oe,{label:"Year",get elements(){return e(T)},get value(){return e(O)},set value(f){n(O,f,!0)}}),y(A,m)}})};p(g,c=>{!e(C)&&e(s)&&!e(F)&&c(ne)})}y(t,i)}});var Ae=h(xe,2),$e=Je(Ae);{var ze=t=>{var a=it();y(t,a)},Ye=(t,a)=>{{var i=l=>{var v=ut();y(l,v)},r=(l,v)=>{{var g=c=>{var A=ct();y(c,A)},ne=c=>{const A=u(()=>e(O).map(z=>z.toString()));tt(c,{type:"bar",get options(){return e(Be)},get labels(){return e(A)},get datasets(){return e(he)},get plot_name(){return e(Fe)}})};p(l,c=>{e(he).length==0||e(O).length==0?c(g):c(ne,!1)},v)}};p(t,l=>{e(s)==null?l(i):l(r,!1)},a)}};p($e,t=>{e(C)||e(F)?t(ze):t(Ye,!1)})}Ke(Ae),y(we,ye),Ge()}export{St as component};
