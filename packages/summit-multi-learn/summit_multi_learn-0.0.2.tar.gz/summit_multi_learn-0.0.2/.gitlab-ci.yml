# run the test suite registry.lis-lab.fr:5005/baptiste.bauvin/summit/ubuntu:18.04
tests:
    image: python:3.11 
    tags:
        - docker
    script:
        - export LC_ALL=C.UTF-8
        - export LANG=C.UTF-8
        - if [ -f requirements.txt ]; then pip3 install -r requirements.txt; fi
        - pip3 install -e .
        - pip3 install -e .[test]
        - pytest --cov=. --cov-report=html
    coverage: '/^TOTAL.+?(\d+\%)$/'
    artifacts:
        paths:
            - htmlcov/

# generate the documentation
doc:
    image: python:3.11
    tags:
        - docker
    only:
        - master
        - develop
    script:
        - export LC_ALL=C.UTF-8
        - export LANG=C.UTF-8
        - if [ -f requirements.txt ]; then pip3 install -r requirements.txt; fi
        - pip3 install git+https://github.com/thibgo/randomscm.git@v0.0.0-alpha
        - pip3 install -e .[doc]
        - sphinx-apidoc -o docs/source summit
        - cd docs/source
        - sphinx-build -b html . ../build
        - cd ../..
        - cp -r ./docs/build public
    artifacts:
        paths:
            - public
            - htmlcov

# project public
pages:
    image: python:3.11
    tags:
        - docker
    only:
        - master
    script:
        - export LC_ALL=C.UTF-8
        - export LANG=C.UTF-8
        - if [ -f requirements.txt ]; then pip3 install -r requirements.txt; fi
        - pip3 install -e .[test]
        - pip3 install -e .[doc]
        - pytest --cov=. --cov-report=html
        - sphinx-apidoc -o docs/source summit
        - cd docs/source
        - sphinx-build -b html . ../build
        - cd ../..
        - cp -r ./docs/build public
        - mkdir public/coverage
        - mv htmlcov/index.html public/coverage/
        - mv htmlcov/style_*.css public/coverage/
    artifacts:
       paths:
            - public

