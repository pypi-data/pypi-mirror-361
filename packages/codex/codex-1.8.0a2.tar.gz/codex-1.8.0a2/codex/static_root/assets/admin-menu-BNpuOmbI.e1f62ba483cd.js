import{_ as S,ad as L,cM as y,q as a,v as s,b as f,G as n,a as r,A as c,y as g,B as v,D as C,C as O,s as p,x as d,w as m,F as T,z as A,S as D,bC as R,E as F,cN as V,bA as x,$ as N}from"./main-BoAlbVoF.js";import{C as U}from"./change-password-dialog-DyhQwNv1.js";import{n as B}from"./forwardRefs-Z0d4Mnc7.js";import{useAdminStore as h}from"./admin-kjMoKlqD.js";import{d as k}from"./VSelectionControl-DbKYScD5.js";import{a as w}from"./VDivider-C3ikm0Ko.js";import{v as J,a as P,C as E}from"./VDialog-BzaGu1HN.js";import{T as M}from"./index-Cu9nQXJD.js";import"./VForm-CyCdgusw.js";const Q="Create Covers",z="Find Orphan Covers",q="Remove Covers",G="Aggregate tags from Comics",W="Create Comics",j="Create Tags",K="Create Custom Covers",X="Mark Failed Imports",H="Operate Items",Y="Link Tags",Z="Link Custom Covers",$="Query Comics",tt="Query Tag Links",et="Query Missing Tags",st="Query Missing Custom Covers",at="Remove Comics",nt="Remove Folders",rt="Read tags from Comics",ot="Remove Custom Covers",it="Create Search Index Entries",ut="Update Search Index Entries",ct="Update Comics",lt="Update Tags",mt="Update Custom Covers",dt="Adopt Orphan Folders",Ct="Cleanup Orphan Tags",pt="Update Codex Server Software",ht="Backup Database",It="Optimize Database",St="Check Integrity Of Entire Database",_t="Check Integrtity Of Database Foreign Keys",bt="Check Integrity Of Full Text Virtual Table",Tt="Check Codex Latest Version",kt="Cleanup Orphan Bookmarks",ft="Cleanup Old Sessions",gt="Cleanup Orphan Covers",vt="Rebuild Full Text Search Virtual Table",wt="Restart Codex Server",Lt="Stop Codex Server",yt="Optimize Search Virtual Table",Ot="Clean Orphan Search Entries",At="Clear Full Text Search Table",Dt="Sync new Search Entries",Rt="Sync old Search Entries",Ft="Poll Library",Vt={CCC:Q,CFO:z,CRC:q,IAT:G,ICC:W,ICT:j,ICV:K,IFI:X,IGU:H,ILT:Y,ILV:Z,IQC:$,IQL:tt,IQT:et,IQV:st,IRC:at,IRF:nt,IRT:rt,IRV:ot,ISC:it,ISU:ut,IUC:ct,IUT:lt,IUV:mt,JAF:dt,JCT:Ct,JCU:pt,JDB:ht,JDO:It,JID:St,JIF:_t,JIS:bt,JLV:Tt,JRB:kt,JRS:ft,JRV:gt,JSR:vt,RCR:wt,RCS:Lt,SIO:yt,SIR:Ot,SIX:At,SSC:Dt,SSU:Rt,WPO:Ft},xt={name:"AdminStatusListItem",props:{status:{type:Object,required:!0},now:{type:Number,required:!0}},computed:{showComplete(){return Number.isInteger(this.status.complete)},showNumbers(){return this.showComplete||Number.isInteger(this.status.total)},indeterminate(){return this.status.active&&(!this.status.total||!Number.isInteger(this.status.complete))},progress(){return!this.status.total||globalThis.indeterminate?0:100*+this.status.complete/+this.status.total},title(){return Vt[this.status.statusType]},activeTime(){return new Date(this.status.active).getTime()},duration(){return this.status.active?y(this.activeTime,this.now):""}},methods:{nf(e){return Number.isInteger(e)?L.format(e):"?"}}},Nt={class:"statusItem"},Ut={class:"statusItemTitle"},Bt={key:0,class:"statusItemDetails"},Jt={key:0,class:"statusItemSubtitle"},Pt={key:1,class:"statusItemProgress"},Et={key:0,class:"statusItemProgressNumbers"},Mt={key:0},Qt={key:1,class:"statusItemDuration"};function zt(e,i,o,_,u,t){return s(),a("div",Nt,[f("div",Ut,c(t.title),1),o.status.subtitle||t.showNumbers||t.duration?(s(),a("div",Bt,[o.status.subtitle?(s(),a("div",Jt,c(o.status.subtitle),1)):n("",!0),t.showNumbers||t.duration?(s(),a("div",Pt,[t.showNumbers?(s(),a("span",Et,[t.showComplete?(s(),a("span",Mt,c(t.nf(o.status.complete))+" / ",1)):n("",!0),g(" "+c(t.nf(o.status.total)),1)])):n("",!0),t.duration?(s(),a("span",Qt,c(t.duration),1)):n("",!0)])):n("",!0)])):n("",!0),r(B,{indeterminate:t.indeterminate,"model-value":t.progress,bottom:""},null,8,["indeterminate","model-value"])])}const qt=S(xt,[["render",zt],["__scopeId","data-v-660b56f0"]]),Gt={name:"AdminStatusList",components:{CloseButton:U,StatusListItem:qt},data(){return{now:Date.now()}},computed:{...C(O,{isSettingsDrawerOpen:e=>e.isSettingsDrawerOpen}),...C(h,{librarianStatuses:e=>e.librarianStatuses,show:e=>e.librarianStatuses.length>0})},created(){this.load()},watch:{show(e){e&&this.updateTime()},isSettingsDrawerOpen(e){e&&this.updateTime()}},mounted(){this.updateTime()},methods:{...v(h,["loadTable","librarianTask"]),load(){this.loadTable("LibrarianStatus")},clear(){this.librarianTask("librarian_clear_status","")},updateTime(){this.now=Date.now(),setTimeout(()=>{this.isSettingsDrawerOpen&&this.show&&this.updateTime()},1e3)}}},Wt={key:0};function jt(e,i,o,_,u,t){const l=p("CloseButton"),I=p("StatusListItem");return s(),a(T,null,[e.show?(s(),d(w,{key:0})):n("",!0),r(P,{onClick:t.load},{default:m(()=>[r(k,null,{default:m(()=>[e.show?(s(),a("div",Wt,[r(l,{id:"clearButton",title:"Clear Librarian Statuses",size:"small",onClick:t.clear},null,8,["onClick"]),i[0]||(i[0]=f("h4",null,"Librarian Tasks",-1)),(s(!0),a(T,null,A(e.librarianStatuses,b=>(s(),d(k,{key:b.id},{default:m(()=>[r(I,{status:b,now:u.now},null,8,["status","now"])]),_:2},1024))),128))])):(s(),d(J,{key:1,id:"noTasksRunning"},{default:m(()=>i[1]||(i[1]=[g(" No librarian tasks running ")])),_:1,__:[1]}))]),_:1})]),_:1},8,["onClick"])],64)}const Kt=S(Gt,[["render",jt],["__scopeId","data-v-4e53661b"]]),Xt={name:"AdminMenu",components:{AdminStatusList:Kt,CodexListItem:E},data(){return{mdiOpenInNew:N,mdiDatabaseClockOutline:x,mdiCrownOutline:V}},computed:{...C(F,["isUserAdmin"]),...C(h,["unseenFailedImports"]),failedImportsIcon(){return this.unseenFailedImports?R:void 0},showAdminPanelLink(){return!this.$router.currentRoute?.value?.name?.startsWith("admin")}},methods:{...v(h,["clearFailedImports","librarianTask"]),onPoll(){this.librarianTask("poll")}}},Ht={key:0};function Yt(e,i,o,_,u,t){const l=p("CodexListItem"),I=p("AdminStatusList");return e.isUserAdmin?(s(),a("div",Ht,[r(w),D(r(l,{title:"Poll All Libraries","prepend-icon":u.mdiDatabaseClockOutline,onClick:t.onPoll},null,8,["prepend-icon","onClick"]),[[M,{openDelay:2e3,text:"for updated comics"}]]),t.showAdminPanelLink?(s(),d(l,{key:0,class:"adminPanelLink",to:{name:"admin"},"prepend-icon":u.mdiCrownOutline,title:"Admin Panel","append-icon":t.failedImportsIcon},null,8,["prepend-icon","append-icon"])):n("",!0),r(I)])):n("",!0)}const ie=S(Xt,[["render",Yt]]);export{ie as default};
