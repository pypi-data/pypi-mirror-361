default:
  image: python:3.13
  before_script:
    - python --version
    - pip install --upgrade pip
    - pip install tox

stages:
  - build
  - doc
  - publish

build:
  stage: build
  script:
    - tox -e build
  artifacts:
    paths:
      - dist/

doc:
  stage: doc
  dependencies: [build]
  script:
    - tox -e docs
  pages:
    publish: docs/_build/html
  artifacts:
    paths:
      - docs/_build/html

publish:
  stage: publish
  dependencies: [build]
  variables:
    TWINE_REPOSITORY: pypi
    TWINE_USERNAME: __token__
    TWINE_PASSWORD: $PYPI_TOKEN
  script:
    - tox -e publish
  rules:
    - if: $CI_COMMIT_TAG

