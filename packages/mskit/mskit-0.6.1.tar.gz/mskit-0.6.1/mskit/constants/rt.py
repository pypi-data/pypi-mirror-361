import io

import numpy as np
import pandas as pd
import scipy.stats

from mskit.sequence.fasta import write_fasta


Biognosys_iRT11_FusionSeq = "LGGNEQVTRYILAGVENSKGTFIIDPGGVIRGTFIIDPAAVIRGAGSSEPVTGLDAKTPVISGGPYEYRVEATFGVDESNAKTPVITGAPYEYRDGLDAASYYAPVRADVTPADFSEWSKLFLQFGAQGSPFLK"

possible_irt_names = [
    "iRT",
    "iRTkit",
    "iRT-Kit_WR_fusion",
    "Biognosys standards",
    "sp|iRT|iRT",
    "sp|iRT-Kit_WR_fusion|iRT-Kit_WR_fusion",
    "Biognosys|iRT-Kit_WR_fusion|iRT-Kit_WR_fusion",
]


def generate_irt_fusion_fasta(
    path,
    full_title: str = None,
    prot_db_type: str = "sp",
    accession: str = "iRTKitWRFusion",
    entry: str = "iRTKitWRFusion_iRTKitWRFusion",
    title_desc: str = "iRTKitWRFusion",
    title_os: str = "iRTKitWRFusion",
    title_ox: str = "32767",
    title_gn: str = "iRTKitWRFusion",
    title_pe: str = "1",
    title_sv: str = "1",
):
    if full_title is None:
        full_title = (
            f">{prot_db_type}|{accession}|{entry} {title_desc}"
            f" OS={title_os} OX={title_ox} GN={title_gn} PE={title_pe} SV={title_sv}"
        )

    _fasta = {full_title: Biognosys_iRT11_FusionSeq}
    write_fasta(_fasta, file_path=path, seq_line_max_char=None)
    return _fasta


"""
From irt-kit-reference-sheet.xls
"""

Biognosys_iRT11 = """\
standard	Q1	iRT	iRT_precise
LGGNEQVTR	487.257	-24.92	-24.916114
GAGSSEPVTGLDAK	644.823	0.00	0.000940333
VEATFGVDESNAK	683.828	12.39	12.38937489
YILAGVENSK	547.298	19.79	19.78791067
TPVISGGPYEYR	669.838	28.71	28.71458122
TPVITGAPYEYR	683.854	33.38	33.381243
DGLDAASYYAPVR	699.339	42.26	42.26388844
ADVTPADFSEWSK	726.836	54.62	54.621042
GTFIIDPGGVIR	622.854	70.52	70.51874133
GTFIIDPAAVIR	636.869	87.23	87.23322233
LFLQFGAQGSPFLK	776.93	100.00	100.0028217\
"""

Biognosys_iRT11_Transitions = """\
Q1 monoisotopic	Q1 average	Q3	relative intensity (approximate, TSQ-Vantage)	rank	precursor charge	fragment type	fragment charge	fragment number	nominal sequence	sequence id	transition id
487.257	487.526	860.423	100	1	2	y	1	8	LGGNEQVTR	iRT Kit_a	LGGNEQVTR.y8.1+
487.257	487.526	503.294	53	2	2	y	1	4	LGGNEQVTR	iRT Kit_a	LGGNEQVTR.y4.1+
487.257	487.526	803.401	50	3	2	y	1	7	LGGNEQVTR	iRT Kit_a	LGGNEQVTR.y7.1+
644.822	645.186	800.452	100	1	2	y	1	8	GAGSSEPVTGLDAK	iRT Kit_b	GAGSSEPVTGLDAK.y8.1+
644.822	645.186	604.331	17	2	2	y	1	6	GAGSSEPVTGLDAK	iRT Kit_b	GAGSSEPVTGLDAK.y6.1+
644.822	645.186	1016.53	16	3	2	y	1	10	GAGSSEPVTGLDAK	iRT Kit_b	GAGSSEPVTGLDAK.y10.1+
683.827	684.22	819.389	100	1	2	b	1	8	VEATFGVDESNAK	iRT Kit_c	VEATFGVDESNAK.b8.1+
683.827	684.22	966.453	56	2	2	y	1	9	VEATFGVDESNAK	iRT Kit_c	VEATFGVDESNAK.y9.1+
683.827	684.22	663.295	46	3	2	y	1	6	VEATFGVDESNAK	iRT Kit_c	VEATFGVDESNAK.y6.1+
547.297	547.62	817.442	100	1	2	y	1	8	YILAGVENSK	iRT Kit_d	YILAGVENSK.y8.1+
547.297	547.62	633.321	54	2	2	y	1	6	YILAGVENSK	iRT Kit_d	YILAGVENSK.y6.1+
547.297	547.62	704.358	52	3	2	y	1	7	YILAGVENSK	iRT Kit_d	YILAGVENSK.y7.1+
669.838	670.237	928.416	100	1	2	y	1	8	TPVISGGPYEYR	iRT Kit_e	TPVISGGPYEYR.y8.1+
669.838	670.237	1041.5	48	2	2	y	1	9	TPVISGGPYEYR	iRT Kit_e	TPVISGGPYEYR.y9.1+
669.838	670.237	841.384	39	3	2	y	1	7	TPVISGGPYEYR	iRT Kit_e	TPVISGGPYEYR.y7.1+
683.853	684.264	956.448	100	1	2	y	1	8	TPVITGAPYEYR	iRT Kit_f	TPVITGAPYEYR.y8.1+
683.853	684.264	855.4	59	2	2	y	1	7	TPVITGAPYEYR	iRT Kit_f	TPVITGAPYEYR.y7.1+
683.853	684.264	1069.53	44	3	2	y	1	9	TPVITGAPYEYR	iRT Kit_f	TPVITGAPYEYR.y9.1+
699.338	699.749	855.436	100	1	2	y	1	7	DGLDAASYYAPVR	iRT Kit_g	DGLDAASYYAPVR.y7.1+
699.338	699.749	926.474	68	2	2	y	1	8	DGLDAASYYAPVR	iRT Kit_g	DGLDAASYYAPVR.y8.1+
699.338	699.749	605.341	58	3	2	y	1	5	DGLDAASYYAPVR	iRT Kit_g	DGLDAASYYAPVR.y5.1+
726.835	727.265	1066.48	100	1	2	y	1	9	ADVTPADFSEWSK	iRT Kit_h	ADVTPADFSEWSK.y9.1+
726.835	727.265	533.746	65	2	2	y	2	9	ADVTPADFSEWSK	iRT Kit_h	ADVTPADFSEWSK.y9.2+
726.835	727.265	584.27	23	3	2	y	2	10	ADVTPADFSEWSK	iRT Kit_h	ADVTPADFSEWSK.y10.2+
622.853	623.225	598.368	100	1	2	y	1	6	GTFIIDPGGVIR	iRT Kit_i	GTFIIDPGGVIR.y6.1+
622.853	623.225	713.395	30	2	2	y	1	7	GTFIIDPGGVIR	iRT Kit_i	GTFIIDPGGVIR.y7.1+
622.853	623.225	826.479	28	3	2	y	1	8	GTFIIDPGGVIR	iRT Kit_i	GTFIIDPGGVIR.y8.1+
636.869	637.251	626.399	100	1	2	y	1	6	GTFIIDPAAVIR	iRT Kit_k	GTFIIDPAAVIR.y6.1+
636.869	637.251	854.51	66	2	2	y	1	8	GTFIIDPAAVIR	iRT Kit_k	GTFIIDPAAVIR.y8.1+
636.869	637.251	741.426	60	3	2	y	1	7	GTFIIDPAAVIR	iRT Kit_k	GTFIIDPAAVIR.y7.1+
776.929	777.412	904.489	100	1	2	y	1	9	LFLQFGAQGSPFLK	iRT Kit_l	LFLQFGAQGSPFLK.y9.1+
776.929	777.412	1051.56	91	2	2	y	1	10	LFLQFGAQGSPFLK	iRT Kit_l	LFLQFGAQGSPFLK.y10.1+
776.929	777.412	504.319	80	3	2	y	1	4	LFLQFGAQGSPFLK	iRT Kit_l	LFLQFGAQGSPFLK.y4.1+\
"""

# irt_to_rt = np.polyfit(df['iRT'], df['RT'], deg=1)
# rt_to_irt = np.polyfit(df['RT'], df['iRT'], deg=1)
# rt_irt_corr = scipy.stats.pearsonr(df['RT'], df['iRT'])

JPT_IRT_Kit = """\
No. 	Sequence	M(monoiso)	[M+H]+	[M+2H]2+	[M+3H]3+	Score*	HI (predicted)**	Observed RT***
1	YSAHEEHHYDK	1414.59018	1415.60	708.30	472.54	202.68	-1.95	9.93
2	HEHISSDYAGK	1242.56290	1243.57	622.29	415.19	265.82	0.26	13.01
3	TFAHTESHISK	1256.61494	1257.62	629.31	419.88	272.32	2.03	13.81
4	ISLGEHEGGGK	1082.53561	1083.54	542.28	361.85	201.46	2.31	17.76
5	LSSGYDGTSYK	1176.52988	1177.54	589.27	393.18	130.10	4.46	20.47
6	FGTGTYAGGEK	1086.49817	1087.51	544.26	363.17	141.44	4.47	20.32
7	VGASTGYSGLK	1038.53456	1039.54	520.27	347.19	138.76	4.89	21.76
8	TASGVGGFSTK	1010.50326	1011.51	506.26	337.84	151.79	5.34	21.57
9	SYASDFGSSAK	1118.48801	1119.50	560.25	373.84	128.88	5.79	23.32
10	LYSYYSSTESK	1326.59797	1327.61	664.31	443.21	145.28	6.16	24.47
11	LYTGAGYDEVK	1214.58190	1215.59	608.30	405.87	83.18	6.97	25.28
12	TLIAYDDSSTK	1212.58739	1213.60	607.30	405.20	132.32	7.37	26.28
13	HLTGLTFDTYK	1294.65574	1295.66	648.34	432.56	136.96	8.61	31.59
14	FLASSEGGFTK	1142.56077	1143.57	572.29	381.86	117.52	8.80	27.76
15	GFLDYESTGAK	1186.55060	1187.56	594.28	396.52	124.67	8.85	31.69
16	ALFSSITDSEK	1196.59247	1197.60	599.30	399.87	134.30	9.04	33.75
17	FVGTEYDGLAK	1198.58698	1199.59	600.30	400.54	147.74	9.24	29.24
18	YALDSYSLSSK	1232.59248	1233.60	617.30	411.87	145.91	9.32	30.56
19	HDTVFGSYLYK	1328.64009	1329.65	665.33	443.89	236.69	9.39	32.87
20	YFGYTSDTFGK	1284.56626	1285.57	643.29	429.20	109.11	9.44	33.09
21	HFALFSTDVTK	1264.64517	1265.65	633.33	422.56	256.96	9.73	34.89
22	TFTGTTDSFFK	1250.58191	1251.59	626.30	417.87	139.31	11.41	35.60
23	VSGFSDISIYK	1214.61829	1215.63	608.32	405.88	124.42	11.53	35.28
24	TFGTETFDTFK	1292.59247	1293.60	647.30	431.87	102.40	11.98	36.07
25	TSIDSFIDSYK	1274.60304	1275.61	638.31	425.87	72.29	12.01	38.25
26	ASDLLSGYYIK	1228.63394	1229.64	615.32	410.55	137.89	12.11	36.80
27	FLFTGYDTSVK	1276.63394	1277.64	639.32	426.55	83.86	12.33	37.61
28	GIFGAFTDDYK	1232.57133	1233.58	617.29	411.86	115.57	12.74	40.26
29	VYAETLSGFIK	1226.65467	1227.66	614.33	409.89	101.39	13.06	37.91
30	GFVIDDGLITK	1176.63901	1177.65	589.33	393.22	69.72	13.26	38.68
31	GASDFLSFAVK	1140.58150	1141.59	571.30	381.20	138.25	14.55	41.43
32	FFLTGTSIFVK	1258.69614	1259.70	630.36	420.57	152.54	15.95	45.36
33	VSSIFFDTFDK	1304.62885	1305.64	653.32	435.88	121.02	16.66	42.66
34	GDFTFFIDTFK	1336.63393	1337.64	669.32	446.55	196.44	19.58	49.11
35	LFISALVDFFK	1298.72743	1299.74	650.37	433.92	115.29	22.72	57.19
36	SLFFIIDGFVK	1284.71178	1285.72	643.36	429.24	133.89	22.74	53.64
37	IDVYILALLLK	1272.80568	1273.81	637.41	425.28	127.83	23.47	57.27
38	SILAFLYLYFK	1376.77439	1377.78	689.39	459.93	134.84	23.62	58.84
39	SLIFFLSTLLK	1280.77439	1281.78	641.39	427.93	129.82	23.70	59.53
40	FLISLLEEYFK	1400.75913	1401.77	701.39	467.93	175.15	25.16	55.87\
"""


class Rc:
    # Anal. Chem. 2008, 80, 18, 7036-7042 https://doi.org/10.1021/ac800984n
    Rc_RPLC = """\
residue	TFA FA	pH 10
W	13.12	13.67	12.27
F	11.34	11.92	10.19
L	9.44	9.89	8.74
I	7.86	9.06	7.47
M	6.57	6.96	5.67
V	4.86	5.72	4.86
Y	5.4 5.97    4.77
C	0.04	0.7	1.06
P	1.62	1.98	1.85
A	1.11	1.63	1.57
E	1.08	1.75	-4.94
T	0.48	1.37	1.06
D	-0.22	0.95	-5.41
Q	-0.53	0.2	0.3
S	-0.33	0.27	0.61
G	-0.35	-0.07	0.17
R	-2.58	-3.55	3.56
N	-1.44	-0.59	0.04
H	-3.04	-5.05	0.66
K	-3.53	-5.08	2.8\
"""

    # Anal. Chem. 2017, 89, 11795âˆ’11802 DOI:10.1021/acs.analchem.7b03436
    Rc_SCX = """\
residue	N-terminal	N+1	N+2	internal	C-2	C-1	C-terminal
R	1.271	1.267	1.217	1.085	1.090	1.095	1.069
H	1.192	1.199	1.162	1.038	1.043	0.980	0.921
K	1.096	1.103	1.043	0.972	0.969	0.953	0.974
W	0.075	0.112	0.125	0.105	0.092	0.101	0.016
N	-0.008	0.004	0.027	0.036	0.033	0.037	0.085
Y	-0.037	0.000	0.019	0.028	0.014	0.018	0.097
G	-0.051	-0.027	0.022	0.028	0.019	0.019	0.134
C	-0.016	0.009	0.015	0.024	0.025	0.009	0.054
F	-0.051	-0.010	0.006	0.020	0.007	0.005	0.004
D	-0.150	-0.043	-0.003	0.012	0.009	0.018	0.031
S	-0.053	-0.031	0.000	0.011	0.007	0.000	0.089
E	-0.081	-0.054	-0.025	0.008	-0.003	0.001	0.041
Q	-0.066	-0.036	-0.018	0.002	-0.013	-0.009	0.078
M	-0.076	-0.055	-0.035	-0.007	-0.033	-0.023	-0.056
A	-0.106	-0.063	-0.032	-0.010	-0.024	-0.022	0.042
T	-0.089	-0.069	-0.037	-0.018	-0.024	-0.019	0.033
L	-0.136	-0.088	-0.058	-0.032	-0.053	-0.040	0.009
I	-0.121	-0.085	-0.068	-0.040	-0.054	-0.049	0.003
V	-0.136	-0.090	-0.060	-0.043	-0.055	-0.045	0.034
P	-0.124	-0.068	-0.062	-0.054	-0.057	-0.056	0.049\
"""

    def get_rc(self, chro_type="RPLC"):
        if chro_type == "RPLC":
            data = self.Rc_RPLC
        elif chro_type == "SCX":
            data = self.Rc_SCX
        else:
            raise ValueError

        return pd.read_csv(io.StringIO(data), sep="\t")
