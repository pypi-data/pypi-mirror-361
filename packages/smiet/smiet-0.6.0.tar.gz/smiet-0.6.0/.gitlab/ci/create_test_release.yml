# Publish on TestPyPi when pushing to develop or creating a tag
test-pypi-release:
  stage: publish
  rules:
    # Only run if it's a pipeline for the default branch or a tag:
    - if: '$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH || $CI_COMMIT_TAG'
  environment:
    name: 'release-test'
    url: 'https://test.pypi.org/project/smiet/'
  script:
    - pip install build twine
    - python -m build
    - python -m twine upload --repository testpypi dist/* --verbose --non-interactive --password $TEST_PYPI_API_TOKEN
