"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["32443"],{6464:function(e,n,t){t.r(n),t.d(n,{ExternalAuth:function(){return v},createExternalAuth:function(){return m}});var r=t(29694),o=t(75778),i=t(54521),a=t(4490);t(31454),t(29573),t(821);function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function c(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(c=function(){return!!e})()}t(40777);var u=t(61943);function l(e,n){if(n&&("object"==(0,u.Z)(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function f(e,n){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,n){return e.__proto__=n,e},f(e,n)}t(21700),t(54480),t(1455);var d=t(79834),w=function(){return(0,a.Z)(function e(){(0,i.Z)(this,e),this.commands={},this.msgId=0},[{key:"attach",value:(e=(0,o.Z)((0,r.Z)().m(function e(){var n=this;return(0,r.Z)().w(function(e){for(;;)switch(e.n){case 0:return window.externalBus=function(e){return n.receiveMessage(e)},window.addEventListener("connection-status",function(e){return n.fireMessage({type:"connection-status",payload:{event:e.detail}})}),e.n=1,this.sendMessage({type:"config/get"});case 1:this.config=e.v;case 2:return e.a(2)}},e,this)})),function(){return e.apply(this,arguments)})},{key:"addCommandHandler",value:function(e){this._commandHandler=e}},{key:"sendMessage",value:function(e){var n=this,t=++this.msgId;return e.id=t,this._sendExternal(e),new Promise(function(e,r){n.commands[t]={resolve:e,reject:r}})}},{key:"fireMessage",value:function(e){e.id||(e.id=++this.msgId),this._sendExternal(e)}},{key:"receiveMessage",value:function(e){if("command"!==e.type){var n=this.commands[e.id];n?"result"===e.type&&(e.success?n.resolve(e.result):n.reject(e.error)):console.warn("Received unknown msg ID",e.id)}else{var t,r;this._commandHandler&&this._commandHandler(e)||(this._commandHandler?(t="not_ready",r="Command handler not ready"):(t="unknown_command",r="Unknown command ".concat(e.command)),console.warn(r,e),this.fireMessage({id:e.id,type:"result",success:!1,error:{code:t,message:r}}))}}},{key:"_sendExternal",value:function(e){window.externalApp?window.externalApp.externalBus(JSON.stringify(e)):window.webkit.messageHandlers.externalBus.postMessage(e)}}]);var e}(),p="externalAuthSetToken",h="externalAuthRevokeToken";if(!window.externalApp&&!window.webkit)throw new Error("External auth requires either externalApp or webkit defined on Window object.");var v=function(e){function n(e){return(0,i.Z)(this,n),t=this,o=[{hassUrl:e,clientId:"",refresh_token:"",access_token:"",expires_in:0,expires:0}],r=s(r=n),l(t,c()?Reflect.construct(r,o||[],s(t).constructor):r.apply(t,o));var t,r,o}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&f(e,n)}(n,e),(0,a.Z)(n,[{key:"refreshAccessToken",value:(u=(0,o.Z)((0,r.Z)().m(function e(n){var t,o;return(0,r.Z)().w(function(e){for(;;)switch(e.n){case 0:if(!this._tokenCallbackPromise||n){e.n=4;break}return e.p=1,e.n=2,this._tokenCallbackPromise;case 2:return e.a(2);case 3:e.p=3,e.v,this._tokenCallbackPromise=void 0;case 4:return t={callback:p},n&&(t.force=!0),this._tokenCallbackPromise=new Promise(function(e,n){window[p]=function(t,r){return t?e(r):n(r)}}),e.n=5,Promise.resolve();case 5:return window.externalApp?window.externalApp.getExternalAuth(JSON.stringify(t)):window.webkit.messageHandlers.getExternalAuth.postMessage(t),e.n=6,this._tokenCallbackPromise;case 6:o=e.v,this.data.access_token=o.access_token,this.data.expires=1e3*o.expires_in+Date.now(),this._tokenCallbackPromise=void 0;case 7:return e.a(2)}},e,this,[[1,3]])})),function(e){return u.apply(this,arguments)})},{key:"revoke",value:(t=(0,o.Z)((0,r.Z)().m(function e(){var n,t;return(0,r.Z)().w(function(e){for(;;)switch(e.n){case 0:return n={callback:h},t=new Promise(function(e,n){window[h]=function(t,r){return t?e(r):n(r)}}),e.n=1,Promise.resolve();case 1:return window.externalApp?window.externalApp.revokeExternalAuth(JSON.stringify(n)):window.webkit.messageHandlers.revokeExternalAuth.postMessage(n),e.n=2,t;case 2:return e.a(2)}},e)})),function(){return t.apply(this,arguments)})}]);var t,u}(d.gx),m=function(){var e=(0,o.Z)((0,r.Z)().m(function e(n){var t,o;return(0,r.Z)().w(function(e){for(;;)switch(e.n){case 0:if(o=new v(n),!(null!==(t=window.externalApp)&&void 0!==t&&t.externalBus||window.webkit&&window.webkit.messageHandlers.externalBus)){e.n=1;break}return o.external=new w,e.n=1,o.external.attach();case 1:return e.a(2,o)}},e)}));return function(n){return e.apply(this,arguments)}}()},67697:function(e,n,t){var r=t(12814),o=t(65085),i=t(86840),a=t(85848),s=t(47441),c=t(85707),u=Function,l=r([].concat),f=r([].join),d={};e.exports=c?u.bind:function(e){var n=o(this),t=n.prototype,r=s(arguments,1),c=function(){var t=l(r,s(arguments));return this instanceof c?function(e,n,t){if(!a(d,n)){for(var r=[],o=0;o<n;o++)r[o]="a["+o+"]";d[n]=u("C,a","return new C("+f(r,",")+")")}return d[n](e,t)}(n,t.length,t):n.apply(e,t)};return i(t)&&(c.prototype=t),c}},31454:function(e,n,t){var r=t(77341),o=t(76451),i=t(37626),a=t(67697),s=t(15058),c=t(36539),u=t(86840),l=t(31153),f=t(81455),d=o("Reflect","construct"),w=Object.prototype,p=[].push,h=f(function(){function e(){}return!(d(function(){},[],e)instanceof e)}),v=!f(function(){d(function(){})}),m=h||v;r({target:"Reflect",stat:!0,forced:m,sham:m},{construct:function(e,n){s(e),c(n);var t=arguments.length<3?e:s(arguments[2]);if(v&&!h)return d(e,n,t);if(e===t){switch(n.length){case 0:return new e;case 1:return new e(n[0]);case 2:return new e(n[0],n[1]);case 3:return new e(n[0],n[1],n[2]);case 4:return new e(n[0],n[1],n[2],n[3])}var r=[null];return i(p,r,n),new(i(a,e,r))}var o=t.prototype,f=l(u(o)?o:w),m=i(e,f,n);return u(m)?m:f}})}}]);
//# sourceMappingURL=32443.7cce133ee34efd4e.js.map