export const __webpack_ids__=["39280"];export const __webpack_modules__={44548:function(t,e,o){o.a(t,async function(t,r){try{o.d(e,{AH:()=>b,Ai:()=>v,Al:()=>A,vA:()=>w});var a=o(26306),n=o(34635),s=o(73228),i=o(11736),c=o(59085),_=o(46021),l=o(56858),g=o(7722),f=o(21343),u=o(29426),y=o(72937),d=o(27537),m=o(38763),p=t([d]);d=(p.then?(await p)():p)[0];const h=(t,e,o,r)=>{const a=o((0,d.zW)(t,e),r);return a instanceof Date?(0,d.Nm)(a,e):a},b=(t,e,o,r,a)=>o.time_zone===m.c_.server?h(t,r.time_zone,e,a):e(t,a),w=(t,e,o,r,a)=>o.time_zone===m.c_.server?h(t,r.time_zone,e,a):e(t,a),v=(t,e,o,r,a)=>w(t,o,r,a,r.time_zone===m.c_.server?(0,d.zW)(e,a.time_zone):e),A=(t,e,o,r,d)=>{let m,p;if(w(t,a.b,r,d)&&w(e,n.h,r,d)){const a=(v(e,t,s.d,r,d)+1)*(o?1:-1);m=b(t,i.z,r,d,a),p=b(b(e,i.z,r,d,a),c.V,r,d)}else if(w(t,t=>(0,_.b)(t).getMilliseconds()===t.getMilliseconds(),r,d)&&w(e,t=>(0,l.i)(t).getMilliseconds()===t.getMilliseconds(),r,d)){const a=(v(e,t,g.j,r,d)+1)*(o?1:-1);m=b(t,f.E,r,d,a),p=b(e,f.E,r,d,a)}else{const a=(v(e,t,u._,r,d)+1)*(o?1:-1);m=b(t,y.n,r,d,a),p=b(e,y.n,r,d,a)}return{start:m,end:p}};r()}catch(t){r(t)}})},97711:function(t,e,o){o.a(t,async function(t,r){try{o.d(e,{p:()=>v});var a=o(46021),n=o(56858),s=o(21343),i=o(66233),c=o(90964),_=o(98853),l=o(59085),g=o(40635),f=o(66297),u=o(2061),y=o(68503),d=o(25025),m=o(20215),p=o(38039),h=o(44548),b=o(34302),w=t([h]);h=(w.then?(await w)():w)[0];const v=(t,e)=>{const o=new Date,r=(0,b.Bt)(t.locale);switch(e){case"today":return[(0,h.AH)(o,a.b,t.locale,t.config,{weekStartsOn:r}),(0,h.AH)(o,n.i,t.locale,t.config,{weekStartsOn:r})];case"yesterday":return[(0,h.AH)((0,s.E)(o,-1),a.b,t.locale,t.config,{weekStartsOn:r}),(0,h.AH)((0,s.E)(o,-1),n.i,t.locale,t.config,{weekStartsOn:r})];case"this_week":return[(0,h.AH)(o,i.z,t.locale,t.config,{weekStartsOn:r}),(0,h.AH)(o,c.v,t.locale,t.config,{weekStartsOn:r})];case"this_month":return[(0,h.AH)(o,_.N,t.locale,t.config),(0,h.AH)(o,l.V,t.locale,t.config)];case"this_quarter":return[(0,h.AH)(o,g.x,t.locale,t.config),(0,h.AH)(o,f.x,t.locale,t.config)];case"this_year":return[(0,h.AH)(o,u.e,t.locale,t.config),(0,h.AH)(o,y.w,t.locale,t.config)];case"now-7d":return[(0,h.AH)(o,d.k,t.locale,t.config,7),(0,h.AH)(o,d.k,t.locale,t.config,0)];case"now-30d":return[(0,h.AH)(o,d.k,t.locale,t.config,30),(0,h.AH)(o,d.k,t.locale,t.config,0)];case"now-12m":return[(0,h.AH)((0,m.W)(o,12),_.N,t.locale,t.config),(0,h.AH)((0,m.W)(o,1),l.V,t.locale,t.config)];case"now-1h":return[(0,h.AH)(o,p.b,t.locale,t.config,1),(0,h.AH)(o,p.b,t.locale,t.config,0)];case"now-12h":return[(0,h.AH)(o,p.b,t.locale,t.config,12),(0,h.AH)(o,p.b,t.locale,t.config,0)];case"now-24h":return[(0,h.AH)(o,p.b,t.locale,t.config,24),(0,h.AH)(o,p.b,t.locale,t.config,0)]}return[o,o]};r()}catch(t){r(t)}})},64564:function(t,e,o){o.d(e,{v:()=>r});o(2394);const r=(t,e)=>{const o={};for(const r of t){const t=e(r);t in o?o[t].push(r):o[t]=[r]}return o}},6640:function(t,e,o){o.a(t,async function(t,r){try{o.d(e,{Bm:()=>k,Cj:()=>W,E4:()=>Q,EH:()=>U,G9:()=>$,Jj:()=>j,KU:()=>D,P:()=>E,ST:()=>Y,UB:()=>K,ZC:()=>z,_Z:()=>O,b:()=>G,gy:()=>C,iK:()=>T,jB:()=>N,kJ:()=>J,mt:()=>tt,o1:()=>M,rl:()=>S,vE:()=>q,xZ:()=>x,yH:()=>L});o(2394),o(81738),o(22960),o(6989),o(67886),o(65451),o(46015),o(38334),o(94880),o(75643),o(29761);var a=o(7722),n=o(26306),s=o(34635),i=o(11736),c=o(73228),_=o(21343),l=o(72937),g=o(46021),f=o(56858),u=o(46363),y=o(5657),d=o(28105),m=o(44548),p=o(45691),h=o(64564),b=o(7214),w=o(97711),v=o(28598),A=t([p,w,m,v]);[p,w,m,v]=A.then?(await A)():A;const H=[],k=()=>({stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),M=()=>({stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}),T=()=>({type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}),S=()=>({type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}),E=()=>({type:"battery",stat_energy_from:"",stat_energy_to:""}),D=()=>({type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),W=()=>({type:"water",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),x=t=>t.callWS({type:"energy/info"}),C=async t=>(await t.loadBackendTranslation("issues","energy"),t.callWS({type:"energy/validate"})),z=t=>t.callWS({type:"energy/get_prefs"}),O=async(t,e)=>{const o=t.callWS({type:"energy/save_prefs",...e});return B(t),o},P=async(t,e,o,r,a,n="hour")=>t.callWS({type:"energy/fossil_energy_consumption",start_time:e.toISOString(),end_time:a?.toISOString(),energy_statistic_ids:o,co2_statistic_id:r,period:n}),j=t=>(0,h.v)(t.energy_sources,t=>t.type),L=(t,e,o)=>{const r=[];for(const a of t.energy_sources)if(!o||o.includes(a.type))if("solar"!==a.type){if("gas"===a.type||"water"===a.type){r.push(a.stat_energy_from),a.stat_cost&&r.push(a.stat_cost);const t=e.cost_sensors[a.stat_energy_from];t&&r.push(t);continue}if("battery"!==a.type){for(const t of a.flow_from){r.push(t.stat_energy_from),t.stat_cost&&r.push(t.stat_cost);const o=e.cost_sensors[t.stat_energy_from];o&&r.push(o)}for(const t of a.flow_to){r.push(t.stat_energy_to),t.stat_compensation&&r.push(t.stat_compensation);const o=e.cost_sensors[t.stat_energy_to];o&&r.push(o)}}else r.push(a.stat_energy_from),r.push(a.stat_energy_to)}else r.push(a.stat_energy_from);return o&&!o.includes("device")||r.push(...t.device_consumption.map(t=>t.stat_consumption)),r},Z=async(t,e,o,r,g)=>{const f=await x(t);let u;for(const e of Object.values(t.entities)){if("co2signal"!==e.platform)continue;const o=t.states[e.entity_id];if(o&&"%"===o.attributes.unit_of_measurement){u=o.entity_id;break}}const y=[];for(const t of e.energy_sources)if("grid"===t.type)for(const e of t.flow_from)y.push(e.stat_energy_from);const d=L(e,f,["grid","solar","battery","gas","device"]),p=L(e,f,["water"]),h=[...d,...p],w=(0,a.j)(r||new Date,o),v=(0,n.b)(o)&&(!r||(0,s.h)(r))&&w>35?"month":w>2?"day":"hour",A=t.config.unit_system.length||"",H={energy:"kWh",volume:"km"===A?"m続":"ft続"},k={volume:"km"===A?"L":"gal"},M=d.length?(0,b.dL)(t,o,r,d,v,H,["change"]):{},T=p.length?(0,b.dL)(t,o,r,p,v,k,["change"]):{};let S,E,D,W,C,z={},O={};g&&(E=(0,m.vA)(o,n.b,t.locale,t.config)&&(0,m.vA)(r||new Date,s.h,t.locale,t.config)?(0,m.AH)(o,i.z,t.locale,t.config,-(0,m.Ai)(r||new Date,o,c.d,t.locale,t.config)-1):(0,m.AH)(o,_.E,t.locale,t.config,-1*(w+1)),D=(0,l.n)(o,-1),d.length&&(z=(0,b.dL)(t,E,D,d,v,H,["change"])),p.length&&(O=(0,b.dL)(t,E,D,p,v,k,["change"]))),void 0!==u&&(W=P(t,o,y,u,r,w>35?"month":w>2?"day":"hour"),g&&(C=P(t,E,y,u,D,w>35?"month":w>2?"day":"hour")));const j={},Z=h.length?(0,b.Py)(t,h):[],[B,I,K,N,V,$,q]=await Promise.all([M,T,z,O,Z,W,C]),G={...B,...I};g&&(S={...K,...N}),h.length&&V.forEach(t=>{j[t.statistic_id]=t});return{start:o,end:r,startCompare:E,endCompare:D,info:f,prefs:e,stats:G,statsMetadata:j,statsCompare:S,co2SignalEntity:u,fossilEnergyConsumption:$,fossilEnergyConsumptionCompare:q}},B=t=>{H.forEach(e=>{const o=K(t,{key:e});o.clearPrefs(),o._active&&o.refresh()})},I=t=>{if(t._refreshTimeout&&clearTimeout(t._refreshTimeout),t._active&&(!t.end||t.end>new Date)){const e=new Date;e.getMinutes()>=20&&e.setHours(e.getHours()+1),e.setMinutes(20,0,0),t._refreshTimeout=window.setTimeout(()=>t.refresh(),e.getTime()-Date.now())}},K=(t,e={})=>{let o="_energy";if(e.key){if(!e.key.startsWith("energy_"))throw new Error("Key need to start with energy_");o=`_${e.key}`}if(t.connection[o])return t.connection[o];H.push(e.key);const r=(0,y._)(t.connection,o,async()=>(r.prefs||(r.prefs=await z(t)),I(r),Z(t,r.prefs,r.start,r.end,r.compare))),a=r.subscribe;r.subscribe=t=>{const e=a(t);return r._active++,void 0===r._refreshTimeout&&I(r),()=>{r._active--,r._active<1&&(clearTimeout(r._refreshTimeout),r._refreshTimeout=void 0),e()}},r._active=0,r.prefs=e.prefs;const n=new Date,s=(0,p.Zs)(n,t.locale,t.config).split(":")[0],i=localStorage.getItem(`energy-default-period-${o}`)||"today",c="today"===i&&"0"===s?"yesterday":i,[_,l]=(0,w.p)(t,c);r.start=(0,m.AH)(_,g.b,t.locale,t.config),r.end=(0,m.AH)(l,f.i,t.locale,t.config);const d=()=>{r._updatePeriodTimeout=window.setTimeout(()=>{r.start=(0,m.AH)(new Date,g.b,t.locale,t.config),r.end=(0,m.AH)(new Date,f.i,t.locale,t.config),d()},(0,u.T)((0,m.AH)(new Date,f.i,t.locale,t.config),1).getTime()-Date.now())};return d(),r.clearPrefs=()=>{r.prefs=void 0},r.setPeriod=(e,o)=>{r._updatePeriodTimeout&&(clearTimeout(r._updatePeriodTimeout),r._updatePeriodTimeout=void 0),r.start=e,r.end=o,r.start.getTime()===(0,m.AH)(new Date,g.b,t.locale,t.config).getTime()&&r.end?.getTime()===(0,m.AH)(new Date,f.i,t.locale,t.config).getTime()&&d()},r.setCompare=t=>{r.compare=t},r},N=t=>t.callWS({type:"energy/solar_forecast"}),V=["volume","energy"],$=(t,e,o={})=>{for(const r of t.energy_sources){if("gas"!==r.type)continue;if(e&&e===r.stat_energy_from)continue;const t=o[r.stat_energy_from];if(V.includes(t?.unit_class))return t.unit_class}},q=(t,e,o={})=>"energy"===$(e,void 0,o)?"kWh":"km"===t.config.unit_system.length?"m続":"ft続",G=t=>"km"===t.config.unit_system.length?"L":"gal",J="/docs/energy/faq/#troubleshooting-missing-entities",U=(0,d.Z)(t=>({summedData:F(t),compareSummedData:t.statsCompare?F(t,!0):void 0})),F=(t,e)=>{const o={};for(const e of t.prefs.energy_sources)if("solar"!==e.type)if("battery"!==e.type){if("grid"===e.type){for(const t of e.flow_from)o.from_grid?o.from_grid.push(t.stat_energy_from):o.from_grid=[t.stat_energy_from];for(const t of e.flow_to)o.to_grid?o.to_grid.push(t.stat_energy_to):o.to_grid=[t.stat_energy_to]}}else o.to_battery?(o.to_battery.push(e.stat_energy_to),o.from_battery.push(e.stat_energy_from)):(o.to_battery=[e.stat_energy_to],o.from_battery=[e.stat_energy_from]);else o.solar?o.solar.push(e.stat_energy_from):o.solar=[e.stat_energy_from];const r={total:{},timestamps:[]},a=new Set;return Object.entries(o).forEach(([o,n])=>{const s={},i={};let c=0;n.forEach(o=>{const r=e?t.statsCompare[o]:t.stats[o];if(!r)return;r.forEach(t=>{if(null===t.change||void 0===t.change)return;const e=t.change;c+=e,s[t.start]=t.start in s?s[t.start]+e:e,a.add(t.start)}),i[o]={}}),r[o]=s,r.total[o]=c}),r.timestamps=Array.from(a).sort(),r},Q=(0,d.Z)((t,e)=>({consumption:R(t),compareConsumption:e?R(e):void 0})),R=t=>{const e={used_total:{},grid_to_battery:{},battery_to_grid:{},solar_to_battery:{},solar_to_grid:{},used_solar:{},used_grid:{},used_battery:{},total:{used_total:0,grid_to_battery:0,battery_to_grid:0,solar_to_battery:0,solar_to_grid:0,used_solar:0,used_grid:0,used_battery:0}};return t.timestamps.forEach(o=>{const{grid_to_battery:r,battery_to_grid:a,used_solar:n,used_grid:s,used_battery:i,used_total:c,solar_to_battery:_,solar_to_grid:l}=X({from_grid:t.from_grid&&(t.from_grid[o]??0),to_grid:t.to_grid&&(t.to_grid[o]??0),solar:t.solar&&(t.solar[o]??0),to_battery:t.to_battery&&(t.to_battery[o]??0),from_battery:t.from_battery&&(t.from_battery[o]??0)});e.used_total[o]=c,e.total.used_total+=c,e.grid_to_battery[o]=r,e.total.grid_to_battery+=r,e.battery_to_grid[o]=a,e.total.battery_to_grid+=a,e.used_battery[o]=i,e.total.used_battery+=i,e.used_grid[o]=s,e.total.used_grid+=s,e.used_solar[o]=n,e.total.used_solar+=n,e.solar_to_battery[o]=_,e.total.solar_to_battery+=_,e.solar_to_grid[o]=l,e.total.solar_to_grid+=l}),e},X=t=>{let e=Math.max(t.to_grid||0,0),o=Math.max(t.to_battery||0,0),r=Math.max(t.solar||0,0),a=Math.max(t.from_grid||0,0),n=Math.max(t.from_battery||0,0);const s=(a||0)+(r||0)+(n||0)-(e||0)-(o||0);let i=0,c=0,_=0,l=0,g=0,f=0,u=0,y=Math.max(s,0);const d=Math.max(0,Math.min(o,a-y));c+=d,o-=d,a-=d,l=Math.min(r,o),o-=l,r-=l,g=Math.min(r,e),e-=g,r-=g,_=Math.min(n,e),n-=_,e-=_;const m=Math.min(a,o);return c+=m,a-=m,o-=m,i=Math.min(y,r),y-=i,r-=i,f=Math.min(n,y),n-=f,y-=f,u=Math.min(y,a),a-=u,y-=a,{used_solar:i,used_grid:u,used_battery:f,used_total:s,grid_to_battery:c,battery_to_grid:_,solar_to_battery:l,solar_to_grid:g}},Y=(t,e,o)=>{if(!e)return`0 ${o}`;const r=["Wh","kWh","MWh","GWh","TWh"];let a=o,n=e,s=r.findIndex(t=>t===o);if(s>=0){for(;Math.abs(n)<1&&s>0;)n*=1e3,s--;for(;Math.abs(n)>=1e3&&s<r.length-1;)n/=1e3,s++;a=r[s]}return(0,v.uf)(n,t.locale,{maximumFractionDigits:Math.abs(n)<10?2:Math.abs(n)<100?1:0})+" "+a},tt=(t,e)=>{if(!e.total.solar)return;const{consumption:o,compareConsumption:r}=Q(e,void 0);if(!t){const t=e.total.solar;return o.total.used_solar/t*100}let a=0,n=0;const s=[];e.timestamps.forEach(t=>{a+=o.used_solar[t]??0,n+=o.solar_to_grid[t]??0,o.grid_to_battery[t]&&s.push({type:"grid",value:o.grid_to_battery[t]}),o.solar_to_battery[t]&&s.push({type:"solar",value:o.solar_to_battery[t]});let e=o.battery_to_grid[t]??0,r=o.used_battery[t]??0;const i=function(t){const e=s[s.length-1],o=e.type;if(t>=e.value){const t=e.value;return s.pop(),{energy:t,type:o}}return e.value-=t,{energy:t,type:o}};for(;r>0&&s.length;){const{energy:t,type:e}=i(r);"solar"===e&&(a+=t),r-=t}for(;e>0&&s.length;){const{energy:t,type:o}=i(e);"solar"===o&&(n+=t),e-=t}});const i=a+n;return!!i?a/i*100:void 0};r()}catch(t){r(t)}})}};
//# sourceMappingURL=39280.45daf58e2080a624.js.map