Metadata-Version: 2.4
Name: cdp-use
Version: 1.3.2
Summary: Type safe generator/client library for CDP
Requires-Python: >=3.11
Requires-Dist: httpx>=0.28.1
Requires-Dist: websockets>=15.0.1
Description-Content-Type: text/markdown

# CDP Use

A **type-safe Python client generator** for the **Chrome DevTools Protocol (CDP)**. This library automatically generates Python bindings with full TypeScript-like type safety from the official CDP protocol specifications.

## ğŸš€ Features

- **ğŸ”’ Type Safety**: Full type hints with `TypedDict` classes for all CDP commands, parameters, and return types
- **ğŸ—ï¸ Auto-Generated**: Code generated directly from official Chrome DevTools Protocol specifications
- **ğŸ¯ IntelliSense Support**: Perfect IDE autocompletion and type checking
- **ğŸ“¦ Domain Separation**: Clean organization with separate modules for each CDP domain (DOM, Network, Runtime, etc.)
- **ğŸ”„ Always Up-to-Date**: Easy regeneration from latest protocol specs
- **ğŸš« No Runtime Overhead**: Pure Python types with no validation libraries required

## ğŸ“‹ What Gets Generated

The generator creates a complete type-safe CDP client library:

```
cdp_use/cdp/
â”œâ”€â”€ library.py              # Main CDPLibrary class
â”œâ”€â”€ dom/                     # DOM domain
â”‚   â”œâ”€â”€ types.py            # DOM-specific types
â”‚   â”œâ”€â”€ commands.py         # Command parameter/return types
â”‚   â”œâ”€â”€ events.py           # Event types
â”‚   â””â”€â”€ library.py          # DOMClient class
â”œâ”€â”€ network/                # Network domain
â”‚   â””â”€â”€ ...
â”œâ”€â”€ runtime/                # Runtime domain
â”‚   â””â”€â”€ ...
â””â”€â”€ ... (50+ domains total)
```

## ğŸ› ï¸ Installation & Setup

1. **Clone and install dependencies:**

```bash
git clone https://github.com/browser-use/cdp-use
cd cdp-use
uv sync  # or pip install -r requirements.txt
```

2. **Generate the CDP client library:**

```bash
python -m cdp_use.generator.generate
```

This automatically downloads the latest protocol specifications and generates all type-safe bindings.

## ğŸ“– Usage Examples

### Basic Usage

```python
import asyncio
from cdp_use.client import CDPClient

async def main():
    # Connect to Chrome DevTools
    async with CDPClient("ws://localhost:9222/devtools/browser/...") as cdp:
        # Get all browser targets with full type safety
        targets = await cdp.send.Target.getTargets()
        print(f"Found {len(targets['targetInfos'])} targets")

        # Attach to a page target
        page_target = next(t for t in targets["targetInfos"] if t["type"] == "page")
        session = await cdp.send.Target.attachToTarget(params={
            "targetId": page_target["targetId"],
            "flatten": True
        })

        # Enable DOM and get document with type safety
        await cdp.send.DOM.enable(session_id=session["sessionId"])
        document = await cdp.send.DOM.getDocument(
            params={"depth": -1, "pierce": True},
            session_id=session["sessionId"]
        )

        print(f"Root node ID: {document['root']['nodeId']}")

asyncio.run(main())
```

### Type Safety in Action

The generated library provides complete type safety:

```python
# âœ… Fully typed parameters
await cdp.send.Runtime.evaluate(params={
    "expression": "document.title",
    "returnByValue": True,
    "awaitPromise": True
})

# âœ… Optional parameters work correctly
await cdp.send.Target.getTargets()  # No params needed

# âœ… Return types are fully typed
result = await cdp.send.DOM.getDocument(params={"depth": 1})
node_id: int = result["root"]["nodeId"]  # Full IntelliSense support

# âŒ Type errors caught at development time
await cdp.send.DOM.getDocument(params={"invalid": "param"})  # Type error!
```

### Concurrent Operations

```python
# Execute multiple CDP commands concurrently with type safety
tasks = [
    cdp.send.DOM.getDocument(params={"depth": -1}, session_id=session_id)
    for _ in range(10)
]
results = await asyncio.gather(*tasks)
print(f"Completed {len(results)} concurrent requests")
```

## ğŸ›ï¸ Architecture

### Generated Structure

- **Domain Libraries**: Each CDP domain (DOM, Network, Runtime, etc.) gets its own client class
- **Type Definitions**: Complete `TypedDict` classes for all CDP types, commands, and events
- **Main Library**: `CDPLibrary` class that combines all domain clients
- **Type Safety**: All method signatures use quoted type annotations to avoid runtime evaluation

### Key Components

```python
# Main library class
class CDPLibrary:
    def __init__(self, client: CDPClient):
        self.DOM = DOMClient(client)           # DOM operations
        self.Network = NetworkClient(client)   # Network monitoring
        self.Runtime = RuntimeClient(client)   # JavaScript execution
        self.Target = TargetClient(client)     # Target management
        # ... 50+ more domains

# Domain-specific client example
class DOMClient:
    async def getDocument(
        self,
        params: Optional[GetDocumentParameters] = None,
        session_id: Optional[str] = None
    ) -> GetDocumentReturns:
        # Fully type-safe implementation
```

## ğŸ”§ Development

### Regenerating Types

To update to the latest CDP specifications:

```bash
python -m cdp_use.generator.generate
```

This will:

1. Download the latest protocol files from the official Chrome DevTools repository
2. Generate all Python type definitions
3. Create domain-specific client classes
4. Format the code with `ruff`
5. Add auto-generated file headers

### Project Structure

```
cdp-use/
â”œâ”€â”€ cdp_use/
â”‚   â”œâ”€â”€ client.py              # Core CDP WebSocket client
â”‚   â”œâ”€â”€ generator/             # Code generation tools
â”‚   â”‚   â”œâ”€â”€ generator.py       # Main generator
â”‚   â”‚   â”œâ”€â”€ type_generator.py  # TypedDict generation
â”‚   â”‚   â”œâ”€â”€ command_generator.py # Command type generation
â”‚   â”‚   â”œâ”€â”€ event_generator.py # Event type generation
â”‚   â”‚   â”œâ”€â”€ library_generator.py # Client class generation
â”‚   â”‚   â””â”€â”€ constants.py       # Protocol file URLs
â”‚   â””â”€â”€ cdp/                   # Generated CDP library (auto-generated)
â”œâ”€â”€ simple.py                  # Example usage
â””â”€â”€ README.md
```

## ğŸ¯ Type Safety Features

### Quoted Type Annotations

All generated code uses quoted type annotations to prevent runtime evaluation issues:

```python
async def getDocument(
    self,
    params: Optional["GetDocumentParameters"] = None,
    session_id: Optional[str] = None,
) -> "GetDocumentReturns":
    return cast("GetDocumentReturns", await self._client.send_raw(...))
```

### Optional Parameter Handling

Commands with all-optional parameters are handled correctly:

```python
# These work without type errors:
await cdp.send.Target.getTargets()                    # No params
await cdp.send.Target.getTargets(params=None)         # Explicit None
await cdp.send.Target.getTargets(params={"filter": ...}) # With params
```

### Cross-Domain Type References

Types are properly imported across domains using `TYPE_CHECKING` blocks to avoid circular imports.

## ğŸ¤ Contributing

1. Fork the repository
2. Make your changes to the generator code (not the generated `cdp_use/cdp/` directory)
3. Run `python -m cdp_use.generator.generate` to regenerate the library
4. Test your changes with `python simple.py`
5. Submit a pull request

## ğŸ“ License

[Your License Here]

## ğŸ”— Related

- [Chrome DevTools Protocol Documentation](https://chromedevtools.github.io/devtools-protocol/)
- [Official Protocol Repository](https://github.com/ChromeDevTools/devtools-protocol)

---

**Generated from Chrome DevTools Protocol specifications â€¢ Type-safe â€¢ Zero runtime overhead**
