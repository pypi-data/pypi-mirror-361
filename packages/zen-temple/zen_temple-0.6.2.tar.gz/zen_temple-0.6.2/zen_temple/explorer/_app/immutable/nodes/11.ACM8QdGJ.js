import"../chunks/CWj6FrbW.js";import{o as Ve}from"../chunks/c6gPyZYp.js";import{p as qe,s as f,a as D,u as Q,b as p,f as F,c as Ge,g as e,i as v,d as ne,e as s,t as He,n as xe,j as U,r as W,l as Je}from"../chunks/C8SLBV5c.js";import{s as Ke}from"../chunks/DoZZLr3H.js";import{i as T}from"../chunks/hCS139x6.js";import{g as X,u as Qe,e as Ue,i as We}from"../chunks/C0O8QyND.js";import{f as w,a as m,c as Se}from"../chunks/CkybfRqV.js";import{s as Pe}from"../chunks/DVWfzEL5.js";import{F as Xe,b as Z,S as Ze,c as je,e as et,h as Ne,t as tt,r as rt,f as st}from"../chunks/DQxlGI9A.js";import{A as re,T as ae}from"../chunks/t5k47KUb.js";import{B as ot}from"../chunks/DHY4M7zv.js";import{D as it}from"../chunks/BS0E_GqS.js";import{g as Oe}from"../chunks/CqS7hfz2.js";var nt=w('<label class="col-6 col-md-2 fw-medium fs-5">Subdivision</label> <div class="col-4 col-md-2"><!></div>',1),at=w('<div class="row align-items-baseline"><label class="col-6 col-md-3 fw-medium fs-4"> </label> <div class="col-4 col-md-3"><!></div> <!></div>'),lt=w("<!> <!>",1),ut=w("<!> <!> <!>",1),dt=w("<!> <!> <!> <!>",1),_t=w("<!> <!>",1),ct=w('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),ft=w("<div></div>"),vt=w('<div class="text-center">No carriers with this selection.</div>'),gt=w('<div class="text-center">No data with this selection.</div>'),mt=w('<h1 class="mt-2 mb-4">The Transition Pathway &ndash; Production</h1> <!> <div class="mt-4"><!></div>',1);function $t(Ce,De){qe(De,!0);let B=f(null),G=f(D([])),H=f(D([])),le=f(D([])),Y=D([{id:"conversion",title:"Conversion",show:!0,subdivision:!1,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_conversion_output",positive_label:"Conversion output",negative:"flow_conversion_input",negative_label:"Conversion input"},{id:"storage",title:"Storage",show:!0,subdivision:!1,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_storage_discharge",positive_label:"Storage discharge",positive_suffix:" (discharge)",negative:"flow_storage_charge",negative_label:"Storage charge",negative_suffix:" (charge)"},{id:"import_export",title:"Import/Export",show:!0,subdivision:!1,show_subdivision:!1,filter_by_technologies:!1,positive:"flow_import",positive_label:"Import",negative:"flow_export",negative_label:"Export"},{id:"demand_shed_demand",title:"Demand/Shed Demand",show:!0,subdivision:!1,show_subdivision:!1,filter_by_technologies:!1,positive:"shed_demand",positive_label:"Shed Demand",negative:"demand",negative_label:"Demand"}]),i=f(null),_=f(null),S=f(D([])),P=f(D([])),ue=v(()=>[...e(S),...e(P)]),se=f(!1),z=f(D([])),L=f(D([])),ee=f(!0),de=f(!0),y=f(!1),x=f(!1),$e=v(()=>{var r;if(!((r=e(i))!=null&&r.solution_name)||!e(_))return"";let t=e(i).solution_name.split(".");return[t[(t==null?void 0:t.length)-1],e(i).scenario_name,e(_)].join("_")}),_e=f(D([])),ce=v(()=>{let t=null;return!t&&e(_)&&(t=e(_e).find(r=>r.carrier==e(_))),t&&(t[0]||t.units)||""});const fe=7;let Ee=v(()=>e(L).map(t=>t.toString())),ke=v(()=>({responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:`Production [${e(ce)}]`}}},plugins:{tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue} ${e(ce)}`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}})),M=v(()=>e(i)?e(i).detail.system.set_carriers.slice().sort():[]),V=v(()=>e(i)?et(Object.entries(e(i).detail.carriers_input).concat(Object.entries(e(i).detail.carriers_output)).filter(t=>e(_)&&t[1].includes(e(_))).map(t=>t[0])):[]),q=v(()=>e(i)?e(i).detail.system.set_storage_technologies.filter(t=>{var r;return((r=e(i))==null?void 0:r.detail.reference_carrier[t])==e(_)}):[]);Q(()=>{e(M),ne(()=>{(e(M).length>=1&&!e(_)||!e(M).includes(e(_)))&&s(_,e(M)[0],!0)})}),Q(()=>{e(V),ne(()=>{e(ee)?(s(ee,!1),e(S).length==0&&e(V).length>0&&s(S,e(V),!0)):e(V).length>0&&s(S,e(V),!0)})}),Q(()=>{e(q),ne(()=>{e(de)?(s(de,!1),e(P).length==0&&e(q).length>0&&s(P,e(q),!0)):e(q).length>0&&s(P,e(q),!0)})}),Q(()=>{s(z,e(H),!0)}),Ve(()=>{var t,r;s(_,X("carrier")||null,!0),Y.forEach(l=>{let o=X(l.id+"_show"),a=X(l.id+"_subdivision");l.show=o!==null?o==="true":l.show,l.subdivision=a!==null?a==="true":l.subdivision}),s(S,((t=X("conversion_technologies"))==null?void 0:t.split(","))||[],!0),s(ee,!0),s(P,((r=X("storage_technologies"))==null?void 0:r.split(","))||[],!0),s(ee,!0)}),Q(()=>{e(_),Y.forEach(t=>{t.show,t.subdivision}),e(S),e(P),He().then(()=>{let t={carrier:e(_),conversion_technologies:e(S).join(","),storage_technologies:e(P).join(",")};Y.forEach(r=>{t[r.id+"_show"]=r.show?"true":"false",t[r.id+"_subdivision"]=r.subdivision?"true":"false"}),Qe(t)})});function Ie(){s(L,e(G),!0),s(z,e(H),!0)}async function Fe(){Ie(),await Te()}async function Te(){var r,l;if(e(i)===null)return;s(x,!0),s(B,null);const t=await Promise.all(Y.flatMap(o=>{var a,d;return[Ne(e(i).solution_name,Oe(o.positive,(a=e(i))==null?void 0:a.version),e(i).scenario_name,e(i).detail.system.reference_year,e(i).detail.system.interval_between_years),Ne(e(i).solution_name,Oe(o.negative,(d=e(i))==null?void 0:d.version),e(i).scenario_name,e(i).detail.system.reference_year,e(i).detail.system.interval_between_years)]}));s(B,t.map(o=>!o||!o.data?null:o.data),!0),(l=(r=t[fe])==null?void 0:r.unit)!=null&&l.data&&s(_e,t[fe].unit.data,!0),s(x,!1)}function Be(t,r,l){return r.subdivision?t:Object.entries(t.reduce((o,a)=>{const d=a.node,g=a.technology;if(l&&!l.includes(g))return o;let j=Object.fromEntries(Object.entries(a).filter(([u])=>!isNaN(Number(u))).map(([u,n])=>[u,Number(n)]));return o[d]=o[d]||{technology:r.title,data:{}},o[d].data=Object.fromEntries(Object.entries(j).map(([u,n])=>[u,(n||0)+(o[d].data[u]||0)])),o},{})).map(([o,a])=>({...a.data,technology:a.technology,node:o}))}function ve(t,r,l,o,a,d){if(t===null)return[];let g={technology:[...e(ue),r.title]},j={node:e(z)};const u=Be(t.data.filter(A=>A.carrier===void 0||A.carrier==e(_)),r,r.filter_by_technologies?e(ue):void 0);let n=st(u,g,j,l,e(se),void 0,a||"");return d!==void 0&&(n=n.map(d)),!r.subdivision&&n.length>0&&(n[0].label=o),n}let ge=v(()=>{if(e(z).length==0||e(L).length==0||!e(B)||e(B).length==0)return[];let t=e(G).filter(r=>!e(L).includes(r));return rt(),Y.flatMap((r,l)=>{if(!r.show||!e(B))return[];let o=ve(e(B)[2*l],r,t,r.positive_label,r.positive_suffix,void 0),a=ve(e(B)[2*l+1],r,t,r.negative_label,r.negative_suffix,d=>({...d,data:Object.values(d.data).map(g=>-g)}));return[...o,...a]})});var me=mt(),pe=p(F(me),2);Xe(pe,{children:(t,r)=>{var l=_t(),o=F(l);Z(o,{title:"Solution Selection",children:(g,j)=>{const u=v(()=>e(x)||e(y));Ze(g,{solution_selected:Fe,get disabled(){return e(u)},get selected_solution(){return e(i)},set selected_solution(n){s(i,n,!0)},get years(){return e(G)},set years(n){s(G,n,!0)},get nodes(){return e(H)},set nodes(n){s(H,n,!0)},get edges(){return e(le)},set edges(n){s(le,n,!0)},get loading(){return e(y)},set loading(n){s(y,n,!0)}})}});var a=p(o,2);{var d=g=>{var j=dt(),u=F(j);Z(u,{title:"Carrier Selection",children:(h,te)=>{var N=Se(),O=F(N);{var E=c=>{je(c,{label:"Carrier",content:(b,k=xe)=>{const I=v(()=>tt(e(M))),R=v(()=>e(y)||e(x));it(b,{get formId(){return k()},get options(){return e(I)},get disabled(){return e(R)},get value(){return e(_)},set value(J){s(_,J,!0)}})}})};T(O,c=>{e(M).length>0&&c(E)})}m(h,N)}});var n=p(u,2);Z(n,{title:"Production Component Selection",children:(h,te)=>{var N=Se(),O=F(N);Ue(O,17,()=>Y,We,(E,c,C)=>{var b=at(),k=U(b);Pe(k,"for","variables"+C);var I=U(k,!0);W(k);var R=p(k,2),J=U(R);ae(J,{formId:"variables"+C,get value(){return e(c).show},set value(K){e(c).show=K}}),W(R);var ie=p(R,2);{var Ye=K=>{var be=nt(),we=F(be);Pe(we,"for","subdivision"+C);var ye=p(we,2),ze=U(ye);ae(ze,{formId:"subdivision"+C,get value(){return e(c).subdivision},set value(Le){e(c).subdivision=Le}}),W(ye),m(K,be)};T(ie,K=>{e(c).show&&e(c).show_subdivision&&K(Ye)})}W(b),Je(()=>Ke(I,e(c).title)),m(E,b)}),m(h,N)}});var A=p(n,2);Z(A,{title:"Technology Selection",children:(h,te)=>{var N=lt(),O=F(N);const E=v(()=>e(y)||e(x));re(O,{label:"Conversion",get elements(){return e(V)},get disabled(){return e(E)},get value(){return e(S)},set value(b){s(S,b,!0)}});var c=p(O,2);const C=v(()=>e(y)||e(x));re(c,{label:"Storage",get elements(){return e(q)},get disabled(){return e(C)},get value(){return e(P)},set value(b){s(P,b,!0)}}),m(h,N)}});var oe=p(A,2);{var $=h=>{Z(h,{title:"Data Selection",children:(te,N)=>{var O=ut(),E=F(O);je(E,{label:"Normalization",content:(R,J=xe)=>{ae(R,{get formId(){return J()},get value(){return e(se)},set value(ie){s(se,ie,!0)}})}});var c=p(E,2);const C=v(()=>e(y)||e(x));re(c,{label:"Nodes",get elements(){return e(H)},get disabled(){return e(C)},get value(){return e(z)},set value(I){s(z,I,!0)}});var b=p(c,2);const k=v(()=>e(y)||e(x));re(b,{label:"Years",get elements(){return e(G)},get disabled(){return e(k)},get value(){return e(L)},set value(I){s(L,I,!0)}}),m(te,O)}})};T(oe,h=>{!e(x)&&e(_)!=null&&h($)})}m(g,j)};T(a,g=>{!e(y)&&e(i)&&g(d)})}m(t,l)}});var he=p(pe,2),Me=U(he);{var Ae=t=>{var r=ct();m(t,r)},Re=(t,r)=>{{var l=a=>{var d=ft();m(a,d)},o=(a,d)=>{{var g=u=>{var n=vt();m(u,n)},j=(u,n)=>{{var A=$=>{var h=gt();m($,h)},oe=$=>{ot($,{type:"bar",get options(){return e(ke)},get labels(){return e(Ee)},get datasets(){return e(ge)},get plot_name(){return e($e)}})};T(u,$=>{e(ge).length==0?$(A):$(oe,!1)},n)}};T(a,u=>{e(M).length==0?u(g):u(j,!1)},d)}};T(t,a=>{e(i)==null?a(l):a(o,!1)},r)}};T(Me,t=>{e(y)||e(x)?t(Ae):t(Re,!1)})}W(he),m(Ce,me),Ge()}export{$t as component};
