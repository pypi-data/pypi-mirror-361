# ZED - Shadow VCS v0.1

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)
[![Python 3.11+](https://img.shields.io/badge/python-3.11+-blue.svg)](https://www.python.org/downloads/)
[![Tests](https://img.shields.io/badge/tests-27%2F27-brightgreen)](./tests)

> **A local-first â€œstaging VCSâ€ that lets AI agents (and humans) commit code safelyâ€”before it ever touches your production Git repository.**

---

## ğŸš€ What is Shadow VCS?

**Shadow VCS (ZED)** is a next-generation version control system for the age of AI-assisted coding. It acts as a **secure quarantine** for code changesâ€”especially those generated by AI agentsâ€”so you can review, test, and enforce policy before anything merges to your real Git repo.

**Why?**  
AI can write code, but it can also make mistakes, introduce security risks, or bypass your best practices. Shadow VCS gives you a **buffer zone**â€”like a spam filter for codeâ€”between autonomous agents and your trusted codebase.

---

## ğŸ† Key Features

- **Staging Isolation:** All changes land in `.zed/commits/*`â€”never in your main repo until approved.
- **Audit-Grade Provenance:** Every commit is fingerprinted and logged in a tamper-resistant SQLite database. Full traceability: who/what/when/why for every change, even before it hits Git.
- **Policy-Driven Quarantine:** YAML rules let you auto-approve safe changes, block dangerous ones, and require human review for anything risky.
- **Security by Default:** Detects secrets, large binaries, and suspicious patterns before they hit production.
- **Human-in-the-Loop:** You decide what gets mergedâ€”AI agents canâ€™t sneak code past you.
- **Compliance & Forensics:** Prove to auditors that risky changes were reviewed and approved by a human. Every action is logged for compliance and incident response.
- **AI Agent Safety:** Designed for AI/LLM workflows: keep agent output isolated until a human approves.
- **Not Just Another Git Wrapper:** ZED is a staging VCS, not a Git plugin. Itâ€™s a new layer of control *before* Git.

---

## ğŸ–¼ï¸ How It Works

```mermaid
graph TD
    A[AI Agent] --> B[Shadow VCS]
    B --> C[.zed/commits/*]
    B --> D[Policy Engine]
    D --> E{Risk Assessment}
    E -->|Low Risk| F[Auto-Approve]
    E -->|High Risk| G[Human Review]
    F --> H[Production Git]
    G --> H
    B --> I[Audit Trail]
```

---

## âš¡ Quick Start

### 1. Install

**Requirements:**  
- Python 3.11+  
- Git (for production workflows)

**From source:**
```bash
git clone https://github.com/AKIFQ/zed.git
cd zed
pip install -e .
```
**(PyPI coming soon!)**

### 2. Initialize a Shadow VCS Repo

```bash
mkdir my-project
cd my-project
zed init
```
Creates `.zed/` with:
- `commits/` (quarantined changes)
- `fingerprints/` (risk data)
- `index.sqlite` (audit log)
- `constraints.yaml` (policy rules)

### 3. Make Your First Commit

```bash
echo 'print("Hello Shadow VCS!")' > hello.py
zed commit -m "Add hello script" hello.py
```
Sample output:
```
Created commit a1b2c3d4 (auto-approved by policy)
  Files: 1
  Lines: +1 -0
  Risk score: 0.0
```

### 4. Review & Approve

```bash
zed status --all
zed review a1b2c3d4
zed approve a1b2c3d4
```
Or reject with a reason:
```bash
zed reject a1b2c3d4 -r "Security concern"
```

---

## ğŸ› ï¸ Full Usage & Commands

| Command | Description |
|---------|-------------|
| `zed init` | Initialize Shadow VCS repository |
| `zed commit -m "msg" <files>` | Create new commit |
| `zed status [--all]` | Show commit status |
| `zed review <commit-id>` | Review commit details |
| `zed approve <commit-id>` | Approve and apply commit |
| `zed reject <commit-id>` | Reject commit |
| `zed policy test` | Test policy rules |

---

## âš™ï¸ Configuration

### Policy & Risk Assessment

**Customize `.zed/constraints.yaml`:**
```yaml
rules:
  - match: "*.md"
    auto_approve: true
  - match: "*"
    condition: "risk_score < 0.3 and lines_added < 50"
    auto_approve: true
  - match: "*"
    condition: "risk_score > 0.7"
    require_role: "admin"
  - match: "*"
    auto_approve: false
```
- **Supported conditions:** `risk_score`, `lines_added`, `lines_deleted`
- **Test your rules:**
```bash
zed policy test \
  --rule '{"match": "*.py", "condition": "risk_score < 0.5"}' \
  --context '{"risk_score": 0.2, "lines_added": 10, "lines_deleted": 0}'
```

**How risk is calculated:**  
- Large changes = higher risk  
- Many files = higher risk  
- Sensitive patterns (e.g. `*.key`, `config`, `secret`) = high risk  
- Large binaries (>500KB) = high risk  
- Heavy deletions = higher risk

### Environment Variables

- `ZED_REPO_PATH` â€” Set default repository path
- `ZED_LOG_LEVEL` â€” Set logging level (default: INFO)

---

## ğŸ“ Directory Structure

```
.zed/
â”œâ”€â”€ commits/
â”‚   â””â”€â”€ <commit-uuid>/
â”‚       â”œâ”€â”€ files/
â”‚       â”œâ”€â”€ meta.json
â”‚       â””â”€â”€ diff.patch
â”œâ”€â”€ fingerprints/
â”‚   â””â”€â”€ <fingerprint-uuid>.json
â”œâ”€â”€ index.sqlite
â””â”€â”€ constraints.yaml
```

---

## ğŸ”’ Security & Compliance

- **Audit-Grade Logging:** All actions and approvals are logged in `index.sqlite` for full traceability.
- **Provenance:** Every commit is fingerprinted and risk-assessed.
- **Policy Enforcement:** Block, quarantine, or require review for risky changes.
- **Sandboxed Evaluation:** Policy expressions use restricted Python `eval()`.
- **File Isolation:** Commits stored separately until approved.
- **Forensics:** Reconstruct who/what/when/why for any changeâ€”ideal for regulated industries, incident response, and supply chain security.

---

## ğŸ¤– AI & Automation Use Cases

- **AI Agent Safety:** Keep LLM/AI-generated code isolated until a human approves.
- **Contractor/External Code:** Quarantine and review code from untrusted sources.
- **Compliance Automation:** Prove to auditors that all risky changes were reviewed and approved.
- **Preview:** v0.2+ will support direct LangChain and custom agent integration.

```python
from zed.integrations.langchain import ShadowVCSWrapper
agent = ShadowVCSWrapper(your_langchain_agent)
result = agent.run("Refactor the authentication module")
```

---

## ğŸ§‘â€ğŸ’» Development & Contributing

- **Setup:**
  ```bash
  git clone https://github.com/AKIFQ/zed.git
  cd zed
  python -m venv venv
  source venv/bin/activate  # or `venv\Scripts\activate` on Windows
  pip install -e .
  pip install pytest
  ```
- **Run tests:**
  ```bash
  pytest tests/ -v
  ```
- **Pre-commit:**
  ```bash
  python scripts/prepush.py
  ```
- **Contribute:**
  1. Fork the repo
  2. Create a feature branch
  3. Commit your changes
  4. Push and open a Pull Request
- **Code style:** PEP 8, add tests, update docs for new features

---

## ğŸ—ºï¸ Roadmap

- **v0.2:** LangChain/AI agent integration, Git auto-merge, Web UI, advanced risk heuristics
- **v0.3:** Multi-user, custom plugins, Slack/Teams notifications, Git patch export

---

## ğŸ“œ License

MIT License - see [LICENSE](LICENSE)

## ğŸ“£ Support & Community

- [GitHub Issues](https://github.com/AKIFQ/zed/issues)
- [GitHub Discussions](https://github.com/AKIFQ/zed/discussions)
- [Wiki](https://github.com/AKIFQ/zed/wiki)

## ğŸ“– Citation

```bibtex
@software{shadow_vcs,
  title={Shadow VCS: Local-first Staging VCS for AI Agents},
  author={Shadow VCS Contributors},
  year={2024},
  url={https://github.com/AKIFQ/zed}
}
```

---

> **Shadow VCS** â€“ Because AI agents need training wheels too! ğŸš€

---

**If you like this project, please â­ï¸ the repo and share your feedback!** 