
Crackerjacking[33m...[0m

PDM installed: ✅

[?25l[36m⠋[0m [33m0:00:00[0m [1mResolving dependencies[0m  [2K[36m⠋[0m [33m0:00:00[0m [1mResolve for environment (>=3.13)[0m None[2K[36m⠋[0m [33m0:00:00[0m [1mResolve for environment (>=3.13)[0m None
[?25h[34mINFO:[0m [2mUsing uv is experimental and might break due to uv updates.[0m
[37m⠋[0m [2mResolving dependencies...                                                                                                                                            [0m[2K[37m⠙[0m [2mResolving dependencies...                                                                                                                                            [0m[2K[37m⠋[0m [2mResolving dependencies...                                                                                                                                            [0m[2K[37m⠙[0m [2mResolving dependencies...                                                                                                                                            [0m[2K[37m⠋[0m [2mResolving dependencies...                                                                                                                                            [0m[2K[37m⠙[0m [2mResolving dependencies...                                                                                                                                            [0m[2K[37m⠙[0m [2mstarlette-async-jinja==1.9.13                                                                                                                                        [0m[2K[37m⠙[0m [2mstarlette-async-jinja==1.9.13                                                                                                                                        [0m[2K[37m⠙[0m [2manyio==4.9.0                                                                                                                                                         [0m[2K[37m⠙[0m [2mjinja2==3.1.6                                                                                                                                                        [0m[2K[37m⠙[0m [2mjinja2-async-environment==0.11.8                                                                                                                                     [0m[2K[37m⠙[0m [2mmsgspec==0.19.0                                                                                                                                                      [0m[2K[37m⠙[0m [2mstarlette==0.47.0                                                                                                                                                    [0m[2K[37m⠙[0m [2mcrackerjack==0.20.20                                                                                                                                                 [0m[2K[37m⠙[0m [2midna==3.10                                                                                                                                                           [0m[2K[37m⠙[0m [2msniffio==1.3.1                                                                                                                                                       [0m[2K[37m⠙[0m [2mmarkupsafe==3.0.2                                                                                                                                                    [0m[2K[37m⠙[0m [2mredis==6.2.0                                                                                                                                                         [0m[2K[37m⠙[0m [2mautotyping==24.9.0                                                                                                                                                   [0m[2K[37m⠙[0m [2mkeyring==25.6.0                                                                                                                                                      [0m[2K[37m⠙[0m [2mpdm==2.25.2                                                                                                                                                          [0m[2K[37m⠙[0m [2mpdm-bump==0.9.12                                                                                                                                                     [0m[2K[37m⠙[0m [2mpre-commit==4.2.0                                                                                                                                                    [0m[2K[37m⠙[0m [2mpydantic==2.11.7                                                                                                                                                     [0m[2K[2mResolved [1m87 packages[0m [2min 49ms[0m[0m
[?25l[2K[36m⠹[0m [33m0:00:00[0m [1mResolve for environment (>=3.13)[0m None[2K[36m⠴[0m [33m0:00:00[0m [1mResolve for environment (>=3.13)[0m None[2K  [33m0:00:00[0m [1m🔒 Lock successful.[0m  [2KChanges are written to [32mpdm.lock[0m.
  [33m0:00:00[0m [1m🔒 Lock successful.[0m  [2K  [33m0:00:00[0m [1m🔒 Lock successful.[0m  
[?25hLock file updated: ✅

Skipping pre-commit hooks


Running tests[33m...[0m

============================= test session starts ==============================
created: [1;36m2[0m/[1;36m2[0m workers
[1;36m2[0m workers [1m[[0m[1;36m42[0m items[1m][0m

scheduling tests via LoadScheduling

tests/test_integration.py::test_context_processors 
tests/test_e2e.py::test_template_rendering 
 PASSED tests/test_e2e.py::test_template_rendering 
tests/test_e2e.py::test_block_rendering 
 PASSED tests/test_e2e.py::test_block_rendering 
tests/test_e2e.py::test_fragment_rendering 
 PASSED tests/test_e2e.py::test_fragment_rendering 
tests/test_e2e.py::test_error_handling 
 PASSED tests/test_e2e.py::test_error_handling 
tests/test_integration.py::test_full_application_integration 
 FAILED tests/test_integration.py::test_context_processors 
 PASSED tests/test_integration.py::test_full_application_integration 
tests/test_responses.py::test_template_response_call_with_debug_extension 
 PASSED tests/test_responses.py::test_template_response_call_with_debug_extension 
tests/test_responses.py::test_async_jinja2_templates_init 
 PASSED tests/test_responses.py::test_async_jinja2_templates_init 
tests/test_responses.py::test_async_jinja2_templates_init_with_options 
 PASSED tests/test_responses.py::test_async_jinja2_templates_init_with_options 
tests/test_responses.py::test_async_jinja2_templates_create_env 
 PASSED tests/test_responses.py::test_async_jinja2_templates_create_env 
tests/test_responses.py::test_async_jinja2_templates_render_block 
 PASSED tests/test_responses.py::test_async_jinja2_templates_render_block 

=================================== FAILURES ===================================
___________________________ test_context_processors ____________________________
 darwin -- Python [1;36m3.13[0m.[1;36m5[0m [35m/Users/les/Projects/starlette-async-jinja/.venv/bin/[0m[95mpython3[0m
starlette_async_jinja/responses.py:[1;36m195[0m: in TemplateResponse
    return [1;35m_TemplateResponse[0m[1m([0m
starlette_async_jinja/responses.py:[1;36m50[0m: in __init__
    [1;35msuper[0m[1m([0m[1m)[0m[1;35m.__init__[0m[1m([0mcontent, status_code, headers, media_type, background[1m)[0m
.venv/lib/python3.[1;36m13[0m/site-packages/starlette/responses.py:[1;36m48[0m: in __init__
    [1;35mself.init_headers[0m[1m([0mheaders[1m)[0m
.venv/lib/python3.[1;36m13[0m/site-packages/starlette/responses.py:[1;36m74[0m: in init_headers
    content_length = [1;35mstr[0m[1m([0m[1;35mlen[0m[1m([0mbody[1m)[0m[1m)[0m
                         ^^^^^^^^^
E   TypeError: object of type [32m'coroutine'[0m has no [1;35mlen[0m[1m([0m[1m)[0m

During handling of the above exception, another exception occurred:
tests/test_integration.py:[1;36m191[0m: in test_context_processors
    await [1;35mtemplates.TemplateResponse[0m[1m([0m
starlette_async_jinja/responses.py:[1;36m205[0m: in TemplateResponse
    raise [1;35mRuntimeError[0m[1m([0mf"Error creating template response for [32m'[0m[32m{[0m[32mname[0m[32m}[0m[32m'[0m: [1m{[0me[1m}[0m"[1m)[0m
E   RuntimeError: Error creating template response for [32m'test.html'[0m: object of type [32m'coroutine'[0m has no [1;35mlen[0m[1m([0m[1m)[0m
============================== slowest durations ===============================
[1;36m0.[0m02s call     tests/test_e2e.py::test_template_rendering
[1;36m0.[0m02s call     tests/test_integration.py::test_full_application_integration
[1;36m0.[0m01s setup    tests/test_e2e.py::test_template_rendering
[1;36m0.[0m01s call     tests/test_integration.py::test_context_processors
[1;36m0.[0m01s call     tests/test_e2e.py::test_error_handling
[1;36m0.[0m01s call     tests/test_e2e.py::test_fragment_rendering
[1;36m0.[0m01s call     tests/test_e2e.py::test_block_rendering
[1;36m0.[0m01s setup    tests/test_e2e.py::test_fragment_rendering
[1;36m0.[0m01s setup    tests/test_e2e.py::test_block_rendering
[1;36m0.[0m01s setup    tests/test_e2e.py::test_error_handling

[1m([0m[1;36m23[0m durations < [1;36m0.[0m005s hidden.  Use -vv to show these durations.[1m)[0m
=========================== short test summary info ============================
FAILED tests/test_integration.py::test_context_processors - RuntimeError: Err[33m...[0m
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after [1;36m1[0m failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!! xdist.dsession.Interrupted: stopping after [1;36m1[0m failures !!!!!!!!!!!!!
========================= [1;36m1[0m failed, [1;36m10[0m passed in [1;36m2.[0m23s =========================

[35m/Users/les/Projects/starlette-async-jinja/.venv/lib/python3.13/site-packages/pytest_benchmark/[0m[95mlogger.py[0m:[1;36m39[0m: PytestBenchmarkWarning: Benchmarks are automatically 
disabled because xdist plugin is active.Benchmarks cannot be performed reliably in a parallelized environment.
  [1;35mwarner[0m[1m([0m[1;35mPytestBenchmarkWarning[0m[1m([0mtext[1m)[0m[1m)[0m
[1m<[0m[1;95msys[0m[1m>[0m:[1;36m0[0m: RuntimeWarning: coroutine [32m'AsyncMockMixin._execute_mock_call'[0m was never awaited



❌ Tests failed. Please fix errors.

