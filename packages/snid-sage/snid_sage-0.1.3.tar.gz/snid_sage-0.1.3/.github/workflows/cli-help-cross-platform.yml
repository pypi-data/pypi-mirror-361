name: CLI Help Cross-Platform Test

on:
  workflow_run:
    workflows: ["Deploy to PyPI"]
    types: [completed]
  workflow_dispatch:

jobs:
  cli-help:
    if: github.event_name == 'workflow_dispatch' || github.event.workflow_run.conclusion == 'success'
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
    runs-on: ${{ matrix.os }}

    steps:
      - name: Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install package from PyPI
        run: |
          python -m pip install --upgrade pip
          python -m pip install snid-sage

      - name: Run CLI help commands (bash)
        if: runner.os != 'Windows'
        shell: bash
        run: |
          set -euxo pipefail
          snid --help
          snid-sage --help

      - name: Run CLI help commands (PowerShell)
        if: runner.os == 'Windows'
        shell: pwsh
        run: |
          snid --help
          snid-sage --help

      - name: Summary
        if: always()
        shell: bash
        run: |
          echo "### ${{ runner.os }} CLI Help Test 📝" >> "$GITHUB_STEP_SUMMARY"
          echo "- snid --help ✅" >> "$GITHUB_STEP_SUMMARY"
          echo "- snid-sage --help ✅" >> "$GITHUB_STEP_SUMMARY" 