"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["16367"],{39800:function(t,e,i){i.d(e,{Z:function(){return n}});i(40777),i(15519),i(64455),i(26086),i(6202);var a=function(t){var e=parseFloat(t);if(isNaN(e))throw new Error("".concat(t," is not a number"));return e};function n(t){if(!t)return null;try{if(t.endsWith("%"))return{w:100,h:a(t.substr(0,t.length-1))};var e=t.replace(":","x").split("x");return 0===e.length?null:1===e.length?{w:a(e[0]),h:1}:{w:a(e[0]),h:a(e[1])}}catch(i){}return null}},3370:function(t,e,i){var a,n,s,r,o,c,d,h,l=i(29694),_=i(75778),u=i(54982),p=i(54521),v=i(4490),m=i(20129),y=i(85297),f=i(53389),g=(i(12212),i(73742)),b=i(59048),C=i(7616),k=i(88245),I=i(20480),w=i(28105),S=i(15459),Z=i(36590),U=i(61447),O=(i(71150),i(39710),i(2394),i(81738),i(22960),i(54480),i(67398),i(25191)),R=i(39884),E=(i(12942),function(t){function e(){var t;(0,p.Z)(this,e);for(var i=arguments.length,a=new Array(i),n=0;n<i;n++)a[n]=arguments[n];return(t=(0,m.Z)(this,e,[].concat(a))).controls=!1,t.muted=!1,t.autoPlay=!1,t.playsInline=!1,t._candidatesList=[],t._startNegotiation=(0,_.Z)((0,l.Z)().m(function e(){var i,a,n,s,r;return(0,l.Z)().w(function(e){for(;;)switch(e.n){case 0:if(t._peerConnection){e.n=1;break}return e.a(2);case 1:return i={offerToReceiveAudio:!0,offerToReceiveVideo:!0},t._logEvent("start createOffer",i),e.n=2,t._peerConnection.createOffer(i);case 2:if(a=e.v,t._peerConnection){e.n=3;break}return e.a(2);case 3:return t._logEvent("end createOffer",a),t._logEvent("start setLocalDescription"),e.n=4,t._peerConnection.setLocalDescription(a);case 4:if(t._peerConnection&&t.entityid){e.n=5;break}return e.a(2);case 5:for(t._logEvent("end setLocalDescription"),n="";t._candidatesList.length;)(s=t._candidatesList.pop())&&(n+="a=".concat(s,"\r\n"));r=a.sdp+n,t._logEvent("start webRtcOffer",r);try{t._unsub=(0,U.T9)(t.hass,t.entityid,r,function(e){return t._handleOfferEvent(e)})}catch(o){t._error="Failed to start WebRTC stream: "+o.message,t._cleanUp()}case 6:return e.a(2)}},e)})),t._iceConnectionStateChanged=function(){var e,i;t._logEvent("ice connection state change",null===(e=t._peerConnection)||void 0===e?void 0:e.iceConnectionState),"failed"===(null===(i=t._peerConnection)||void 0===i?void 0:i.iceConnectionState)&&t._peerConnection.restartIce()},t._handleIceCandidate=function(e){var i,a,n;t.entityid&&null!==(i=e.candidate)&&void 0!==i&&i.candidate&&(t._logEvent("local ice candidate",null===(a=e.candidate)||void 0===a?void 0:a.candidate,null===(n=e.candidate)||void 0===n?void 0:n.sdpMLineIndex),t._sessionId?(0,U.r)(t.hass,t.entityid,t._sessionId,e.candidate.toJSON()):t._candidatesList.push(e.candidate))},t._addTrack=function(){var e=(0,_.Z)((0,l.Z)().m(function e(i){return(0,l.Z)().w(function(e){for(;;)switch(e.n){case 0:if(t._remoteStream){e.n=1;break}return e.a(2);case 1:if(t._remoteStream.addTrack(i.track),t.hasUpdated){e.n=2;break}return e.n=2,t.updateComplete;case 2:t._videoEl.srcObject=t._remoteStream;case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),t}return(0,y.Z)(e,t),(0,v.Z)(e,[{key:"render",value:function(){return this._error?(0,b.dy)(a||(a=(0,u.Z)(['<ha-alert alert-type="error">',"</ha-alert>"])),this._error):(0,b.dy)(n||(n=(0,u.Z)([' <video id="remote-stream" ?autoplay="','" .muted="','" ?playsinline="','" ?controls="','" poster="','" @loadeddata="','" style="','"></video> '])),this.autoPlay,this.muted,this.playsInline,this.controls,(0,O.o)(this.posterUrl),this._loadedData,(0,I.V)({height:null==this.aspectRatio?"100%":"auto",aspectRatio:this.aspectRatio,objectFit:this.fitMode}))}},{key:"connectedCallback",value:function(){(0,f.Z)(e,"connectedCallback",this,3)([]),this.hasUpdated&&this.entityid&&this._startWebRtc()}},{key:"disconnectedCallback",value:function(){(0,f.Z)(e,"disconnectedCallback",this,3)([]),this._cleanUp()}},{key:"willUpdate",value:function(t){(0,f.Z)(e,"willUpdate",this,3)([t]),t.has("entityid")&&this._startWebRtc()}},{key:"_startWebRtc",value:(r=(0,_.Z)((0,l.Z)().m(function t(){var e=this;return(0,l.Z)().w(function(t){for(;;)switch(t.n){case 0:if(this._cleanUp(),"undefined"!=typeof RTCPeerConnection){t.n=1;break}return this._error="WebRTC is not supported in this browser",(0,R.B)(this,"streams",{hasAudio:!1,hasVideo:!1}),t.a(2);case 1:if(this.hass&&this.entityid){t.n=2;break}return t.a(2);case 2:return this._error=void 0,this._startTimer(),this._logEvent("start clientConfig"),t.n=3,(0,U.z9)(this.hass,this.entityid);case 3:this._clientConfig=t.v,this._logEvent("end clientConfig",this._clientConfig),this._peerConnection=new RTCPeerConnection(this._clientConfig.configuration),this._clientConfig.dataChannel&&this._peerConnection.createDataChannel(this._clientConfig.dataChannel),this._peerConnection.onnegotiationneeded=this._startNegotiation,this._peerConnection.onicecandidate=this._handleIceCandidate,this._peerConnection.oniceconnectionstatechange=this._iceConnectionStateChanged,this._peerConnection.onsignalingstatechange=function(t){"stable"===t.target.signalingState?e._logEvent("ICE negotiation complete"):e._logEvent("Signaling state changed",t.target.signalingState)},this._remoteStream=new MediaStream,this._peerConnection.ontrack=this._addTrack,this._peerConnection.addTransceiver("audio",{direction:"recvonly"}),this._peerConnection.addTransceiver("video",{direction:"recvonly"});case 4:return t.a(2)}},t,this)})),function(){return r.apply(this,arguments)})},{key:"_handleOfferEvent",value:(s=(0,_.Z)((0,l.Z)().m(function t(e){var i,a,n,s=this;return(0,l.Z)().w(function(t){for(;;)switch(t.n){case 0:if(this.entityid){t.n=1;break}return t.a(2);case 1:if("session"===e.type&&(this._sessionId=e.session_id,this._candidatesList.forEach(function(t){return(0,U.r)(s.hass,s.entityid,e.session_id,t.toJSON())}),this._candidatesList=[]),"answer"===e.type&&(this._logEvent("answer",e.answer),this._handleAnswer(e)),"candidate"!==e.type){t.n=5;break}return this._logEvent("remote ice candidate",e.candidate),t.p=2,a=e.candidate.sdpMid||null!=e.candidate.sdpMLineIndex?new RTCIceCandidate(e.candidate):new RTCIceCandidate({candidate:e.candidate.candidate,sdpMid:"0"}),t.n=3,null===(i=this._peerConnection)||void 0===i?void 0:i.addIceCandidate(a);case 3:t.n=5;break;case 4:t.p=4,n=t.v,console.error(n);case 5:"error"===e.type&&(this._error="Failed to start WebRTC stream: "+e.message,this._cleanUp());case 6:return t.a(2)}},t,this,[[2,4]])})),function(t){return s.apply(this,arguments)})},{key:"_handleAnswer",value:(i=(0,_.Z)((0,l.Z)().m(function t(e){var i,a,n;return(0,l.Z)().w(function(t){for(;;)switch(t.n){case 0:if(null!==(i=this._peerConnection)&&void 0!==i&&i.signalingState&&!["stable","closed"].includes(this._peerConnection.signalingState)){t.n=1;break}return t.a(2);case 1:return a=new RTCSessionDescription({type:"answer",sdp:e.answer}),t.p=2,this._logEvent("start setRemoteDescription",a),t.n=3,this._peerConnection.setRemoteDescription(a);case 3:t.n=5;break;case 4:t.p=4,n=t.v,this._error="Failed to connect WebRTC stream: "+n.message,this._cleanUp();case 5:this._logEvent("end setRemoteDescription");case 6:return t.a(2)}},t,this,[[2,4]])})),function(t){return i.apply(this,arguments)})},{key:"_cleanUp",value:function(){var t;this._remoteStream&&(this._remoteStream.getTracks().forEach(function(t){t.stop()}),this._remoteStream=void 0);var e=this._videoEl;e&&(e.removeAttribute("src"),e.load()),this._peerConnection&&(this._peerConnection.close(),this._peerConnection.onnegotiationneeded=null,this._peerConnection.onicecandidate=null,this._peerConnection.oniceconnectionstatechange=null,this._peerConnection.onicegatheringstatechange=null,this._peerConnection.ontrack=null,this._peerConnection.onsignalingstatechange=null,this._peerConnection=void 0,this._logEvent("stopped"),this._stopTimer()),null===(t=this._unsub)||void 0===t||t.then(function(t){return t()}),this._unsub=void 0,this._sessionId=void 0,this._candidatesList=[]}},{key:"_loadedData",value:function(){var t=this._videoEl.srcObject,e={hasAudio:Boolean(null==t?void 0:t.getAudioTracks().length),hasVideo:Boolean(null==t?void 0:t.getVideoTracks().length)};(0,R.B)(this,"load"),(0,R.B)(this,"streams",e),this._logEvent("loadedData",e),this._stopTimer()}},{key:"_startTimer",value:function(){}},{key:"_stopTimer",value:function(){}},{key:"_logEvent",value:function(t){}}]);var i,s,r}(b.oi));E.styles=(0,b.iv)(s||(s=(0,u.Z)([":host,video{display:block}video{width:100%;max-height:var(--video-max-height,calc(100vh - 97px))}"]))),(0,g.__decorate)([(0,C.Cb)({attribute:!1})],E.prototype,"hass",void 0),(0,g.__decorate)([(0,C.Cb)()],E.prototype,"entityid",void 0),(0,g.__decorate)([(0,C.Cb)({attribute:!1})],E.prototype,"aspectRatio",void 0),(0,g.__decorate)([(0,C.Cb)({attribute:!1})],E.prototype,"fitMode",void 0),(0,g.__decorate)([(0,C.Cb)({type:Boolean,attribute:"controls"})],E.prototype,"controls",void 0),(0,g.__decorate)([(0,C.Cb)({type:Boolean,attribute:"muted"})],E.prototype,"muted",void 0),(0,g.__decorate)([(0,C.Cb)({type:Boolean,attribute:"autoplay"})],E.prototype,"autoPlay",void 0),(0,g.__decorate)([(0,C.Cb)({type:Boolean,attribute:"playsinline"})],E.prototype,"playsInline",void 0),(0,g.__decorate)([(0,C.Cb)({attribute:"poster-url"})],E.prototype,"posterUrl",void 0),(0,g.__decorate)([(0,C.SB)()],E.prototype,"_error",void 0),(0,g.__decorate)([(0,C.IO)("#remote-stream")],E.prototype,"_videoEl",void 0),E=(0,g.__decorate)([(0,C.Mo)("ha-web-rtc-player")],E);var V="mjpeg",M=function(t){function e(){var t;(0,p.Z)(this,e);for(var i=arguments.length,a=new Array(i),n=0;n<i;n++)a[n]=arguments[n];return(t=(0,m.Z)(this,e,[].concat(a))).controls=!1,t.muted=!1,t.allowExoPlayer=!1,t._connected=!1,t._streams=(0,w.Z)(function(t,e,i){if(!t)return[];if(0===t.length)return[{type:V,visible:!0}];if(1===t.length)return t[0]===U.kU&&!1===(null==e?void 0:e.hasVideo)||t[0]===U.jU&&!1===(null==i?void 0:i.hasVideo)?[{type:V,visible:!0}]:[{type:t[0],visible:!0}];if(e&&i)return e.hasVideo&&e.hasAudio&&!i.hasAudio?[{type:U.kU,visible:!0}]:i.hasVideo?[{type:U.jU,visible:!0}]:[{type:V,visible:!0}];if((null==e?void 0:e.hasVideo)!==(null==i?void 0:i.hasVideo)){if(null!=e&&e.hasVideo)return[{type:U.kU,visible:!0},{type:U.jU,visible:!1}];if(!1===(null==e?void 0:e.hasVideo))return[{type:U.jU,visible:!0}];if(null!=i&&i.hasVideo)return[{type:U.jU,visible:!0},{type:U.kU,visible:!1}];if(!1===(null==i?void 0:i.hasVideo))return[{type:U.kU,visible:!0}]}return[{type:U.kU,visible:!0},{type:U.jU,visible:!1}]}),t}return(0,y.Z)(e,t),(0,v.Z)(e,[{key:"willUpdate",value:function(t){var e;t.has("stateObj")&&this.stateObj&&(null===(e=t.get("stateObj"))||void 0===e?void 0:e.entity_id)!==this.stateObj.entity_id&&(this._getCapabilities(),this._getPosterUrl())}},{key:"connectedCallback",value:function(){(0,f.Z)(e,"connectedCallback",this,3)([]),this._connected=!0}},{key:"disconnectedCallback",value:function(){(0,f.Z)(e,"disconnectedCallback",this,3)([]),this._connected=!1}},{key:"render",value:function(){var t,e=this;if(!this.stateObj)return b.Ld;var i=this._streams(null===(t=this._capabilities)||void 0===t?void 0:t.frontend_stream_types,this._hlsStreams,this._webRtcStreams);return(0,b.dy)(r||(r=(0,u.Z)(["",""])),(0,k.r)(i,function(t){return t.type+e.stateObj.entity_id},function(t){return e._renderStream(t)}))}},{key:"_renderStream",value:function(t){return this.stateObj?t.type===V?(0,b.dy)(o||(o=(0,u.Z)(['<img .src="','" style="','" alt="','">'])),this._connected?(0,U.nk)(this.stateObj):this._posterUrl||"",(0,I.V)({aspectRatio:this.aspectRatio,objectFit:this.fitMode}),"Preview of the ".concat((0,S.C)(this.stateObj)," camera.")):t.type===U.kU?(0,b.dy)(c||(c=(0,u.Z)(['<ha-hls-player autoplay playsinline .allowExoPlayer="','" .muted="','" .controls="','" .hass="','" .entityid="','" .posterUrl="','" @streams="','" class="','" .aspectRatio="','" .fitMode="','"></ha-hls-player>'])),this.allowExoPlayer,this.muted,this.controls,this.hass,this.stateObj.entity_id,this._posterUrl,this._handleHlsStreams,t.visible?"":"hidden",this.aspectRatio,this.fitMode):t.type===U.jU?(0,b.dy)(d||(d=(0,u.Z)(['<ha-web-rtc-player autoplay playsinline .muted="','" .controls="','" .hass="','" .entityid="','" .posterUrl="','" @streams="','" class="','" .aspectRatio="','" .fitMode="','"></ha-web-rtc-player>'])),this.muted,this.controls,this.hass,this.stateObj.entity_id,this._posterUrl,this._handleWebRtcStreams,t.visible?"":"hidden",this.aspectRatio,this.fitMode):b.Ld:b.Ld}},{key:"_getCapabilities",value:(a=(0,_.Z)((0,l.Z)().m(function t(){return(0,l.Z)().w(function(t){for(;;)switch(t.n){case 0:if(this._capabilities=void 0,this._hlsStreams=void 0,this._webRtcStreams=void 0,(0,Z.e)(this.stateObj,U.qW)){t.n=1;break}return this._capabilities={frontend_stream_types:[]},t.a(2);case 1:return t.n=2,(0,U.ou)(this.hass,this.stateObj.entity_id);case 2:this._capabilities=t.v;case 3:return t.a(2)}},t,this)})),function(){return a.apply(this,arguments)})},{key:"_getPosterUrl",value:(i=(0,_.Z)((0,l.Z)().m(function t(){return(0,l.Z)().w(function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,(0,U.i4)(this.hass,this.stateObj.entity_id,this.clientWidth,this.clientHeight);case 1:this._posterUrl=t.v,t.n=3;break;case 2:t.p=2,t.v,this._posterUrl=void 0;case 3:return t.a(2)}},t,this,[[0,2]])})),function(){return i.apply(this,arguments)})},{key:"_handleHlsStreams",value:function(t){this._hlsStreams=t.detail}},{key:"_handleWebRtcStreams",value:function(t){this._webRtcStreams=t.detail}}]);var i,a}(b.oi);M.styles=(0,b.iv)(h||(h=(0,u.Z)([":host,img{display:block}img{width:100%}ha-web-rtc-player{width:100%;height:100%}ha-hls-player{width:100%;height:100%}.hidden{display:none}"]))),(0,g.__decorate)([(0,C.Cb)({attribute:!1})],M.prototype,"hass",void 0),(0,g.__decorate)([(0,C.Cb)({attribute:!1})],M.prototype,"stateObj",void 0),(0,g.__decorate)([(0,C.Cb)({attribute:!1})],M.prototype,"aspectRatio",void 0),(0,g.__decorate)([(0,C.Cb)({attribute:!1})],M.prototype,"fitMode",void 0),(0,g.__decorate)([(0,C.Cb)({type:Boolean,attribute:"controls"})],M.prototype,"controls",void 0),(0,g.__decorate)([(0,C.Cb)({type:Boolean,attribute:"muted"})],M.prototype,"muted",void 0),(0,g.__decorate)([(0,C.Cb)({type:Boolean,attribute:"allow-exoplayer"})],M.prototype,"allowExoPlayer",void 0),(0,g.__decorate)([(0,C.SB)()],M.prototype,"_posterUrl",void 0),(0,g.__decorate)([(0,C.SB)()],M.prototype,"_connected",void 0),(0,g.__decorate)([(0,C.SB)()],M.prototype,"_capabilities",void 0),(0,g.__decorate)([(0,C.SB)()],M.prototype,"_hlsStreams",void 0),(0,g.__decorate)([(0,C.SB)()],M.prototype,"_webRtcStreams",void 0),M=(0,g.__decorate)([(0,C.Mo)("ha-camera-stream")],M)},42236:function(t,e,i){i.d(e,{U:function(){return a}});i(12212);var a=function(t){return"/api/image_proxy/".concat(t.entity_id,"?token=").concat(t.attributes.access_token,"&state=").concat(t.state)}},12723:function(t,e,i){i.a(t,async function(t,e){try{var a,n,s,r,o,c,d=i(29694),h=i(75778),l=i(54982),_=i(54521),u=i(4490),p=i(20129),v=i(85297),m=i(53389),y=(i(12212),i(25518),i(39710),i(81738),i(94814),i(25718),i(54480),i(56389),i(73742)),f=i(59048),g=i(7616),b=i(31733),C=i(20480),k=i(40141),I=i(44272),w=i(39800),S=(i(3370),i(6514)),Z=i(61447),U=i(16230),O=i(42236),R=t([S]);S=(R.then?(await R)():R)[0];var E=function(t){function e(){var t;(0,_.Z)(this,e);for(var i=arguments.length,a=new Array(i),n=0;n<i;n++)a[n]=arguments[n];return(t=(0,p.Z)(this,e,[].concat(a)))._imageVisible=!1,t._ratio=null,t}return(0,v.Z)(e,t),(0,u.Z)(e,[{key:"connectedCallback",value:function(){(0,m.Z)(e,"connectedCallback",this,3)([]),void 0===this._loadState&&(this._loadState=1),this.cameraImage&&"live"!==this.cameraView&&this._startIntersectionObserverOrUpdates()}},{key:"disconnectedCallback",value:function(){(0,m.Z)(e,"disconnectedCallback",this,3)([]),this._stopUpdateCameraInterval(),this._stopIntersectionObserver(),this._imageVisible=void 0}},{key:"handleIntersectionCallback",value:function(t){this._imageVisible=t[0].isIntersecting}},{key:"willUpdate",value:function(t){if(t.has("hass")){var e=t.get("hass");this._shouldStartCameraUpdates(e)?this._startIntersectionObserverOrUpdates():this.hass.connected||(this._stopUpdateCameraInterval(),this._stopIntersectionObserver(),this._loadState=1,this._cameraImageSrc=void 0,this._loadedImageSrc=void 0)}t.has("_imageVisible")&&(this._imageVisible?this._shouldStartCameraUpdates()&&this._startUpdateCameraInterval():this._stopUpdateCameraInterval()),t.has("aspectRatio")&&(this._ratio=this.aspectRatio?(0,w.Z)(this.aspectRatio):null),1!==this._loadState||this.cameraImage||(this._loadState=2)}},{key:"render",value:function(){if(!this.hass)return f.Ld;var t,e,i=Boolean(this._ratio&&this._ratio.w>0&&this._ratio.h>0),c=this.entity?this.hass.states[this.entity]:void 0,d=c?c.state:U.nZ,h=!this.stateImage;if(this.cameraImage)"live"===this.cameraView?e=this.hass.states[this.cameraImage]:t=this._cameraImageSrc;else if(this.stateImage){var _=this.stateImage[d];_?t=_:(t=this.image,h=!0)}else t=this.darkModeImage&&this.hass.themes.darkMode?this.darkModeImage:c&&"image"===(0,I.M)(c.entity_id)?(0,O.U)(c):this.image;t&&(t=this.hass.hassUrl(t));var u=this.filter||"";(this.hass.themes.darkMode&&this.darkModeFilter&&(u+=this.darkModeFilter),this.stateFilter&&this.stateFilter[d]&&(u+=this.stateFilter[d]),!u&&this.entity)&&(u=(!c||k.tj.includes(d))&&h?"grayscale(100%)":"");return(0,f.dy)(a||(a=(0,l.Z)([' <div style="','" class="container ','"> '," "," </div> "])),(0,C.V)({paddingBottom:i?"".concat((100*this._ratio.h/this._ratio.w).toFixed(2),"%"):void 0===this._lastImageHeight?"56.25%":void 0,backgroundImage:i&&this._loadedImageSrc?'url("'.concat(this._loadedImageSrc,'")'):void 0,filter:2===this._loadState||"live"===this.cameraView?u:void 0}),(0,b.$)({ratio:i||void 0===this._lastImageHeight,contain:"contain"===this.fitMode,fill:"fill"===this.fitMode}),this.cameraImage&&"live"===this.cameraView?(0,f.dy)(n||(n=(0,l.Z)([' <ha-camera-stream muted .hass="','" .stateObj="','" .fitMode="','" .aspectRatio="','" @load="','"></ha-camera-stream> '])),this.hass,e,this.fitMode,this._ratio?this._ratio.w/this._ratio.h:void 0,this._onVideoLoad):void 0===t?f.Ld:(0,f.dy)(s||(s=(0,l.Z)([' <img id="image" src="','" alt="','" @error="','" @load="','" style="','"> '])),t,this.entity||"",this._onImageError,this._onImageLoad,(0,C.V)({display:i||2===this._loadState?"block":"none"})),3===this._loadState?(0,f.dy)(r||(r=(0,l.Z)(['<div id="brokenImage" style="','"></div>'])),(0,C.V)({height:i?void 0:"".concat(this._lastImageHeight,"px")||"100%"})):"live"===this.cameraView||void 0!==t&&1!==this._loadState?"":(0,f.dy)(o||(o=(0,l.Z)(['<div class="progress-container" style="','"> <ha-spinner class="render-spinner" size="small"></ha-spinner> </div>'])),(0,C.V)({height:i?void 0:"".concat(this._lastImageHeight,"px")||"100%"})))}},{key:"_shouldStartCameraUpdates",value:function(t){return!(t&&t.connected===this.hass.connected||!this.hass.connected||"live"===this.cameraView)}},{key:"_startIntersectionObserverOrUpdates",value:function(){"IntersectionObserver"in window?(this._intersectionObserver||(this._intersectionObserver=new IntersectionObserver(this.handleIntersectionCallback.bind(this))),this._intersectionObserver.observe(this)):(this._imageVisible=!0,this._startUpdateCameraInterval())}},{key:"_stopIntersectionObserver",value:function(){this._intersectionObserver&&this._intersectionObserver.disconnect()}},{key:"_startUpdateCameraInterval",value:function(){var t=this;this._stopUpdateCameraInterval(),this._updateCameraImageSrc(),this.cameraImage&&this.isConnected&&(this._cameraUpdater=window.setInterval(function(){return t._updateCameraImageSrcAtInterval()},1e4))}},{key:"_stopUpdateCameraInterval",value:function(){this._cameraUpdater&&(clearInterval(this._cameraUpdater),this._cameraUpdater=void 0)}},{key:"_onImageError",value:function(){this._loadState=3}},{key:"_onImageLoad",value:(g=(0,h.Z)((0,d.Z)().m(function t(e){var i;return(0,d.Z)().w(function(t){for(;;)switch(t.n){case 0:return this._loadState=2,i=e.target,this._ratio&&this._ratio.w>0&&this._ratio.h>0&&(this._loadedImageSrc=i.src),t.n=1,this.updateComplete;case 1:this._lastImageHeight=i.offsetHeight;case 2:return t.a(2)}},t,this)})),function(t){return g.apply(this,arguments)})},{key:"_onVideoLoad",value:(y=(0,h.Z)((0,d.Z)().m(function t(e){var i;return(0,d.Z)().w(function(t){for(;;)switch(t.n){case 0:return this._loadState=2,i=e.currentTarget,t.n=1,this.updateComplete;case 1:this._lastImageHeight=i.offsetHeight;case 2:return t.a(2)}},t,this)})),function(t){return y.apply(this,arguments)})},{key:"_updateCameraImageSrcAtInterval",value:(c=(0,h.Z)((0,d.Z)().m(function t(){return(0,d.Z)().w(function(t){for(;;)if(0===t.n)return 1===this._loadState&&this._onImageError(),t.a(2,this._updateCameraImageSrc())},t,this)})),function(){return c.apply(this,arguments)})},{key:"_updateCameraImageSrc",value:(i=(0,h.Z)((0,d.Z)().m(function t(){var e,i,a;return(0,d.Z)().w(function(t){for(;;)switch(t.n){case 0:if(this.hass&&this.cameraImage){t.n=1;break}return t.a(2);case 1:if(this.hass.states[this.cameraImage]){t.n=2;break}return this._onImageError(),t.a(2);case 2:return e=this.clientWidth||640,i=Math.ceil(e*devicePixelRatio),this._lastImageHeight?a=Math.ceil(this._lastImageHeight*devicePixelRatio):this._ratio&&this._ratio.w>0&&this._ratio.h>0?a=Math.ceil(i*(this._ratio.h/this._ratio.w)):(i*=2,a=Math.ceil(.5625*i)),t.n=3,(0,Z.i4)(this.hass,this.cameraImage,i,a);case 3:this._cameraImageSrc=t.v,void 0===this._cameraImageSrc&&this._onImageError();case 4:return t.a(2)}},t,this)})),function(){return i.apply(this,arguments)})}]);var i,c,y,g}(f.oi);E.styles=(0,f.iv)(c||(c=(0,l.Z)([':host{display:block}.container{transition:filter .2s linear;height:100%}img{display:block;height:100%;width:100%;object-fit:cover}ha-camera-stream{display:block;height:100%;width:100%}.progress-container{display:flex;justify-content:center;align-items:center}.ratio{position:relative;width:100%;height:0;background-position:center;background-size:cover}.ratio.fill{background-size:100% 100%}.ratio.contain{background-size:contain;background-repeat:no-repeat}.fill img{object-fit:fill}.contain img{object-fit:contain}.ratio div,.ratio img{position:absolute;top:0;left:0;width:100%;height:100%}.ratio img{visibility:hidden}#brokenImage{background:grey url("/static/images/image-broken.svg") center/36px no-repeat}']))),(0,y.__decorate)([(0,g.Cb)({attribute:!1})],E.prototype,"hass",void 0),(0,y.__decorate)([(0,g.Cb)()],E.prototype,"entity",void 0),(0,y.__decorate)([(0,g.Cb)()],E.prototype,"image",void 0),(0,y.__decorate)([(0,g.Cb)({attribute:!1})],E.prototype,"stateImage",void 0),(0,y.__decorate)([(0,g.Cb)({attribute:!1})],E.prototype,"cameraImage",void 0),(0,y.__decorate)([(0,g.Cb)({attribute:!1})],E.prototype,"cameraView",void 0),(0,y.__decorate)([(0,g.Cb)({attribute:!1})],E.prototype,"aspectRatio",void 0),(0,y.__decorate)([(0,g.Cb)()],E.prototype,"filter",void 0),(0,y.__decorate)([(0,g.Cb)({attribute:!1})],E.prototype,"stateFilter",void 0),(0,y.__decorate)([(0,g.Cb)({attribute:!1})],E.prototype,"darkModeImage",void 0),(0,y.__decorate)([(0,g.Cb)({attribute:!1})],E.prototype,"darkModeFilter",void 0),(0,y.__decorate)([(0,g.Cb)({attribute:"fit-mode",type:String})],E.prototype,"fitMode",void 0),(0,y.__decorate)([(0,g.SB)()],E.prototype,"_imageVisible",void 0),(0,y.__decorate)([(0,g.SB)()],E.prototype,"_loadState",void 0),(0,y.__decorate)([(0,g.SB)()],E.prototype,"_cameraImageSrc",void 0),(0,y.__decorate)([(0,g.SB)()],E.prototype,"_loadedImageSrc",void 0),(0,y.__decorate)([(0,g.SB)()],E.prototype,"_lastImageHeight",void 0),E=(0,y.__decorate)([(0,g.Mo)("hui-image")],E),e()}catch(V){e(V)}})}}]);
//# sourceMappingURL=16367.13727fa381d9e815.js.map