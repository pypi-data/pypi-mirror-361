spec:
  inputs:
    addon-name:
      description: "The path of the addon you want to build"
    addon-parent_path:
      default: "."
      description: "The default path where the addon is"
    stage:
      description: "The stage where to add this job"
      default: deploy
    tag:
      default: "lint"
      description: "The name of the tag for this job"
---
# This module is only available for the container image
include:
  - local: templates/build.yml
    inputs:
      stage: "$[[ inputs.stage ]]"
      tag: "$[[ inputs.tag ]]"
      addon-name: "$[[ inputs.addon-name ]]"
      addon-parent_path: "$[[ inputs.addon-parent_path ]]"
  - local: templates/upload-gitlab.yml
    rules:
      - if: $CI_COMMIT_REF_PROTECTED == "true" && $CI_SERVER_HOST
    inputs:
      stage: "$[[ inputs.stage ]]"
      tag: "$[[ inputs.tag ]]"
      addon-name: "$[[ inputs.addon-name ]]"
      addon-parent_path: "$[[ inputs.addon-parent_path ]]"
      dependencies: [ "build:addon:$[[ inputs.addon-name ]]" ]
