import"../chunks/CWj6FrbW.js";import{o as rt}from"../chunks/c6gPyZYp.js";import{p as st,s as o,a as j,u as q,b as m,f as G,c as at,g as e,i as p,d as le,e as r,t as ot,n as nt,j as ie,r as ue,l as lt}from"../chunks/C8SLBV5c.js";import{s as it}from"../chunks/DoZZLr3H.js";import{i as w}from"../chunks/hCS139x6.js";import{g as U,u as ut,e as dt,i as ct}from"../chunks/C0O8QyND.js";import{f as L,a as O,c as Me}from"../chunks/CkybfRqV.js";import{s as Ae}from"../chunks/DVWfzEL5.js";import{F as _t,b as ve,S as ft,c as vt,e as ge,t as gt,h as ht,f as Be,r as mt}from"../chunks/DQxlGI9A.js";import{A as W,T as Ie}from"../chunks/t5k47KUb.js";import{R as pt}from"../chunks/Bog2sjMX.js";import{B as bt}from"../chunks/DHY4M7zv.js";import{g as xt}from"../chunks/CqS7hfz2.js";var yt=L('<label class="col-6 col-md-2">Subdivision</label> <div class="col-4 col-md-2"><!></div>',1),wt=L('<div class="row mb-2"><label class="col-6 col-md-3 fw-medium fs-4"> </label> <div class="col-4 col-md-2"><!></div> <!></div>'),Ct=L("<h3>Technologies (for Capex/Opex)</h3> <!> <!> <!> <!> <!>",1),St=L("<!> <!> <!>",1),jt=L("<!> <!> <!>",1),Ot=L("<!> <!>",1),Tt=L('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),Pt=L('<div class="text-center">No data with this selection.</div>'),kt=L('<div class="text-center">Please select at least one year.</div>'),Et=L('<h1 class="mt-2 mb-4">The Transition Pathway &ndash; Costs</h1> <!> <div class="mt-4"><!></div>',1);function qt(Re,Ye){st(Ye,!0);const u="Techology / Carrier",Se=" (Capex)",je=" (Opex)",ze="Capex",Ne="Opex",Ve="Carrier",qe="Shed Demand";let Oe=o(j([])),Te=o(j([])),Z=o(j([]));const Pe=["Location",u];let de=o(null),ee=o(null),T=o(null),P=o(null),te=o(null),ce=o(j({})),re=o(j([])),a=o(null),H=o(j([])),Ge=!1,k=o(j([])),E=o(j([])),M=o(j([])),A=o(j([])),B=o(j([])),_e=o("Location"),he=o(!0),me=o(!0),pe=o(!0),be=o(!0),xe=o(!0),se=o(!1),ae=o(!1),D=j({capex:{title:"Capex",show:!0,subdivision:!1,show_subdivision:!0,label:ze},opex:{title:"Opex",show:!0,subdivision:!1,show_subdivision:!0,label:Ne},carrier:{title:"Carrier",show:!0,subdivision:!1,show_subdivision:!0,label:Ve},shed_demand:{title:"Shed Demand",show:!0,subdivision:!1,show_subdivision:!0,label:qe},carbon_emission:{title:"Carbon Emissions",show:!0,subdivision:!1,show_subdivision:!1}}),He=p(()=>{if(!e(a))return"";let t=e(a).solution_name.split(".");return[t[t.length-1],e(a).scenario_name,"costs"].join("_")}),Je=p(()=>e(R).length>0?e(ce)[e(R)[0]]||"":e(I).length>0?e(ce)[e(I)[0]]||"":e(Y).length>0&&e(ce)[e(Y)[0]]||""),Ke=p(()=>({responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:`Costs [${e(Je)}]`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}})),ye=p(()=>!e(T)||!e(P)?new Set:new Set([...e(T).data.map(t=>t[u])||[],...e(P).data.map(t=>t[u])||[]])),I=p(()=>!e(a)||!e(T)||!e(P)?[]:e(a).detail.system.set_transport_technologies.filter(t=>e(ye).has(t))),R=p(()=>!e(a)||!e(T)||!e(P)?[]:ge(e(a).detail.system.set_conversion_technologies.filter(t=>e(ye).has(t)))),Y=p(()=>!e(a)||!e(T)||!e(P)?[]:ge(e(a).detail.system.set_storage_technologies.filter(t=>e(ye).has(t)))),J=p(()=>{var t;return!e(a)||!((t=e(ee))!=null&&t.data)?[]:ge(e(ee).data.map(l=>l[u]))}),K=p(()=>{var t;return!e(a)||!((t=e(te))!=null&&t.data)?[]:ge(e(te).data.map(l=>l[u]))}),we=p(()=>e(a)?Object.keys(e(a).detail.edges).concat(e(a).detail.system.set_nodes):[]);q(()=>{e(I),le(()=>{e(he)&&e(T)&&e(P)?(r(he,!1),e(I).length>0&&e(M).length===0&&r(M,e(I),!0)):e(I).length>0&&r(M,e(I),!0)})}),q(()=>{e(R),le(()=>{e(me)&&e(T)&&e(P)?(r(me,!1),e(R).length>0&&e(B).length===0&&r(B,e(R),!0)):e(R).length>0&&r(B,e(R),!0)})}),q(()=>{e(Y),le(()=>{e(pe)&&e(T)&&e(P)?(r(pe,!1),e(Y).length>0&&e(A).length===0&&r(A,e(Y),!0)):e(Y).length>0&&r(A,e(Y),!0)})}),q(()=>{e(J),le(()=>{e(be)&&e(ee)?(r(be,!1),e(J).length>0&&e(k).length===0&&r(k,e(J),!0)):e(J).length>0&&r(k,e(J),!0)})}),q(()=>{e(K),le(()=>{e(xe)&&e(te)?(r(xe,!1),e(K).length>0&&e(E).length===0&&r(E,e(K),!0)):e(K).length>0&&r(E,e(K),!0)})}),q(()=>{r(re,e(we),!0)}),q(()=>{r(H,e(Z),!0)}),rt(()=>{var t,l,_,c,v;Object.entries(D).forEach(([b,n])=>{let x=U(b+"_show"),f=U(b+"_subdivision");n.show=x!==null?x==="true":n.show,n.subdivision=f!==null?f==="true":n.subdivision}),r(M,((t=U("transport_technologies"))==null?void 0:t.split(","))||[],!0),r(he,!0),r(B,((l=U("conversion_technologies"))==null?void 0:l.split(","))||[],!0),r(me,!0),r(A,((_=U("storage_technologies"))==null?void 0:_.split(","))||[],!0),r(pe,!0),r(k,((c=U("cost_carriers"))==null?void 0:c.split(","))||[],!0),r(be,!0),r(E,((v=U("demand_carriers"))==null?void 0:v.split(","))||[],!0),r(xe,!0)}),q(()=>{e(M),e(B),e(A),e(k),e(E),Object.values(D).forEach(t=>{t.show,t.subdivision}),ot().then(()=>{let t={transport_technologies:e(M).join(","),conversion_technologies:e(B).join(","),storage_technologies:e(A).join(","),cost_carriers:e(k).join(","),demand_carriers:e(E).join(",")};Object.entries(D).forEach(([l,_])=>{t[l+"_show"]=_.show?"true":"false",t[l+"_subdivision"]=_.subdivision?"true":"false"}),ut(t)})});function Qe(){e(a)&&Ue()}function fe(t,l){return!t||!t.data||(t.data=t.data.map(_=>l.reduce((c,[v,b])=>{if(!(v in _))return c;const{[v]:n,...x}=c;return{...x,[b]:n}},_))),t}async function Ue(){var b;if(!e(a))return;r(ae,!0);let[t,l,_,c,v]=await Promise.all(["capex_yearly","opex_yearly","cost_carbon_emissions_total","cost_carrier","cost_shed_demand"].map(n=>ht(e(a).solution_name,xt(n,e(a).version),e(a).scenario_name,e(a).detail.system.reference_year,e(a).detail.system.interval_between_years)));r(T,fe(t.data,[["technology",u]]),!0),r(P,fe(l.data,[["technology",u]]),!0),r(de,_.data,!0),r(ee,fe(c.data,[["node","location"],["carrier",u]]),!0),r(te,fe(v.data,[["node","location"],["carrier",u]]),!0),(b=t.unit)!=null&&b.data&&r(ce,Object.fromEntries(t.unit.data.map(n=>[n.technology,n[0]||n.units])),!0),r(ae,!1)}let Ce=p(()=>{var f,d,X,F,C;let t=[...e(B).concat(e(A)).concat(e(M)).flatMap(s=>[s+Se,s+je]),...e(k),...e(E)];const l=[{key:"capex",data:(((f=e(T))==null?void 0:f.data)||[]).map(s=>({...s,[u]:s[u]+Se}))},{key:"opex",data:(((d=e(P))==null?void 0:d.data)||[]).map(s=>({...s,[u]:s[u]+je}))},{key:"carrier",data:(((X=e(ee))==null?void 0:X.data)||[]).filter(s=>e(k).includes(s[u]))},{key:"shed_demand",data:(((F=e(te))==null?void 0:F.data)||[]).filter(s=>e(E).includes(s[u]))||null}];let _=l.flatMap(({key:s,data:y})=>!D[s].show||!y?[]:D[s].subdivision?y:Be(y,{location:e(re)},{[u]:t},[],!1).map(z=>({...z.data,location:z.label,[u]:D[s].label})));l.forEach(({key:s})=>{D[s].label&&t.push(D[s].label)});let c,v;e(_e)==u?(c={location:e(we)},v={[u]:t}):(c={[u]:t},v={location:e(re)});let b=e(Z).filter(s=>!e(H).includes(s));mt();let n=Be(_,c,v,b,Ge),x=[];return(C=e(de))!=null&&C.data&&e(de).data.length>0&&D.carbon_emission.show&&(x=[{label:"Total Carbon Costs",data:e(de).data[0],type:"bar"}]),[...n,...x]});var ke=Et(),Ee=m(G(ke),2);_t(Ee,{children:(t,l)=>{var _=Ot(),c=G(_);ve(c,{title:"Solution Selection",children:(n,x)=>{const f=p(()=>e(ae)||e(se));ft(n,{solution_selected:Qe,get disabled(){return e(f)},get carriers(){return e(Oe)},set carriers(d){r(Oe,d,!0)},get nodes(){return e(Te)},set nodes(d){r(Te,d,!0)},get years(){return e(Z)},set years(d){r(Z,d,!0)},get selected_solution(){return e(a)},set selected_solution(d){r(a,d,!0)},get loading(){return e(se)},set loading(d){r(se,d,!0)}})}});var v=m(c,2);{var b=n=>{var x=jt(),f=G(x);ve(f,{title:"Cost Selection",children:(F,C)=>{var s=Me(),y=G(s);dt(y,17,()=>Object.values(D),ct,(z,S,N)=>{var V=wt(),g=ie(V);Ae(g,"for","variables"+N);var $=ie(g,!0);ue(g);var Q=m(g,2),oe=ie(Q);Ie(oe,{formId:"variables"+N,get value(){return e(S).show},set value(h){e(S).show=h}}),ue(Q);var ne=m(Q,2);{var i=h=>{var Fe=yt(),$e=G(Fe);Ae($e,"for","subdivision"+N);var Le=m($e,2),et=ie(Le);Ie(et,{formId:"subdivision"+N,get value(){return e(S).subdivision},set value(tt){e(S).subdivision=tt}}),ue(Le),O(h,Fe)};w(ne,h=>{e(S).show&&e(S).show_subdivision&&h(i)})}ue(V),lt(()=>it($,e(S).title)),O(z,V)}),O(F,s)}});var d=m(f,2);ve(d,{title:"Technology Selection",children:(F,C)=>{var s=Ct(),y=m(G(s),2);{var z=i=>{W(i,{label:"Transport",get elements(){return e(I)},get value(){return e(M)},set value(h){r(M,h,!0)}})};w(y,i=>{e(I).length>0&&i(z)})}var S=m(y,2);{var N=i=>{W(i,{label:"Storage",get elements(){return e(Y)},get value(){return e(A)},set value(h){r(A,h,!0)}})};w(S,i=>{e(Y).length>0&&i(N)})}var V=m(S,2);{var g=i=>{W(i,{label:"Conversion",get elements(){return e(R)},get value(){return e(B)},set value(h){r(B,h,!0)}})};w(V,i=>{e(R).length>0&&i(g)})}var $=m(V,2);{var Q=i=>{W(i,{label:"Cost of Carrier",get elements(){return e(J)},get value(){return e(k)},set value(h){r(k,h,!0)}})};w($,i=>{e(J).length>0&&i(Q)})}var oe=m($,2);{var ne=i=>{W(i,{label:"Shed Demand",get elements(){return e(K)},get value(){return e(E)},set value(h){r(E,h,!0)}})};w(oe,i=>{e(K).length>0&&i(ne)})}O(F,s)}});var X=m(d,2);ve(X,{title:"Data Selection",children:(F,C)=>{var s=St(),y=G(s);vt(y,{label:"Aggregation",content:($,Q=nt)=>{const oe=p(()=>gt(Pe));pt($,{get formId(){return Q()},get options(){return e(oe)},get value(){return e(_e)},set value(ne){r(_e,ne,!0)}})}});var z=m(y,2);{var S=g=>{W(g,{label:"Location",get elements(){return e(we)},get value(){return e(re)},set value($){r(re,$,!0)}})};w(z,g=>{e(_e)==Pe[1]&&g(S)})}var N=m(z,2);{var V=g=>{W(g,{label:"Year",get elements(){return e(Z)},get value(){return e(H)},set value($){r(H,$,!0)}})};w(N,g=>{e(H)&&g(V)})}O(F,s)}}),O(n,x)};w(v,n=>{!e(ae)&&!e(se)&&e(T)&&e(a)!=null&&n(b)})}O(t,_)}});var De=m(Ee,2),We=ie(De);{var Xe=t=>{var l=Tt();O(t,l)},Ze=(t,l)=>{{var _=c=>{var v=Me(),b=G(v);{var n=f=>{var d=Pt();O(f,d)},x=(f,d)=>{{var X=C=>{var s=kt();O(C,s)},F=C=>{const s=p(()=>e(H).map(y=>y.toString()));bt(C,{type:"line",get options(){return e(Ke)},get datasets(){return e(Ce)},get labels(){return e(s)},get plot_name(){return e(He)}})};w(f,C=>{e(H).length==0?C(X):C(F,!1)},d)}};w(b,f=>{e(Ce).length==0||e(Ce)[0].data.length==0?f(n):f(x,!1)})}O(c,v)};w(t,c=>{e(a)!=null&&c(_)},l)}};w(We,t=>{e(se)||e(ae)?t(Xe):t(Ze,!1)})}ue(De),O(Re,ke),at()}export{qt as component};
