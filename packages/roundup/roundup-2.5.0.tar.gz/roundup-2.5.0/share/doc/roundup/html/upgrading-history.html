
<!DOCTYPE html>




<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Upgrading versions before 1.5.0 &mdash; Roundup 2.5.0 documentation</title>
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    './',
          VERSION:     '2.5.0',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script type="text/javascript" src="_static/searchtools.js"></script>
    <script type="text/javascript" src="_static/sphinx_highlight.js"></script>
    <script type="text/javascript" src="_static/tabs.js"></script>
    
    <link rel="stylesheet" href="_static/NO_basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/style.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/style.css" type="text/css" />
    <link rel="stylesheet" href="_static/tabs.css" type="text/css" />
    <!-- https://github.com/sphinx-doc/sphinx/issues/11699 means a
         duplicate viewport tag -->
    <meta name="viewport" content="width=device-width, initial-scale=1" />

      <meta name="description"
        content="Page upgrading-history in documentation on the Roundup issue tracker, version 2.5.0.">
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="top" title="Roundup 2.5.0 documentation" href="index.html" />
    <link rel="next" title="Roundup Tracker Templates" href="tracker_templates.html" />
    <link rel="prev" title="Acknowledgements" href="acknowledgements.html" /> 
  </head>
  <body>
    <div class="header"><div class="label">Roundup</div>
        <script id="documentation_options" data-url_root=""
	      src="_static/documentation_options.js">
        </script>

        <div id="searchbox" style="display: none">
          <form class="search" action="search.html" method="get">
            <input type="text" name="q" size="18" />
            <input type="submit" value="Search" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
        </div>
        <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
    <div class="navigation">
      <div class="menu">
       
    <h3><a href="index.html">Table Of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Upgrading versions before 1.5.0</a><ul>
<li><a class="reference internal" href="#migrating-from-1-4-20-to-1-4-21">Migrating from 1.4.20 to 1.4.21</a></li>
<li><a class="reference internal" href="#migrating-from-1-4-19-to-1-4-20">Migrating from 1.4.19 to 1.4.20</a></li>
<li><a class="reference internal" href="#migrating-from-1-4-17-to-1-4-18">Migrating from 1.4.17 to 1.4.18</a></li>
<li><a class="reference internal" href="#migrating-from-1-4-x-to-1-4-17">Migrating from 1.4.x to 1.4.17</a></li>
<li><a class="reference internal" href="#migrating-from-1-4-x-to-1-4-12">Migrating from 1.4.x to 1.4.12</a><ul>
<li><a class="reference internal" href="#fixing-some-potential-security-holes">Fixing some potential security holes</a></li>
<li><a class="reference internal" href="#some-html-interface-tweaks">Some HTML interface tweaks</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migrating-from-1-4-x-to-1-4-11">Migrating from 1.4.x to 1.4.11</a><ul>
<li><a class="reference internal" href="#close-potential-security-hole">Close potential security hole</a></li>
<li><a class="reference internal" href="#grant-the-register-permission-to-the-anonymous-role">Grant the “Register” permission to the Anonymous role</a></li>
<li><a class="reference internal" href="#generic-class-editor-may-now-restore-retired-items">Generic class editor may now restore retired items</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migrating-from-1-4-x-to-1-4-9">Migrating from 1.4.x to 1.4.9</a><ul>
<li><a class="reference internal" href="#customized-mailgw-class">Customized MailGW Class</a></li>
<li><a class="reference internal" href="#fix-the-remove-button-in-issue-files-and-messages-lists">Fix the “remove” button in issue files and messages lists</a></li>
<li><a class="reference internal" href="#fixing-the-retire-button-in-user-management-list">Fixing the “retire” button in user management list</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migrating-from-1-4-x-to-1-4-7">Migrating from 1.4.x to 1.4.7</a><ul>
<li><a class="reference internal" href="#grant-the-retire-permission-to-users-for-their-queries">Grant the “retire” permission to users for their queries</a></li>
<li><a class="reference internal" href="#fix-the-retire-link-in-the-users-list-for-admin-users">Fix the “retire” link in the users list for admin users</a></li>
<li><a class="reference internal" href="#fix-for-python-2-6-users">Fix for Python 2.6+ users</a></li>
<li><a class="reference internal" href="#trackers-currently-allowing-html-file-uploading">Trackers currently allowing HTML file uploading</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migrating-from-1-4-2-to-1-4-3">Migrating from 1.4.2 to 1.4.3</a></li>
<li><a class="reference internal" href="#migrating-from-1-4-x-to-1-4-2">Migrating from 1.4.x to 1.4.2</a></li>
<li><a class="reference internal" href="#migrating-from-1-3-3-to-1-4-0">Migrating from 1.3.3 to 1.4.0</a></li>
<li><a class="reference internal" href="#migrating-from-1-2-x-to-1-3-0">Migrating from 1.2.x to 1.3.0</a><ul>
<li><a class="reference internal" href="#web-interface-changes">1.3.0 Web interface changes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migrating-from-1-1-2-to-1-2-0">Migrating from 1.1.2 to 1.2.0</a><ul>
<li><a class="reference internal" href="#sorting-and-grouping-by-multiple-properties">1.2.0 Sorting and grouping by multiple properties</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migrating-from-1-1-0-to-1-1-1">Migrating from 1.1.0 to 1.1.1</a><ul>
<li><a class="reference internal" href="#clear-this-message">1.1.1 “Clear this message”</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migrating-from-1-0-x-to-1-1-0">Migrating from 1.0.x to 1.1.0</a><ul>
<li><a class="reference internal" href="#login-for-session-only">1.1 Login “For Session Only”</a></li>
<li><a class="reference internal" href="#query-display-name">1.1 Query Display Name</a></li>
<li><a class="reference internal" href="#id1">1.1 “Clear this message”</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migrating-from-0-8-x-to-1-0">Migrating from 0.8.x to 1.0</a><ul>
<li><a class="reference internal" href="#new-query-permissions">1.0 New Query Permissions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migrating-from-0-8-0-to-0-8-3">Migrating from 0.8.0 to 0.8.3</a><ul>
<li><a class="reference internal" href="#nosy-handling-changes">0.8.3 Nosy Handling Changes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migrating-from-0-7-1-to-0-8-0">Migrating from 0.7.1 to 0.8.0</a><ul>
<li><a class="reference internal" href="#backend-changes">0.8.0 Backend changes</a></li>
<li><a class="reference internal" href="#api-changes">0.8.0 API changes</a></li>
<li><a class="reference internal" href="#new-tracker-layout">0.8.0 New tracker layout</a></li>
<li><a class="reference internal" href="#permissions-changes">0.8.0 Permissions Changes</a></li>
<li><a class="reference internal" href="#use-of-templatingutils">0.8.0 Use of TemplatingUtils</a></li>
<li><a class="reference internal" href="#logging-configuration">0.8.0 Logging Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migrating-from-0-7-2-to-0-7-3">Migrating from 0.7.2 to 0.7.3</a><ul>
<li><a class="reference internal" href="#configuration">0.7.3 Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migrating-from-0-7-0-to-0-7-2">Migrating from 0.7.0 to 0.7.2</a><ul>
<li><a class="reference internal" href="#default-timezone-is-now-required">0.7.2 DEFAULT_TIMEZONE is now required</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migrating-from-0-7-0-to-0-7-1">Migrating from 0.7.0 to 0.7.1</a><ul>
<li><a class="reference internal" href="#permission-assignments">0.7.1 Permission assignments</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migrating-from-0-6-to-0-7">Migrating from 0.6 to 0.7</a><ul>
<li><a class="reference internal" href="#id2">0.7.0 Permission assignments</a></li>
<li><a class="reference internal" href="#getting-the-current-user-id">0.7.0 Getting the current user id</a></li>
<li><a class="reference internal" href="#zroundup-changes">0.7.0 ZRoundup changes</a></li>
<li><a class="reference internal" href="#edit-collision-detection">0.7.0 Edit collision detection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migrating-from-0-6-x-to-0-6-3">Migrating from 0.6.x to 0.6.3</a><ul>
<li><a class="reference internal" href="#id3">0.6.3 Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migrating-from-0-5-to-0-6">Migrating from 0.5 to 0.6</a><ul>
<li><a class="reference internal" href="#id4">0.6.0 Configuration</a></li>
<li><a class="reference internal" href="#templating-changes">0.6.0 Templating changes</a></li>
<li><a class="reference internal" href="#form-handling-changes">0.6.0 Form handling changes</a></li>
<li><a class="reference internal" href="#multilingual-character-set-support">0.6.0 Multilingual character set support</a></li>
<li><a class="reference internal" href="#user-timezone-support">0.6.0 User timezone support</a></li>
<li><a class="reference internal" href="#search-page-structure">0.6.0 Search page structure</a></li>
<li><a class="reference internal" href="#notes-for-metakit-backend-users">0.6.0 Notes for metakit backend users</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migrating-from-0-4-x-to-0-5-0">Migrating from 0.4.x to 0.5.0</a><ul>
<li><a class="reference internal" href="#id7">0.5.0 Configuration</a></li>
<li><a class="reference internal" href="#schema-specification">0.5.0 Schema Specification</a><ul>
<li><a class="reference internal" href="#database-backend-changes">0.5.0 Database backend changes</a></li>
<li><a class="reference internal" href="#journalling-changes">0.5.0 Journalling changes</a></li>
<li><a class="reference internal" href="#user-schema-changes">0.5.0 User schema changes</a></li>
<li><a class="reference internal" href="#security-settings">0.5.0 Security Settings</a></li>
<li><a class="reference internal" href="#user-changes">0.5.0 User changes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cgi-interface-changes">0.5.0 CGI interface changes</a></li>
<li><a class="reference internal" href="#html-templating">0.5.0 HTML templating</a></li>
<li><a class="reference internal" href="#detectors">0.5.0 Detectors</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migrating-from-0-4-1-to-0-4-2">Migrating from 0.4.1 to 0.4.2</a><ul>
<li><a class="reference internal" href="#id8">0.4.2 Configuration</a></li>
<li><a class="reference internal" href="#changes-to-detectors">0.4.2 Changes to detectors</a></li>
<li><a class="reference internal" href="#html-templating-changes">0.4.2 HTML templating changes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migrating-from-0-4-0-to-0-4-1">Migrating from 0.4.0 to 0.4.1</a><ul>
<li><a class="reference internal" href="#files-storage">0.4.1 Files storage</a></li>
<li><a class="reference internal" href="#id9">0.4.1 Configuration</a></li>
<li><a class="reference internal" href="#alternate-e-mail-addresses">0.4.1 Alternate E-Mail Addresses</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migrating-from-0-3-x-to-0-4-0">Migrating from 0.3.x to 0.4.0</a><ul>
<li><a class="reference internal" href="#message-id-and-in-reply-to-addition">0.4.0 Message-ID and In-Reply-To addition</a></li>
<li><a class="reference internal" href="#id10">0.4.0 Configuration</a></li>
<li><a class="reference internal" href="#cgi-script-roundup-cgi">0.4.0 CGI script roundup.cgi</a></li>
<li><a class="reference internal" href="#nosy-reactor">0.4.0 Nosy reactor</a></li>
<li><a class="reference internal" href="#id11">0.4.0 HTML templating</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migrating-from-0-2-x-to-0-3-x">Migrating from 0.2.x to 0.3.x</a><ul>
<li><a class="reference internal" href="#x-cookie-authentication-changes">0.3.x Cookie Authentication changes</a></li>
<li><a class="reference internal" href="#x-password-encoding">0.3.x Password encoding</a></li>
<li><a class="reference internal" href="#x-configuration">0.3.x Configuration</a></li>
<li><a class="reference internal" href="#x-cgi-script-roundup-cgi">0.3.x CGI script roundup.cgi</a></li>
</ul>
</li>
</ul>
</li>
</ul>

    <h4>Previous topic</h4>
    <p class="topless"><a href="acknowledgements.html"
                          title="previous chapter">Acknowledgements</a></p>
    <h4>Next topic</h4>
    <p class="topless"><a href="tracker_templates.html"
                          title="next chapter">Roundup Tracker Templates</a></p>
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/upgrading-history.txt"
             rel="nofollow">Show Source</a></li>
    </ul>
  <div id="searchbox" style="display: none">
    <h3>Quick search</h3>
      <form class="search" action="search.html" method="get">
        <input type="text" name="q" size="18" />
        <input type="submit" value="Go" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
      <p style="font-size: 90%">Enter search terms or a module, class or function name.</p>
  </div>
  <script type="text/javascript">$('#searchbox').show(0);</script>
      </div>
    </div>
    <main id="main" role="main" class="content">
       
    <div class="related related-top">
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="tracker_templates.html" title="Roundup Tracker Templates"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="acknowledgements.html" title="Acknowledgements"
             accesskey="P">previous</a></li>
        <li><a href="index.html">Roundup 2.5.0 documentation</a></li> 
      </ul>
    </div>
       
  <section id="upgrading-versions-before-1-5-0">
<h1>Upgrading versions before 1.5.0</h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are upgrading from a version of Roundup that is newer than
1.5.0, use the version steps in the <a class="reference external" href="upgrading.html">main upgrading document</a>.</p>
</div>
<p>Please read each section carefully and edit your tracker home files
accordingly. Note that there is information about upgrade procedures in the
<a class="reference external" href="admin_guide.html">administration guide</a> in the <a class="reference external" href="admin_guide.html#software-upgrade">Software Upgrade</a> section.</p>
<p>If a specific version transition isn’t mentioned here (eg. 0.6.7 to 0.6.8)
then you don’t need to do anything. If you’re upgrading from 0.5.6 to
0.6.8 though, you’ll need to check the “0.5 to 0.6” and “0.6.x to 0.6.3”
steps.</p>
<p>General steps:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Make note of your current Roundup version.</p></li>
<li><p>Take your Roundup installation offline (web, email,
cron scripts, roundup-admin etc.)</p></li>
<li><p>Backup your Roundup instance</p></li>
<li><p>Install a new version of Roundup</p></li>
<li><p>Make version specific changes as described below for
each version transition. If you are starting at 1.5.0
and installing to 2.3, you need to make the changes for <strong>all</strong>
versions starting at 1.5 and ending at 2.3. E.G.
1.5.0 -&gt; 1.5.1, 1.5.1 -&gt; 1.6.0, …, 2.1.0 -&gt; 2.2.0,
2.2.0 -&gt; 2.3.0.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">roundup-admin</span> <span class="pre">-i</span> <span class="pre">&lt;tracker_home&gt;</span> <span class="pre">migrate</span></code> for
<strong>all</strong> your trackers. This will update the database if
it is required.</p></li>
<li><p>Bring your Roundup instance back online</p></li>
<li><p>Test</p></li>
</ol>
</div></blockquote>
<p><strong>IMPORTANT</strong> The v1.5.x releases of Roundup were the last to support
Python v2.5 and v2.6.  Starting with the v1.6 releases of Roundup
Python version 2.7 that is newer than 2.7.2 is required to run
Roundup.  Starting with Roundup version 2.0.0 we also support Python 3
versions newer than 3.4.</p>
<p>Contents:</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#migrating-from-1-4-20-to-1-4-21" id="id12">Migrating from 1.4.20 to 1.4.21</a></p></li>
<li><p><a class="reference internal" href="#migrating-from-1-4-19-to-1-4-20" id="id13">Migrating from 1.4.19 to 1.4.20</a></p></li>
<li><p><a class="reference internal" href="#migrating-from-1-4-17-to-1-4-18" id="id14">Migrating from 1.4.17 to 1.4.18</a></p></li>
<li><p><a class="reference internal" href="#migrating-from-1-4-x-to-1-4-17" id="id15">Migrating from 1.4.x to 1.4.17</a></p></li>
<li><p><a class="reference internal" href="#migrating-from-1-4-x-to-1-4-12" id="id16">Migrating from 1.4.x to 1.4.12</a></p>
<ul>
<li><p><a class="reference internal" href="#fixing-some-potential-security-holes" id="id17">Fixing some potential security holes</a></p></li>
<li><p><a class="reference internal" href="#some-html-interface-tweaks" id="id18">Some HTML interface tweaks</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migrating-from-1-4-x-to-1-4-11" id="id19">Migrating from 1.4.x to 1.4.11</a></p>
<ul>
<li><p><a class="reference internal" href="#close-potential-security-hole" id="id20">Close potential security hole</a></p></li>
<li><p><a class="reference internal" href="#grant-the-register-permission-to-the-anonymous-role" id="id21">Grant the “Register” permission to the Anonymous role</a></p></li>
<li><p><a class="reference internal" href="#generic-class-editor-may-now-restore-retired-items" id="id22">Generic class editor may now restore retired items</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migrating-from-1-4-x-to-1-4-9" id="id23">Migrating from 1.4.x to 1.4.9</a></p>
<ul>
<li><p><a class="reference internal" href="#customized-mailgw-class" id="id24">Customized MailGW Class</a></p></li>
<li><p><a class="reference internal" href="#fix-the-remove-button-in-issue-files-and-messages-lists" id="id25">Fix the “remove” button in issue files and messages lists</a></p></li>
<li><p><a class="reference internal" href="#fixing-the-retire-button-in-user-management-list" id="id26">Fixing the “retire” button in user management list</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migrating-from-1-4-x-to-1-4-7" id="id27">Migrating from 1.4.x to 1.4.7</a></p>
<ul>
<li><p><a class="reference internal" href="#grant-the-retire-permission-to-users-for-their-queries" id="id28">Grant the “retire” permission to users for their queries</a></p></li>
<li><p><a class="reference internal" href="#fix-the-retire-link-in-the-users-list-for-admin-users" id="id29">Fix the “retire” link in the users list for admin users</a></p></li>
<li><p><a class="reference internal" href="#fix-for-python-2-6-users" id="id30">Fix for Python 2.6+ users</a></p></li>
<li><p><a class="reference internal" href="#trackers-currently-allowing-html-file-uploading" id="id31">Trackers currently allowing HTML file uploading</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migrating-from-1-4-2-to-1-4-3" id="id32">Migrating from 1.4.2 to 1.4.3</a></p></li>
<li><p><a class="reference internal" href="#migrating-from-1-4-x-to-1-4-2" id="id33">Migrating from 1.4.x to 1.4.2</a></p></li>
<li><p><a class="reference internal" href="#migrating-from-1-3-3-to-1-4-0" id="id34">Migrating from 1.3.3 to 1.4.0</a></p></li>
<li><p><a class="reference internal" href="#migrating-from-1-2-x-to-1-3-0" id="id35">Migrating from 1.2.x to 1.3.0</a></p>
<ul>
<li><p><a class="reference internal" href="#web-interface-changes" id="id36">1.3.0 Web interface changes</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migrating-from-1-1-2-to-1-2-0" id="id37">Migrating from 1.1.2 to 1.2.0</a></p>
<ul>
<li><p><a class="reference internal" href="#sorting-and-grouping-by-multiple-properties" id="id38">1.2.0 Sorting and grouping by multiple properties</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migrating-from-1-1-0-to-1-1-1" id="id39">Migrating from 1.1.0 to 1.1.1</a></p>
<ul>
<li><p><a class="reference internal" href="#clear-this-message" id="id40">1.1.1 “Clear this message”</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migrating-from-1-0-x-to-1-1-0" id="id41">Migrating from 1.0.x to 1.1.0</a></p>
<ul>
<li><p><a class="reference internal" href="#login-for-session-only" id="id42">1.1 Login “For Session Only”</a></p></li>
<li><p><a class="reference internal" href="#query-display-name" id="id43">1.1 Query Display Name</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id44">1.1 “Clear this message”</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migrating-from-0-8-x-to-1-0" id="id45">Migrating from 0.8.x to 1.0</a></p>
<ul>
<li><p><a class="reference internal" href="#new-query-permissions" id="id46">1.0 New Query Permissions</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migrating-from-0-8-0-to-0-8-3" id="id47">Migrating from 0.8.0 to 0.8.3</a></p>
<ul>
<li><p><a class="reference internal" href="#nosy-handling-changes" id="id48">0.8.3 Nosy Handling Changes</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migrating-from-0-7-1-to-0-8-0" id="id49">Migrating from 0.7.1 to 0.8.0</a></p>
<ul>
<li><p><a class="reference internal" href="#backend-changes" id="id50">0.8.0 Backend changes</a></p></li>
<li><p><a class="reference internal" href="#api-changes" id="id51">0.8.0 API changes</a></p></li>
<li><p><a class="reference internal" href="#new-tracker-layout" id="id52">0.8.0 New tracker layout</a></p></li>
<li><p><a class="reference internal" href="#permissions-changes" id="id53">0.8.0 Permissions Changes</a></p></li>
<li><p><a class="reference internal" href="#use-of-templatingutils" id="id54">0.8.0 Use of TemplatingUtils</a></p></li>
<li><p><a class="reference internal" href="#logging-configuration" id="id55">0.8.0 Logging Configuration</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migrating-from-0-7-2-to-0-7-3" id="id56">Migrating from 0.7.2 to 0.7.3</a></p>
<ul>
<li><p><a class="reference internal" href="#configuration" id="id57">0.7.3 Configuration</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migrating-from-0-7-0-to-0-7-2" id="id58">Migrating from 0.7.0 to 0.7.2</a></p>
<ul>
<li><p><a class="reference internal" href="#default-timezone-is-now-required" id="id59">0.7.2 DEFAULT_TIMEZONE is now required</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migrating-from-0-7-0-to-0-7-1" id="id60">Migrating from 0.7.0 to 0.7.1</a></p>
<ul>
<li><p><a class="reference internal" href="#permission-assignments" id="id61">0.7.1 Permission assignments</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migrating-from-0-6-to-0-7" id="id62">Migrating from 0.6 to 0.7</a></p>
<ul>
<li><p><a class="reference internal" href="#id2" id="id63">0.7.0 Permission assignments</a></p></li>
<li><p><a class="reference internal" href="#getting-the-current-user-id" id="id64">0.7.0 Getting the current user id</a></p></li>
<li><p><a class="reference internal" href="#zroundup-changes" id="id65">0.7.0 ZRoundup changes</a></p></li>
<li><p><a class="reference internal" href="#edit-collision-detection" id="id66">0.7.0 Edit collision detection</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migrating-from-0-6-x-to-0-6-3" id="id67">Migrating from 0.6.x to 0.6.3</a></p>
<ul>
<li><p><a class="reference internal" href="#id3" id="id68">0.6.3 Configuration</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migrating-from-0-5-to-0-6" id="id69">Migrating from 0.5 to 0.6</a></p>
<ul>
<li><p><a class="reference internal" href="#id4" id="id70">0.6.0 Configuration</a></p></li>
<li><p><a class="reference internal" href="#templating-changes" id="id71">0.6.0 Templating changes</a></p></li>
<li><p><a class="reference internal" href="#form-handling-changes" id="id72">0.6.0 Form handling changes</a></p></li>
<li><p><a class="reference internal" href="#multilingual-character-set-support" id="id73">0.6.0 Multilingual character set support</a></p></li>
<li><p><a class="reference internal" href="#user-timezone-support" id="id74">0.6.0 User timezone support</a></p></li>
<li><p><a class="reference internal" href="#search-page-structure" id="id75">0.6.0 Search page structure</a></p></li>
<li><p><a class="reference internal" href="#notes-for-metakit-backend-users" id="id76">0.6.0 Notes for metakit backend users</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migrating-from-0-4-x-to-0-5-0" id="id77">Migrating from 0.4.x to 0.5.0</a></p>
<ul>
<li><p><a class="reference internal" href="#id7" id="id78">0.5.0 Configuration</a></p></li>
<li><p><a class="reference internal" href="#schema-specification" id="id79">0.5.0 Schema Specification</a></p>
<ul>
<li><p><a class="reference internal" href="#database-backend-changes" id="id80">0.5.0 Database backend changes</a></p></li>
<li><p><a class="reference internal" href="#journalling-changes" id="id81">0.5.0 Journalling changes</a></p></li>
<li><p><a class="reference internal" href="#user-schema-changes" id="id82">0.5.0 User schema changes</a></p></li>
<li><p><a class="reference internal" href="#security-settings" id="id83">0.5.0 Security Settings</a></p></li>
<li><p><a class="reference internal" href="#user-changes" id="id84">0.5.0 User changes</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#cgi-interface-changes" id="id85">0.5.0 CGI interface changes</a></p></li>
<li><p><a class="reference internal" href="#html-templating" id="id86">0.5.0 HTML templating</a></p></li>
<li><p><a class="reference internal" href="#detectors" id="id87">0.5.0 Detectors</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migrating-from-0-4-1-to-0-4-2" id="id88">Migrating from 0.4.1 to 0.4.2</a></p>
<ul>
<li><p><a class="reference internal" href="#id8" id="id89">0.4.2 Configuration</a></p></li>
<li><p><a class="reference internal" href="#changes-to-detectors" id="id90">0.4.2 Changes to detectors</a></p></li>
<li><p><a class="reference internal" href="#html-templating-changes" id="id91">0.4.2 HTML templating changes</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migrating-from-0-4-0-to-0-4-1" id="id92">Migrating from 0.4.0 to 0.4.1</a></p>
<ul>
<li><p><a class="reference internal" href="#files-storage" id="id93">0.4.1 Files storage</a></p></li>
<li><p><a class="reference internal" href="#id9" id="id94">0.4.1 Configuration</a></p></li>
<li><p><a class="reference internal" href="#alternate-e-mail-addresses" id="id95">0.4.1 Alternate E-Mail Addresses</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migrating-from-0-3-x-to-0-4-0" id="id96">Migrating from 0.3.x to 0.4.0</a></p>
<ul>
<li><p><a class="reference internal" href="#message-id-and-in-reply-to-addition" id="id97">0.4.0 Message-ID and In-Reply-To addition</a></p></li>
<li><p><a class="reference internal" href="#id10" id="id98">0.4.0 Configuration</a></p></li>
<li><p><a class="reference internal" href="#cgi-script-roundup-cgi" id="id99">0.4.0 CGI script roundup.cgi</a></p></li>
<li><p><a class="reference internal" href="#nosy-reactor" id="id100">0.4.0 Nosy reactor</a></p></li>
<li><p><a class="reference internal" href="#id11" id="id101">0.4.0 HTML templating</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#migrating-from-0-2-x-to-0-3-x" id="id102">Migrating from 0.2.x to 0.3.x</a></p>
<ul>
<li><p><a class="reference internal" href="#x-cookie-authentication-changes" id="id103">0.3.x Cookie Authentication changes</a></p></li>
<li><p><a class="reference internal" href="#x-password-encoding" id="id104">0.3.x Password encoding</a></p></li>
<li><p><a class="reference internal" href="#x-configuration" id="id105">0.3.x Configuration</a></p></li>
<li><p><a class="reference internal" href="#x-cgi-script-roundup-cgi" id="id106">0.3.x CGI script roundup.cgi</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="migrating-from-1-4-20-to-1-4-21">
<span id="index-0"></span><h2><a class="toc-backref" href="#id12" role="doc-backlink">Migrating from 1.4.20 to 1.4.21</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">_generic.calendar.html</span></code> page of the instance has been updated to include
<code class="docutils literal notranslate"><span class="pre">&lt;meta</span> <span class="pre">name=&quot;robots&quot;</span> <span class="pre">content=&quot;noindex,</span> <span class="pre">nofollow&quot;</span> <span class="pre">/&gt;</span></code>.  This prevents
robots to follow all the links in the calendar.  If you haven’t modified the
page on your local instance, you can simply replace it with the one in
<code class="docutils literal notranslate"><span class="pre">share/roundup/templates/classic/html/_generic.calendar.html</span></code>; if you did,
you can add the tag manually.  See issue2550765 and changeset a099ff2ceff3.</p>
<dl>
<dt>If you are using the xml-rpc interface, there is a change</dt><dd><p>in accessing it. You can not send text/xml data to any
roundup url and get a response, you must use the /xmlrpc
url. For example, if you used to send your xmlrpc request to:</p>
<blockquote>
<div><p>http://myroundup.com/roundup</p>
</div></blockquote>
<p>you need to change the url to read:</p>
<blockquote>
<div><p>http://myroundup.com/roundup/xmlrpc</p>
</div></blockquote>
<p>to invoke the xmlrpc handler. This allows us to send xml
data to roundup for other handlers (e.g. REST, SOAP …)
in the future.</p>
</dd>
</dl>
</section>
<section id="migrating-from-1-4-19-to-1-4-20">
<span id="index-1"></span><h2><a class="toc-backref" href="#id13" role="doc-backlink">Migrating from 1.4.19 to 1.4.20</a></h2>
<p>Roundup used to allow certain HTML-Tags in OK- and Error-messages. Since
these messages are passed via the URL (due to roundup redirecting after
an edit), we did have security-issues (see issue2550724).</p>
<p>If you have customised the OK or Error messages in your
roundup-installation and you were using features like bold or italic
in the message, you will have to do without this highlighting and
remove HTML tags from messages.</p>
<p>If you were using &lt;br&gt; tags for multi-line messages, you now should use
newlines instead, these will be replaced with &lt;br/&gt; during formatting.</p>
<p>Note that the previous implementation also allowed links inside
messages. Since these links could be set by an attacker, no links in
roundup messages are supported anymore. This does <em>not</em> affect the
“clear this message” link in OK-messages as it is generated by the
template and is not part of the OK-message.</p>
<p>If you have not modified any roundup messages, you need not do anything,
the templates shipped with roundup did not use HTML tags in messages for
highlighting.</p>
</section>
<section id="migrating-from-1-4-17-to-1-4-18">
<span id="index-2"></span><h2><a class="toc-backref" href="#id14" role="doc-backlink">Migrating from 1.4.17 to 1.4.18</a></h2>
<p>There was a bug in 1.4.17 where files were unlinked from issues if a
mail without attachment was received via the mail interface. The
following script will list likely issues being affected by the bug.
The date in the script is the date of the 1.4.17 release. If you have
installed 1.4.17 later than this date, you can change the date
appropriately to your installation date. Run the script in the directory
of your tracker:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">roundup</span> <span class="kn">import</span> <span class="n">instance</span>
<span class="kn">from</span> <span class="nn">roundup.date</span> <span class="kn">import</span> <span class="n">Date</span>
<span class="nb">dir</span>     <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span> <span class="p">()</span>
<span class="n">tracker</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">open</span> <span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
<span class="n">db</span>      <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">open</span> <span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">)</span>
<span class="c1"># you may want to change this to your install date to find less candidates</span>
<span class="n">last_release</span> <span class="o">=</span> <span class="n">Date</span><span class="p">(</span><span class="s1">&#39;2011-05-13&#39;</span><span class="p">)</span>
<span class="n">affected</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">getnodeids</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">history</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">affected</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="n">j</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">last_release</span> <span class="ow">or</span> <span class="n">j</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;set&#39;</span> <span class="ow">or</span> <span class="s1">&#39;files&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">j</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">j</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="s1">&#39;files&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
                <span class="n">affected</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">break</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">affected</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
</pre></div>
</div>
<p>To find out which files where attached before you can look in the
history of the affected issue.  For fixing issues you can re-attach the
files in question using the “set” command of roundup-admin, e.g., if the
list of files attached to an issue should be files 5, 17, 23 for issue42
you will set this using</p>
<p>roundup-admin -i /path/to/your/tracker set issue42 files=5,17,23</p>
</section>
<section id="migrating-from-1-4-x-to-1-4-17">
<span id="index-3"></span><h2><a class="toc-backref" href="#id15" role="doc-backlink">Migrating from 1.4.x to 1.4.17</a></h2>
<p>There is a new config-option <cite>migrate_passwords</cite> in section <cite>web</cite> to
auto-migrate passwords at web-login time to a more secure storage
scheme. Default for the new option is “yes” so if you don’t want that
passwords are auto-migrated to a more secure password scheme on user
login, set this to “no” before running your tracker(s) after the
upgrade.</p>
<p>The standalone roundup-server now defaults to listening on localhost (no
longer on all network interfaces). This will not affect you if you’re
already using a configuration file for roundup-server. If you are using
an empty setting for the <cite>host</cite> parameter in the config-file you should
explicitly put 0.0.0.0 there as the use of an empty string to specify
listening to all interfaces is deprecated and will go away in a future
version.  If you are starting the server without a configuration file
and want to explicitly listen to all network interface, you should
specify the -n option with the address <cite>0.0.0.0</cite>.</p>
<p id="new-search-permissions-for-query-in-1-4-17">Searching now requires either read-permission without a check method, or
you will have to add a “Search” permission for a class or a list of
properties for a class (if you want to allow searching). For the classic
template (or other templates derived from it) you want to add the
following lines to your <cite>schema.py</cite> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Search&#39;</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">&#39;query&#39;</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>This is needed, because for the <cite>query</cite> class users may view only their
own queries (or public queries). This is implemented with a <cite>check</cite>
method, therefore the default search permissions will not allow
searching and you’ll have to add an explicit search permission.
If you have modified your schema, you can check if you’re missing any
search permissions with the following script, run it in your <a class="reference internal" href="glossary.html#term-tracker-home"><span class="xref std std-term">tracker
home</span></a> directory, it will list for each Class and Property the roles that may
search for this property:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">roundup</span> <span class="kn">import</span> <span class="n">instance</span>

<span class="n">tracker</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span> <span class="p">())</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">getclasses</span><span class="p">()):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Class:&quot;</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">getclass</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span><span class="o">.</span><span class="n">getprops</span><span class="p">(</span><span class="n">protected</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    Property:&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">roles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">role</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">role</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">roleHasSearchPermission</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">role</span><span class="p">):</span>
                <span class="n">roles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">role</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        roles may search:&quot;</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">roles</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="migrating-from-1-4-x-to-1-4-12">
<span id="index-4"></span><h2><a class="toc-backref" href="#id16" role="doc-backlink">Migrating from 1.4.x to 1.4.12</a></h2>
<p>Item creation now checks the “Create” permission instead of the “Edit”
permission for individual properties. If you have modified your tracker
permissions from the default distribution, you should check that
“Create” permissions exist for all properties you want users to be able
to create.</p>
<section id="fixing-some-potential-security-holes">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Fixing some potential security holes</a></h3>
<p>Enhanced checking was added to the user registration auditor. If you
run a public tracker you should update your tracker’s
<code class="docutils literal notranslate"><span class="pre">detectors/userauditor.py</span></code> using the new code from
<code class="docutils literal notranslate"><span class="pre">share/roundup/templates/classic/detectors/userauditor.py</span></code>. In most
cases you may just copy the file over, but if you’ve made changes to
the auditor in your tracker then you’ll need to manually integrate
the new code.</p>
<p>Some HTML templates were found to have formatting security problems:</p>
<p><code class="docutils literal notranslate"><span class="pre">html/page.html</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">&quot;request/user/username&quot;</span><span class="o">&gt;</span><span class="n">username</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;&lt;/</span><span class="n">b</span><span class="o">&gt;&lt;</span><span class="n">br</span><span class="o">&gt;</span>
<span class="o">+</span><span class="n">tal</span><span class="p">:</span><span class="n">replace</span><span class="o">=</span><span class="s2">&quot;python:request.user.username.plain(escape=1)&quot;</span><span class="o">&gt;</span><span class="n">username</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;&lt;/</span><span class="n">b</span><span class="o">&gt;&lt;</span><span class="n">br</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">html/_generic.help-list.html</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;structure python:item[prop]&quot;</span><span class="o">&gt;&lt;/</span><span class="n">label</span><span class="o">&gt;</span>
<span class="o">+</span><span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;python:item[prop]&quot;</span><span class="o">&gt;&lt;/</span><span class="n">label</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The lines marked “+” should be added and lines marked “-” should be
deleted (minus the “+”/”-” signs).</p>
</section>
<section id="some-html-interface-tweaks">
<h3><a class="toc-backref" href="#id18" role="doc-backlink">Some HTML interface tweaks</a></h3>
<p>You may wish to copy the <code class="docutils literal notranslate"><span class="pre">user_utils.js</span></code> and <code class="docutils literal notranslate"><span class="pre">style.css`</span> <span class="pre">files</span> <span class="pre">from</span> <span class="pre">the</span>
<span class="pre">source</span> <span class="pre">distribution</span> <span class="pre">``share/roundup/templates/classic/html/</span></code> directory to the
<code class="docutils literal notranslate"><span class="pre">html</span></code> directory of your trackers as it includes a small improvement.</p>
<p>If you have made local changes to those files you’ll need to manually work
the differences in to your versions or ignore the changes.</p>
</section>
</section>
<section id="migrating-from-1-4-x-to-1-4-11">
<span id="index-5"></span><h2><a class="toc-backref" href="#id19" role="doc-backlink">Migrating from 1.4.x to 1.4.11</a></h2>
<section id="close-potential-security-hole">
<h3><a class="toc-backref" href="#id20" role="doc-backlink">Close potential security hole</a></h3>
<p>If your tracker has untrusted users you should examine its <code class="docutils literal notranslate"><span class="pre">schema.py</span></code>
file and look for the section granting the “Edit” permission to your users.
This should look something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Edit&#39;</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">own_record</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;User is allowed to edit their own user details&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>and should be modified to restrict the list of properties they are allowed
to edit by adding the <code class="docutils literal notranslate"><span class="pre">properties=</span></code> section like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Edit&#39;</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">own_record</span><span class="p">,</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;address&#39;</span><span class="p">,</span> <span class="s1">&#39;realname&#39;</span><span class="p">,</span> <span class="s1">&#39;phone&#39;</span><span class="p">,</span>
        <span class="s1">&#39;organisation&#39;</span><span class="p">,</span> <span class="s1">&#39;alternate_addresses&#39;</span><span class="p">,</span> <span class="s1">&#39;queries&#39;</span><span class="p">,</span> <span class="s1">&#39;timezone&#39;</span><span class="p">),</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;User is allowed to edit their own user details&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Most importantly the “roles” property should not be editable - thus not
appear in that list of properties.</p>
</section>
<section id="grant-the-register-permission-to-the-anonymous-role">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">Grant the “Register” permission to the Anonymous role</a></h3>
<p>A separate “Register” permission has been introduced to allow
anonymous users to register. This means you will need to add the
following to your tracker’s <code class="docutils literal notranslate"><span class="pre">schema.py</span></code> to add the permission and
assign it to the Anonymous role (replacing any previously assigned
“Create user” permission for the Anonymous role):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Register&#39;</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">,</span>
<span class="o">+</span>     <span class="n">description</span><span class="o">=</span><span class="s1">&#39;User is allowed to register new user&#39;</span><span class="p">)</span>

 <span class="c1"># Assign the appropriate permissions to the anonymous user&#39;s Anonymous</span>
 <span class="c1"># Role. Choices here are:</span>
 <span class="c1"># - Allow anonymous users to register</span>
<span class="o">-</span><span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;Anonymous&#39;</span><span class="p">,</span> <span class="s1">&#39;Create&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">)</span>
<span class="o">+</span><span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;Anonymous&#39;</span><span class="p">,</span> <span class="s1">&#39;Register&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The lines marked “+” should be added and lines marked “-” should be
deleted (minus the “+”/”-” signs).</p>
<p>You should also modify the <code class="docutils literal notranslate"><span class="pre">html/page.html</span></code> template to change the
permission tested there:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">&quot;python:request.user.hasPermission(&#39;Create&#39;, &#39;user&#39;)&quot;</span>
<span class="o">+</span><span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">&quot;python:request.user.hasPermission(&#39;Register&#39;, &#39;user&#39;)&quot;</span>
</pre></div>
</div>
</section>
<section id="generic-class-editor-may-now-restore-retired-items">
<h3><a class="toc-backref" href="#id22" role="doc-backlink">Generic class editor may now restore retired items</a></h3>
<p>The instructions for doing so won’t be present in your tracker unless you copy
the <code class="docutils literal notranslate"><span class="pre">_generic.index.html</span></code> template from the roundup distribution in
<code class="docutils literal notranslate"><span class="pre">share/roundup/templates/classic/html</span></code> to your tracker’s <code class="docutils literal notranslate"><span class="pre">html</span></code> directory.</p>
</section>
</section>
<section id="migrating-from-1-4-x-to-1-4-9">
<span id="index-6"></span><h2><a class="toc-backref" href="#id23" role="doc-backlink">Migrating from 1.4.x to 1.4.9</a></h2>
<section id="customized-mailgw-class">
<h3><a class="toc-backref" href="#id24" role="doc-backlink">Customized MailGW Class</a></h3>
<p>If you have customised the MailGW class in your tracker: The new MailGW
class opens the database for each message in the method handle_message
(instance.open) instead of passing the opened database as a parameter to
the MailGW constructor. The old handle_message has been renamed to
_handle_message. The new method opens the database and wraps the call to
the old method into a try/finally.</p>
<p>Your customised MailGW class needs to mirror this behavior.</p>
</section>
<section id="fix-the-remove-button-in-issue-files-and-messages-lists">
<h3><a class="toc-backref" href="#id25" role="doc-backlink">Fix the “remove” button in issue files and messages lists</a></h3>
<p>The “remove” button(s) in the issue messages list needs to be altered. Find
the following in your tracker’s <code class="docutils literal notranslate"><span class="pre">html/issue.item.html</span></code> template:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">form</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;padding:0&quot;</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">&quot;context/is_edit_ok&quot;</span>
       <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">&quot;action string:issue${context/id}&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;@remove@files&quot;</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">&quot;value file/id&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>and add <code class="docutils literal notranslate"><span class="pre">method=&quot;POST&quot;</span></code> as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">form</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;padding:0&quot;</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">&quot;context/is_edit_ok&quot;</span>
       <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">&quot;action string:issue${context/id}&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;@remove@files&quot;</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">&quot;value file/id&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Then also find:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">form</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;padding:0&quot;</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">&quot;context/is_edit_ok&quot;</span>
       <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">&quot;action string:issue${context/id}&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;@remove@messages&quot;</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">&quot;value msg/id&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>and add <code class="docutils literal notranslate"><span class="pre">method=&quot;POST&quot;</span></code> as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">form</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;padding:0&quot;</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">&quot;context/is_edit_ok&quot;</span>
       <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">&quot;action string:issue${context/id}&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;@remove@messages&quot;</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">&quot;value msg/id&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="fixing-the-retire-button-in-user-management-list">
<h3><a class="toc-backref" href="#id26" role="doc-backlink">Fixing the “retire” button in user management list</a></h3>
<p>Some previous versions of this upgrading document missed <code class="docutils literal notranslate"><span class="pre">method=&quot;POST&quot;</span></code>
in the change to the “retire” link in the user management list
in section <a class="reference internal" href="#migrating-from-1-4-x-to-1-4-7">Migrating from 1.4.x to 1.4.7</a>.
Make sure the change is done as listed below in this document.</p>
</section>
</section>
<section id="migrating-from-1-4-x-to-1-4-7">
<span id="index-7"></span><h2><a class="toc-backref" href="#id27" role="doc-backlink">Migrating from 1.4.x to 1.4.7</a></h2>
<p>Several security issues were addressed in this release. Some aspects of your
trackers may no longer function depending on your local customisations. Core
functionality that will need to be modified:</p>
<section id="grant-the-retire-permission-to-users-for-their-queries">
<h3><a class="toc-backref" href="#id28" role="doc-backlink">Grant the “retire” permission to users for their queries</a></h3>
<p>Users will no longer be able to retire their own queries. To remedy this you
will need to add the following to your tracker’s <code class="docutils literal notranslate"><span class="pre">schema.py</span></code> just under the
line that grants them permission to edit their own queries:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Edit&#39;</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">&#39;query&#39;</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">edit_query</span><span class="p">,</span>
     <span class="n">description</span><span class="o">=</span><span class="s2">&quot;User is allowed to edit their queries&quot;</span><span class="p">)</span>
  <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="o">+</span> <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Retire&#39;</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">&#39;query&#39;</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">edit_query</span><span class="p">,</span>
<span class="o">+</span>    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;User is allowed to retire their queries&quot;</span><span class="p">)</span>
<span class="o">+</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
  <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Create&#39;</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">&#39;query&#39;</span><span class="p">,</span>
     <span class="n">description</span><span class="o">=</span><span class="s2">&quot;User is allowed to create queries&quot;</span><span class="p">)</span>
  <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>The lines marked “+” should be added, minus the “+” sign.</p>
</section>
<section id="fix-the-retire-link-in-the-users-list-for-admin-users">
<h3><a class="toc-backref" href="#id29" role="doc-backlink">Fix the “retire” link in the users list for admin users</a></h3>
<p>The “retire” link found in the file <code class="docutils literal notranslate"><span class="pre">html/user.index.html</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">&quot;context/is_edit_ok&quot;</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">a</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">&quot;href string:user${user/id}?@action=retire&amp;@template=index&quot;</span>
  <span class="n">i18n</span><span class="p">:</span><span class="n">translate</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="o">&gt;</span><span class="n">retire</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Should be replaced with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">&quot;context/is_retire_ok&quot;</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">form</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;padding:0&quot;</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span>
         <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">&quot;action string:user${user/id}&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;@template&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;@action&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;retire&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;retire&quot;</span> <span class="n">i18n</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="fix-for-python-2-6-users">
<h3><a class="toc-backref" href="#id30" role="doc-backlink">Fix for Python 2.6+ users</a></h3>
<p>If you use Python 2.6 you should edit your tracker’s
<code class="docutils literal notranslate"><span class="pre">detectors/nosyreaction.py</span></code> file to change:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sets</span>
</pre></div>
</div>
<p>at the top to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">roundup.anypy.sets_</span> <span class="kn">import</span> <span class="nb">set</span>
</pre></div>
</div>
<p>and then all instances of <code class="docutils literal notranslate"><span class="pre">sets.Set()</span></code> to <code class="docutils literal notranslate"><span class="pre">set()</span></code> in the later code.</p>
</section>
<section id="trackers-currently-allowing-html-file-uploading">
<h3><a class="toc-backref" href="#id31" role="doc-backlink">Trackers currently allowing HTML file uploading</a></h3>
<p>Trackers which wish to continue to allow uploading of HTML content against issues
will need to set a new configuration variable in the <code class="docutils literal notranslate"><span class="pre">[web]</span></code> section of the
tracker’s <code class="docutils literal notranslate"><span class="pre">config.ini</span></code> file:</p>
<blockquote>
<div><p># Setting this option enables Roundup to serve uploaded HTML
# file content <em>as HTML</em>. This is a potential security risk
# and is therefore disabled by default. Set to ‘yes’ if you
# trust <em>all</em> users uploading content to your tracker.
# Allowed values: yes, no
# Default: no
allow_html_file = no</p>
</div></blockquote>
</section>
</section>
<section id="migrating-from-1-4-2-to-1-4-3">
<span id="index-8"></span><h2><a class="toc-backref" href="#id32" role="doc-backlink">Migrating from 1.4.2 to 1.4.3</a></h2>
<p>If you are using the MySQL backend you will need to replace some indexes
that may have been created by version 1.4.2.</p>
<p>You should to access your MySQL database directly and remove any indexes
with a name ending in “_key_retired_idx”. You should then re-add them with
the same spec except the key column name needs a size. So an index on
“_user (__retired, _name)” should become “_user (__retired, _name(255))”.</p>
</section>
<section id="migrating-from-1-4-x-to-1-4-2">
<span id="index-9"></span><h2><a class="toc-backref" href="#id33" role="doc-backlink">Migrating from 1.4.x to 1.4.2</a></h2>
<p id="index-10">You should run the “roundup-admin migrate” command for your tracker once
you’ve installed the latest codebase.</p>
<p>Do this before you use the web, command-line or mail interface and before
any users access the tracker.</p>
<p>This command will respond with either “Tracker updated” (if you’ve not
previously run it on an RDBMS backend) or “No migration action required”
(if you have run it, or have used another interface to the tracker,
or are using anydbm).</p>
<p>It’s safe to run this even if it’s not required, so just get into the
habit.</p>
</section>
<section id="migrating-from-1-3-3-to-1-4-0">
<span id="index-11"></span><h2><a class="toc-backref" href="#id34" role="doc-backlink">Migrating from 1.3.3 to 1.4.0</a></h2>
<p>Value of the “refwd_re” tracker configuration option (section “mailgw”)
is treated as UTF-8 string.  In previous versions, it was ISO8859-1.</p>
<p>If you have running trackers based on the classic template, please
update the messagesummary detector as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span> <span class="n">detectors</span><span class="o">/</span><span class="n">messagesummary</span><span class="o">.</span><span class="n">py</span> <span class="mi">17</span> <span class="n">Apr</span> <span class="mi">2003</span> <span class="mi">03</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">38</span> <span class="o">-</span><span class="mi">0000</span>      <span class="mf">1.1</span>
<span class="o">+++</span> <span class="n">detectors</span><span class="o">/</span><span class="n">messagesummary</span><span class="o">.</span><span class="n">py</span> <span class="mi">3</span> <span class="n">Apr</span> <span class="mi">2007</span> <span class="mi">06</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">21</span> <span class="o">-</span><span class="mi">0000</span>       <span class="mf">1.2</span>
<span class="o">@@</span> <span class="o">-</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span> <span class="o">+</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span> <span class="o">@@</span>
 <span class="k">if</span> <span class="n">newvalues</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;summary&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">newvalues</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">):</span>
     <span class="k">return</span>

<span class="o">-</span>    <span class="n">summary</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">parseContent</span><span class="p">(</span><span class="n">newvalues</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="o">+</span>    <span class="n">summary</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">parseContent</span><span class="p">(</span><span class="n">newvalues</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">],</span> <span class="n">config</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
 <span class="n">newvalues</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary</span>
</pre></div>
</div>
<p>In the latest version we have added some database indexes to the
SQL-backends (mysql, postgresql, sqlite) for speeding up building the
roundup-index for full-text search. We recommend that you create the
following database indexes on the database by hand:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">INDEX</span> <span class="n">words_by_id</span> <span class="n">ON</span> <span class="n">__words</span> <span class="p">(</span><span class="n">_textid</span><span class="p">);</span>
<span class="n">CREATE</span> <span class="n">UNIQUE</span> <span class="n">INDEX</span> <span class="n">__textids_by_props</span> <span class="n">ON</span> <span class="n">__textids</span> <span class="p">(</span><span class="n">_class</span><span class="p">,</span> <span class="n">_itemid</span><span class="p">,</span> <span class="n">_prop</span><span class="p">);</span>
</pre></div>
</div>
<p>You can find out which database backend you are using by looking at
the <code class="docutils literal notranslate"><span class="pre">db/backend_name</span></code> file in the tracker’s home directory. The
username, password, and database name can all be found in the
<code class="docutils literal notranslate"><span class="pre">config.ini</span></code> file if you are using <code class="docutils literal notranslate"><span class="pre">mysql</span></code> or <code class="docutils literal notranslate"><span class="pre">postgresql</span></code>. You
can run the SQL commands using the native client interface: <code class="docutils literal notranslate"><span class="pre">psql</span></code>
(postgres), <code class="docutils literal notranslate"><span class="pre">mysql</span></code> (MySQL), or <code class="docutils literal notranslate"><span class="pre">sqlite3</span></code> (SQLite).</p>
</section>
<section id="migrating-from-1-2-x-to-1-3-0">
<span id="index-12"></span><h2><a class="toc-backref" href="#id35" role="doc-backlink">Migrating from 1.2.x to 1.3.0</a></h2>
<section id="web-interface-changes">
<h3><a class="toc-backref" href="#id36" role="doc-backlink">1.3.0 Web interface changes</a></h3>
<p>Some of the HTML files in the “classic” and “minimal” tracker templates
were changed to fix some bugs and clean them up. You may wish to compare
them to the HTML files in your tracker and apply any changes.</p>
</section>
</section>
<section id="migrating-from-1-1-2-to-1-2-0">
<span id="index-13"></span><h2><a class="toc-backref" href="#id37" role="doc-backlink">Migrating from 1.1.2 to 1.2.0</a></h2>
<section id="sorting-and-grouping-by-multiple-properties">
<h3><a class="toc-backref" href="#id38" role="doc-backlink">1.2.0 Sorting and grouping by multiple properties</a></h3>
<p>Starting with this version, sorting and grouping by multiple properties
is possible. This means that request.sort and request.group are now
lists. This is reflected in several places:</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">renderWith</span></code> now has list attributes for <code class="docutils literal notranslate"><span class="pre">sort</span></code> and <code class="docutils literal notranslate"><span class="pre">group</span></code>,
where you previously wrote:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">renderWith</span><span class="p">(</span><span class="o">...</span> <span class="n">sort</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;activity&#39;</span><span class="p">),</span> <span class="n">group</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;priority&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>you write now:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">renderWith</span><span class="p">(</span><span class="o">...</span> <span class="n">sort</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;activity&#39;</span><span class="p">)],</span> <span class="n">group</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;priority&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</li>
<li><p>In templates that permit to edit sorting/grouping, request.sort and
request.group are (possibly empty) lists. You can now sort and group
by multiple attributes. For an example, see the classic template. You
may want search for the variable <code class="docutils literal notranslate"><span class="pre">n_sort</span></code> which can be set to the
number of sort/group properties.</p></li>
<li><p>Templates that diplay new headlines for each group of items with
equal group properties can now use the modified <code class="docutils literal notranslate"><span class="pre">batch.propchanged</span></code>
method that can take several properties which are checked for
changes. See the example in the classic template which makes use of
<code class="docutils literal notranslate"><span class="pre">batch.propchanged</span></code>.</p></li>
</ul>
</div></blockquote>
</section>
</section>
<section id="migrating-from-1-1-0-to-1-1-1">
<span id="index-14"></span><h2><a class="toc-backref" href="#id39" role="doc-backlink">Migrating from 1.1.0 to 1.1.1</a></h2>
<section id="clear-this-message">
<h3><a class="toc-backref" href="#id40" role="doc-backlink">1.1.1 “Clear this message”</a></h3>
<p>In 1.1.1, the standard <code class="docutils literal notranslate"><span class="pre">page.html</span></code> template includes a “clear this message”
link in the green “ok” message bar that appears after a successful edit
(or other) action.</p>
<p>To include this in your tracker, change the following in your <code class="docutils literal notranslate"><span class="pre">page.html</span></code>
template:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">p</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">&quot;options/ok_message | nothing&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;ok-message&quot;</span>
   <span class="n">tal</span><span class="p">:</span><span class="n">repeat</span><span class="o">=</span><span class="s2">&quot;m options/ok_message&quot;</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;structure m&quot;</span><span class="o">&gt;</span><span class="n">error</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>to be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">p</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">&quot;options/ok_message | nothing&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;ok-message&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">span</span> <span class="n">tal</span><span class="p">:</span><span class="n">repeat</span><span class="o">=</span><span class="s2">&quot;m options/ok_message&quot;</span>
     <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;structure string:$m &lt;br/ &gt; &quot;</span> <span class="o">/&gt;</span>
   <span class="o">&lt;</span><span class="n">a</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-small&quot;</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">&quot;href request/current_url&quot;</span>
      <span class="n">i18n</span><span class="p">:</span><span class="n">translate</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="o">&gt;</span><span class="n">clear</span> <span class="n">this</span> <span class="n">message</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>If you implemented the “clear this message” in your 1.1.0 tracker, then you
should change it to the above and it will work much better!</p>
</section>
</section>
<section id="migrating-from-1-0-x-to-1-1-0">
<span id="index-15"></span><h2><a class="toc-backref" href="#id41" role="doc-backlink">Migrating from 1.0.x to 1.1.0</a></h2>
<section id="login-for-session-only">
<h3><a class="toc-backref" href="#id42" role="doc-backlink">1.1 Login “For Session Only”</a></h3>
<p>In 1.1, web logins are alive for the length of a session only, <em>unless</em> you
add the following to the login form in your tracker’s <code class="docutils literal notranslate"><span class="pre">page.html</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;input type=&quot;checkbox&quot; name=&quot;remember&quot; id=&quot;remember&quot;&gt;
&lt;label for=&quot;remember&quot; i18n:translate=&quot;&quot;&gt;Remember me?&lt;/label&gt;&lt;br&gt;
</pre></div>
</div>
<p>See the classic tracker <code class="docutils literal notranslate"><span class="pre">page.html</span></code> if you’re unsure where this should
go.</p>
</section>
<section id="query-display-name">
<h3><a class="toc-backref" href="#id43" role="doc-backlink">1.1 Query Display Name</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">dispname</span></code> web variable has been renamed <code class="docutils literal notranslate"><span class="pre">&#64;dispname</span></code> to avoid
clashing with other variables of the same name. If you are using the
display name feature, you will need to edit your tracker’s <code class="docutils literal notranslate"><span class="pre">page.html</span></code>
and <code class="docutils literal notranslate"><span class="pre">issue.index.html</span></code> pages to change <code class="docutils literal notranslate"><span class="pre">dispname</span></code> to <code class="docutils literal notranslate"><span class="pre">&#64;dispname</span></code>.</p>
<p>A side-effect of this change is that the renderWith method used in the
<code class="docutils literal notranslate"><span class="pre">home.html</span></code> page may now take a dispname argument.</p>
</section>
<section id="id1">
<h3><a class="toc-backref" href="#id44" role="doc-backlink">1.1 “Clear this message”</a></h3>
<p>In 1.1, the standard <code class="docutils literal notranslate"><span class="pre">page.html</span></code> template includes a “clear this message”
link in the green “ok” message bar that appears after a successful edit
(or other) action.</p>
<p>To include this in your tracker, change the following in your <code class="docutils literal notranslate"><span class="pre">page.html</span></code>
template:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">p</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">&quot;options/ok_message | nothing&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;ok-message&quot;</span>
   <span class="n">tal</span><span class="p">:</span><span class="n">repeat</span><span class="o">=</span><span class="s2">&quot;m options/ok_message&quot;</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;structure m&quot;</span><span class="o">&gt;</span><span class="n">error</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>to be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">p</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">&quot;options/ok_message | nothing&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;ok-message&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">span</span> <span class="n">tal</span><span class="p">:</span><span class="n">repeat</span><span class="o">=</span><span class="s2">&quot;m options/ok_message&quot;</span>
     <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;structure string:$m &lt;br/ &gt; &quot;</span> <span class="o">/&gt;</span>
   <span class="o">&lt;</span><span class="n">a</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-small&quot;</span> <span class="n">tal</span><span class="p">:</span><span class="n">attributes</span><span class="o">=</span><span class="s2">&quot;href string:issue${context/id}&quot;</span>
      <span class="n">i18n</span><span class="p">:</span><span class="n">translate</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="o">&gt;</span><span class="n">clear</span> <span class="n">this</span> <span class="n">message</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
</section>
<section id="migrating-from-0-8-x-to-1-0">
<span id="index-16"></span><h2><a class="toc-backref" href="#id45" role="doc-backlink">Migrating from 0.8.x to 1.0</a></h2>
<section id="new-query-permissions">
<h3><a class="toc-backref" href="#id46" role="doc-backlink">1.0 New Query Permissions</a></h3>
<p>New permissions are defined for query editing and viewing. To include these
in your tracker, you need to add these lines to your tracker’s
<code class="docutils literal notranslate"><span class="pre">schema.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Users should be able to edit and view their own queries. They should also</span>
<span class="c1"># be able to view any marked as not private. They should not be able to</span>
<span class="c1"># edit others&#39; queries, even if they&#39;re not private</span>
<span class="k">def</span> <span class="nf">view_query</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">itemid</span><span class="p">):</span>
    <span class="n">private_for</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">itemid</span><span class="p">,</span> <span class="s1">&#39;private_for&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">private_for</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">userid</span> <span class="o">==</span> <span class="n">private_for</span>
<span class="k">def</span> <span class="nf">edit_query</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">itemid</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">userid</span> <span class="o">==</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">itemid</span><span class="p">,</span> <span class="s1">&#39;creator&#39;</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;View&#39;</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">&#39;query&#39;</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">view_query</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;User is allowed to view their own and public queries&quot;</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Edit&#39;</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">&#39;query&#39;</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">edit_query</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;User is allowed to edit their queries&quot;</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Create&#39;</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">&#39;query&#39;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;User is allowed to create queries&quot;</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>and then remove ‘query’ from the line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Assign the access and edit Permissions for issue, file and message</span>
<span class="c1"># to regular users now</span>
<span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="s1">&#39;issue&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="s1">&#39;query&#39;</span><span class="p">,</span> <span class="s1">&#39;keyword&#39;</span><span class="p">:</span>
</pre></div>
</div>
<p>so it looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="s1">&#39;issue&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="s1">&#39;keyword&#39;</span><span class="p">:</span>
</pre></div>
</div>
</section>
</section>
<section id="migrating-from-0-8-0-to-0-8-3">
<span id="index-17"></span><h2><a class="toc-backref" href="#id47" role="doc-backlink">Migrating from 0.8.0 to 0.8.3</a></h2>
<section id="nosy-handling-changes">
<h3><a class="toc-backref" href="#id48" role="doc-backlink">0.8.3 Nosy Handling Changes</a></h3>
<p>A change was made to fix a bug in the <code class="docutils literal notranslate"><span class="pre">nosyreaction.py</span></code> standard
detector. To incorporate this fix in your trackers, you will need to copy
the <code class="docutils literal notranslate"><span class="pre">nosyreaction.py</span></code> file from the <code class="docutils literal notranslate"><span class="pre">templates/classic/detectors</span></code>
directory of the source to your tracker’s <code class="docutils literal notranslate"><span class="pre">templates</span></code> directory.</p>
<p>If you have modified the <code class="docutils literal notranslate"><span class="pre">nosyreaction.py</span></code> file from the standard
version, you will need to roll your changes into the new file.</p>
</section>
</section>
<section id="migrating-from-0-7-1-to-0-8-0">
<span id="index-18"></span><h2><a class="toc-backref" href="#id49" role="doc-backlink">Migrating from 0.7.1 to 0.8.0</a></h2>
<p>You <em>must</em> fully uninstall previous Roundup version before installing
Roundup 0.8.0.  If you don’t do that, <code class="docutils literal notranslate"><span class="pre">roundup-admin</span> <span class="pre">install</span></code>
command may fail to function properly.</p>
<section id="backend-changes">
<h3><a class="toc-backref" href="#id50" role="doc-backlink">0.8.0 Backend changes</a></h3>
<p>Backends ‘bsddb’ and ‘bsddb3’ are removed.  If you are using one of these,
you <em>must</em> migrate to another backend before upgrading.</p>
</section>
<section id="api-changes">
<h3><a class="toc-backref" href="#id51" role="doc-backlink">0.8.0 API changes</a></h3>
<p>Class.safeget() was removed from the API. Test your item ids before calling
Class.get() instead.</p>
</section>
<section id="new-tracker-layout">
<h3><a class="toc-backref" href="#id52" role="doc-backlink">0.8.0 New tracker layout</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">config.py</span></code> file has been replaced by <code class="docutils literal notranslate"><span class="pre">config.ini</span></code>. You may use the
roundup-admin command “genconfig” to generate a new config file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">roundup</span><span class="o">-</span><span class="n">admin</span> <span class="n">genconfig</span> <span class="o">&lt;</span><span class="n">tracker</span> <span class="n">home</span><span class="o">&gt;/</span><span class="n">config</span><span class="o">.</span><span class="n">ini</span>
</pre></div>
</div>
<p>and modify the values therein based on the contents of your old config.py.
In most cases, the names of the config variables are the same.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">select_db.py</span></code> file has been replaced by a file in the <code class="docutils literal notranslate"><span class="pre">db</span></code>
directory called <code class="docutils literal notranslate"><span class="pre">backend_name</span></code>. As you might guess, this file contains
just the name of the backend. To figure what the contents of yours should
be, use the following table:</p>
<blockquote>
<div><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">select_db.py</span></code> contents</p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">backend_name</span></code> contents</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>from back_anydbm import …</p></td>
<td><p>anydbm</p></td>
</tr>
<tr class="row-odd"><td><p>from back_metakit import …</p></td>
<td><p>metakit</p></td>
</tr>
<tr class="row-even"><td><p>from back_sqlite import …</p></td>
<td><p>sqlite</p></td>
</tr>
<tr class="row-odd"><td><p>from back_mysql import …</p></td>
<td><p>mysql</p></td>
</tr>
<tr class="row-even"><td><p>from back_postgresql import …</p></td>
<td><p>postgresql</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The <code class="docutils literal notranslate"><span class="pre">dbinit.py</span></code> file has been split into two new files,
<code class="docutils literal notranslate"><span class="pre">initial_data.py</span></code> and <code class="docutils literal notranslate"><span class="pre">schema.py</span></code>. The contents of this file are:</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">initial_data.py</span></code></dt><dd><p>You don’t need one of these as your tracker is already initialised.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">schema.py</span></code></dt><dd><p>Copy the body of the <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">open(name=None)</span></code> function from your old
tracker’s <code class="docutils literal notranslate"><span class="pre">dbinit.py</span></code> file to this file. As the lines you’re copying
aren’t part of a function definition anymore, one level of indentation
needs to be removed (remove only the leading four spaces on each
line).</p>
<p>The first few lines – those starting with <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">roundup.hyperdb</span>
<span class="pre">import</span> <span class="pre">...</span></code> and the <code class="docutils literal notranslate"><span class="pre">db</span> <span class="pre">=</span> <span class="pre">Database(config,</span> <span class="pre">name)</span></code> line – don’t
need to be copied. Neither do the last few lines – those starting
with <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">detectors</span></code>, down to <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">db</span></code> inclusive.</p>
</dd>
</dl>
<p>You may remove the <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> module from the “detectors” directory as
it is no longer used.</p>
<p>There’s a new way to write extension code for Roundup. If you have code in
an <code class="docutils literal notranslate"><span class="pre">interfaces.py</span></code> file you should move it. See the <a class="reference external" href="customizing.html">customisation
documentation</a> for information about how extensions are now written.
Note that some older trackers may use <code class="docutils literal notranslate"><span class="pre">interfaces.py</span></code> to customise the
mail gateway behaviour. You will need to keep your <code class="docutils literal notranslate"><span class="pre">interfaces.py</span></code> file
if this is the case.</p>
</section>
<section id="permissions-changes">
<h3><a class="toc-backref" href="#id53" role="doc-backlink">0.8.0 Permissions Changes</a></h3>
<p>The creation of a new item in the user interfaces is now controlled by the
“Create” Permission. You will need to add an assignment of this Permission
to your users who are allowed to create items. The most common form of this
is the following in your <code class="docutils literal notranslate"><span class="pre">schema.py</span></code> added just under the current
assignation of the Edit Permission:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="s1">&#39;issue&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="s1">&#39;query&#39;</span><span class="p">,</span> <span class="s1">&#39;keyword&#39;</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">&#39;Create&#39;</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>You will need to explicitly let anonymous users access the web interface so
that regular users are able to see the login form. Note that almost all
trackers will need this Permission. The only situation where it’s not
required is in a tracker that uses an HTTP Basic Authenticated front-end.
It’s enabled by adding to your <code class="docutils literal notranslate"><span class="pre">schema.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">&#39;Web Access&#39;</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;Anonymous&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, you will need to enable permission for your users to edit their
own details by adding the following to <code class="docutils literal notranslate"><span class="pre">schema.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Users should be able to edit their own details. Note that this</span>
<span class="c1"># permission is limited to only the situation where the Viewed or</span>
<span class="c1"># Edited item is their own.</span>
<span class="k">def</span> <span class="nf">own_record</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">itemid</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Determine whether the userid matches the item being accessed.&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">userid</span> <span class="o">==</span> <span class="n">itemid</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;View&#39;</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">own_record</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;User is allowed to view their own user details&quot;</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Edit&#39;</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">own_record</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;User is allowed to edit their own user details&quot;</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="use-of-templatingutils">
<h3><a class="toc-backref" href="#id54" role="doc-backlink">0.8.0 Use of TemplatingUtils</a></h3>
<p>If you used custom python functions in TemplatingUtils, they must
be moved from interfaces.py to a new file in the <code class="docutils literal notranslate"><span class="pre">extensions</span></code> directory.</p>
<p>Each Function that should be available through TAL needs to be defined
as a toplevel function in the newly created file. Furthermore you
add an inititialization function, that registers the functions with the
tracker.</p>
<p>If you find this too tedious, donfu wrote an automatic init function that
takes an existing TemplatingUtils class, and registers all class methods
that do not start with an underscore. The following hack should be placed
in the <code class="docutils literal notranslate"><span class="pre">extensions</span></code> directory alongside other extensions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TemplatingUtils</span><span class="p">:</span>
     <span class="c1"># copy from interfaces.py</span>

<span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">tracker</span><span class="p">):</span>
     <span class="n">util</span> <span class="o">=</span> <span class="n">TemplatingUtils</span><span class="p">()</span>

     <span class="k">def</span> <span class="nf">setClient</span><span class="p">(</span><span class="n">tu</span><span class="p">):</span>
         <span class="n">util</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">tu</span><span class="o">.</span><span class="n">client</span>
         <span class="k">return</span> <span class="n">util</span>

     <span class="k">def</span> <span class="nf">execUtil</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
         <span class="k">return</span> <span class="k">lambda</span> <span class="n">tu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> \
                 <span class="nb">getattr</span><span class="p">(</span><span class="n">setClient</span><span class="p">(</span><span class="n">tu</span><span class="p">),</span> <span class="n">name</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

     <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">util</span><span class="p">):</span>
         <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">util</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
              <span class="n">tracker</span><span class="o">.</span><span class="n">registerUtil</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">execUtil</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="logging-configuration">
<h3><a class="toc-backref" href="#id55" role="doc-backlink">0.8.0 Logging Configuration</a></h3>
<p>See the <a class="reference external" href="admin_guide.html">administration guide</a> for information about configuring the new
logging implemented in 0.8.0.</p>
</section>
</section>
<section id="migrating-from-0-7-2-to-0-7-3">
<span id="index-19"></span><h2><a class="toc-backref" href="#id56" role="doc-backlink">Migrating from 0.7.2 to 0.7.3</a></h2>
<section id="configuration">
<h3><a class="toc-backref" href="#id57" role="doc-backlink">0.7.3 Configuration</a></h3>
<p>If you choose, you may specify the directory from which static files are
served (those which use the URL component <code class="docutils literal notranslate"><span class="pre">&#64;&#64;file</span></code>). Currently the
directory defaults to the <code class="docutils literal notranslate"><span class="pre">TEMPLATES</span></code> configuration variable. You may
define a new variable, <code class="docutils literal notranslate"><span class="pre">STATIC_FILES</span></code> which overrides this value for
static files.</p>
</section>
</section>
<section id="migrating-from-0-7-0-to-0-7-2">
<span id="index-20"></span><h2><a class="toc-backref" href="#id58" role="doc-backlink">Migrating from 0.7.0 to 0.7.2</a></h2>
<section id="default-timezone-is-now-required">
<h3><a class="toc-backref" href="#id59" role="doc-backlink">0.7.2 DEFAULT_TIMEZONE is now required</a></h3>
<p>The DEFAULT_TIMEZONE configuration variable is now required. Add the
following to your tracker’s <code class="docutils literal notranslate"><span class="pre">config.py</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># You may specify a different default timezone, for use when users do not</span>
<span class="c1"># choose their own in their settings.</span>
<span class="n">DEFAULT_TIMEZONE</span> <span class="o">=</span> <span class="mi">0</span>            <span class="c1"># specify as numeric hour offest</span>
</pre></div>
</div>
</section>
</section>
<section id="migrating-from-0-7-0-to-0-7-1">
<span id="index-21"></span><h2><a class="toc-backref" href="#id60" role="doc-backlink">Migrating from 0.7.0 to 0.7.1</a></h2>
<section id="permission-assignments">
<h3><a class="toc-backref" href="#id61" role="doc-backlink">0.7.1 Permission assignments</a></h3>
<p>If you allow anonymous access to your tracker, you might need to assign
some additional View (or Edit if your tracker is that open) permissions
to the “anonymous” user. To do so, find the code in your <code class="docutils literal notranslate"><span class="pre">dbinit.py</span></code> that
says:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="s1">&#39;issue&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="s1">&#39;query&#39;</span><span class="p">,</span> <span class="s1">&#39;keyword&#39;</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">&#39;View&#39;</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">&#39;Edit&#39;</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="s1">&#39;priority&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">&#39;View&#39;</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>Add add a line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;Anonymous&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>next to the existing <code class="docutils literal notranslate"><span class="pre">'User'</span></code> lines for the Permissions you wish to
assign to the anonymous user.</p>
</section>
</section>
<section id="migrating-from-0-6-to-0-7">
<span id="index-22"></span><h2><a class="toc-backref" href="#id62" role="doc-backlink">Migrating from 0.6 to 0.7</a></h2>
<section id="id2">
<h3><a class="toc-backref" href="#id63" role="doc-backlink">0.7.0 Permission assignments</a></h3>
<p>Due to a change in the rendering of web widgets, permissions are now
checked on Classes where they previously weren’t (this is a good thing).</p>
<p>You will need to add some additional Permission assignments for your
regular users, or some displays will break. After the following in your
tracker’s <code class="docutils literal notranslate"><span class="pre">dbinit.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Assign the access and edit Permissions for issue, file and message</span>
<span class="c1"># to regular users now</span>
<span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="s1">&#39;issue&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="s1">&#39;query&#39;</span><span class="p">,</span> <span class="s1">&#39;keyword&#39;</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">&#39;View&#39;</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">&#39;Edit&#39;</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>add:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="s1">&#39;priority&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">&#39;View&#39;</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="getting-the-current-user-id">
<h3><a class="toc-backref" href="#id64" role="doc-backlink">0.7.0 Getting the current user id</a></h3>
<p>The Database.curuserid attribute has been removed.</p>
<p>Any code referencing this attribute should be replaced with a
call to Database.getuid().</p>
</section>
<section id="zroundup-changes">
<h3><a class="toc-backref" href="#id65" role="doc-backlink">0.7.0 ZRoundup changes</a></h3>
<p>The templates in your tracker’s html directory will need updating if you
wish to use ZRoundup. If you’ve not modified those files (or some of them),
you may just copy the new versions from the Roundup source in the
templates/classic/html directory.</p>
<p>If you have modified the html files, then you’ll need to manually edit them
to change all occurances of special form variables from using the colon “:”
special character to the at “&#64;” special character. That is, variables such
as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">:</span><span class="n">action</span> <span class="p">:</span><span class="n">required</span> <span class="p">:</span><span class="n">template</span> <span class="p">:</span><span class="n">remove</span><span class="p">:</span><span class="n">messages</span> <span class="o">...</span>
</pre></div>
</div>
<p>should become:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@action</span> <span class="nd">@required</span> <span class="nd">@template</span> <span class="nd">@remove@messages</span> <span class="o">...</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">tal:</span></code> statements are unaffected. So are TAL expression type
prefixes such as <code class="docutils literal notranslate"><span class="pre">python:</span></code> and <code class="docutils literal notranslate"><span class="pre">string:</span></code>. Please ask on the
roundup-users mailing list for help if you’re unsure.</p>
</section>
<section id="edit-collision-detection">
<h3><a class="toc-backref" href="#id66" role="doc-backlink">0.7.0 Edit collision detection</a></h3>
<p>Roundup now detects collisions with editing in the web interface (that is,
two people editing the same item at the same time).</p>
<p>You must copy the <code class="docutils literal notranslate"><span class="pre">_generic.collision.html</span></code> file from Roundup source in
the <code class="docutils literal notranslate"><span class="pre">templates/classic/html</span></code> directory. to your tracker’s <code class="docutils literal notranslate"><span class="pre">html</span></code>
directory.</p>
</section>
</section>
<section id="migrating-from-0-6-x-to-0-6-3">
<h2><a class="toc-backref" href="#id67" role="doc-backlink">Migrating from 0.6.x to 0.6.3</a></h2>
<section id="id3">
<h3><a class="toc-backref" href="#id68" role="doc-backlink">0.6.3 Configuration</a></h3>
<p>You will need to copy the file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">templates</span><span class="o">/</span><span class="n">classic</span><span class="o">/</span><span class="n">detectors</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>to your tracker’s <code class="docutils literal notranslate"><span class="pre">detectors</span></code> directory, replacing the one already there.
This fixes a couple of bugs in that file.</p>
</section>
</section>
<section id="migrating-from-0-5-to-0-6">
<h2><a class="toc-backref" href="#id69" role="doc-backlink">Migrating from 0.5 to 0.6</a></h2>
<section id="id4">
<h3><a class="toc-backref" href="#id70" role="doc-backlink">0.6.0 Configuration</a></h3>
<p>Introduced EMAIL_FROM_TAG config variable. This value is inserted into
the From: line of nosy email. If the sending user is “Foo Bar”, the
From: line is usually:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Foo Bar&quot;</span> <span class="o">&lt;</span><span class="n">issue_tracker</span><span class="nd">@tracker</span><span class="o">.</span><span class="n">example</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>the EMAIL_FROM_TAG goes inside the “Foo Bar” quotes like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Foo Bar EMAIL_FROM_TAG&quot;</span> <span class="o">&lt;</span><span class="n">issue_tracker</span><span class="nd">@tracker</span><span class="o">.</span><span class="n">example</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>I’ve altered the mechanism in the detectors __init__.py module so that it
doesn’t cross-import detectors from other trackers (if you run more than one
in a single roundup-server). This change means that you’ll need to copy the
__init__.py from roundup/templates/classic/detectors/__init__.py to your
&lt;tracker home&gt;/detectors/__init__.py. Don’t worry, the “classic” __init__ is a
one-size-fits-all, so it’ll work even if you’ve added/removed detectors.</p>
</section>
<section id="templating-changes">
<h3><a class="toc-backref" href="#id71" role="doc-backlink">0.6.0 Templating changes</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">user.item</span></code> template (in the tracker home “templates” directory)
needs to have the following hidden variable added to its form (between the
<code class="docutils literal notranslate"><span class="pre">&lt;form...&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;/form&gt;</span></code> tags:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;:template&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;item&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="form-handling-changes">
<h3><a class="toc-backref" href="#id72" role="doc-backlink">0.6.0 Form handling changes</a></h3>
<p>Roundup’s form handling capabilities have been significantly expanded. This
should not affect users of 0.5 installations - but if you find you’re
getting errors from form submissions, please ask for help on the Roundup
users mailing list:</p>
<blockquote>
<div><p><a class="reference external" href="https://sourceforge.net/projects/roundup/lists/roundup-users">https://sourceforge.net/projects/roundup/lists/roundup-users</a></p>
</div></blockquote>
<p>See the customisation doc section on <a class="reference external" href="reference.html#form-values">Form Values</a> for documentation of the
new form variables possible.</p>
</section>
<section id="multilingual-character-set-support">
<h3><a class="toc-backref" href="#id73" role="doc-backlink">0.6.0 Multilingual character set support</a></h3>
<p>Added internationalization support. This is done via encoding all data
stored in roundup database to utf-8 (unicode encoding). To support utf-8 in
web interface you should add the folowing line to your tracker’s html/page
and html/_generic.help files inside &lt;head&gt; tag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">meta</span> <span class="n">http</span><span class="o">-</span><span class="n">equiv</span><span class="o">=</span><span class="s2">&quot;Content-Type&quot;</span> <span class="n">content</span><span class="o">=</span><span class="s2">&quot;text/html; charset=utf-8&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Since latin characters in utf-8 have the same codes as in ASCII table, this
modification is optional for users who use only plain latin characters.</p>
<p>After this modification, you will be able to see and enter any world
character via web interface. Data received via mail interface also converted
to utf-8, however only new messages will be converted. If your roundup
database contains some of non-ASCII characters in one of 8-bit encoding,
they will not be visible in new unicode environment. Some of such data (e.g.
user names, keywords, etc)  can be edited by administrator, the others
(e.g. messages’ contents) is not editable via web interface. Currently there
is no tool for converting such data, the only solution is to close
appropriate old issues and create new ones with the same content.</p>
</section>
<section id="user-timezone-support">
<h3><a class="toc-backref" href="#id74" role="doc-backlink">0.6.0 User timezone support</a></h3>
<p>From version 0.6.0 roundup supports displaying of Date data in user’ local
timezone if he/she has provided timezone information. To make it possible
some modification to tracker’s schema and HTML templates are required.
First you must add string property ‘timezone’ to user class in dbinit.py
like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                <span class="n">username</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>   <span class="n">password</span><span class="o">=</span><span class="n">Password</span><span class="p">(),</span>
                <span class="n">address</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>    <span class="n">realname</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">phone</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>      <span class="n">organisation</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">alternate_addresses</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">queries</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s1">&#39;query&#39;</span><span class="p">),</span> <span class="n">roles</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">timezone</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
</pre></div>
</div>
<p>And second - html interface. Add following lines to
$TRACKER_HOME/html/user.item template:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Timezone</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;structure context/timezone/field&quot;</span><span class="o">&gt;</span><span class="n">timezone</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>After that all users should be able to provide their timezone information.
Timezone should be a positive or negative integer - offset from GMT.</p>
<p>After providing timezone, roundup will show all dates values, found in web
and mail interfaces in local time. It will also accept any Date info in
local time, convert and store it in GMT.</p>
</section>
<section id="search-page-structure">
<h3><a class="toc-backref" href="#id75" role="doc-backlink">0.6.0 Search page structure</a></h3>
<p>In order to accomodate query editing the search page has been restructured. If
you want to provide your users with query editing, you should update your
search page using the macros detailed in the customisation doc section
<a class="reference external" href="customizing.html#searching-on-categories">Searching on categories</a>.</p>
<p>Also, the url field in the query class no longer starts with a ‘?’. You’ll need
to remove this question mark from the url field to support queries. There’s
a script in the “tools” directory called <code class="docutils literal notranslate"><span class="pre">migrate-queries.py</span></code> that should
automatically change any existing queries for you. As always, make a backup
of your database before running such a script.</p>
</section>
<section id="notes-for-metakit-backend-users">
<h3><a class="toc-backref" href="#id76" role="doc-backlink">0.6.0 Notes for metakit backend users</a></h3>
<p>Roundup 0.6.0 introduced searching on ranges of dates and intervals. To
support it, some modifications to interval storing routine were made. So if
your tracker uses metakit backend and your db schema contains intervals
property, searches on that property will not be accurate for db items that
was stored before roundup’ upgrade. However all new records should be
searchable on intervals.</p>
<p>It is possible to convert your database to new format: you can export and
import back all your data (consult “Migrating backends” in “Maintenance”
documentation). After this operation all your interval properties should
become searchable.</p>
<p>Users of backends others than metakit should not worry about this issue.</p>
</section>
</section>
<section id="migrating-from-0-4-x-to-0-5-0">
<h2><a class="toc-backref" href="#id77" role="doc-backlink">Migrating from 0.4.x to 0.5.0</a></h2>
<p>This has been a fairly major revision of Roundup:</p>
<ol class="arabic simple">
<li><p>Brand new, much more powerful, flexible, tasty and nutritious templating.
Unfortunately, this means all your current templates are useless. Hopefully
the new documentation and examples will be enough to help you make the
transition. Please don’t hesitate to ask on roundup-users for help (or
complete conversions if you’re completely stuck)!</p></li>
<li><p>The database backed got a lot more flexible, allowing Metakit and SQL
databases! The only decent SQL database implemented at present is sqlite,
but others shouldn’t be a whole lot more work.</p></li>
<li><p>A brand new, highly flexible and much more robust security system including
a system of Permissions, Roles and Role assignments to users. You may now
define your own Permissions that may be checked in CGI transactions.</p></li>
<li><p>Journalling has been made less storage-hungry, so has been turned on
by default <em>except</em> for author, recipient and nosy link/unlink events. You
are advised to turn it off in your trackers too.</p></li>
<li><p>We’ve changed the terminology from “instance” to “tracker”, to ease the
learning curve/impact for new users.</p></li>
<li><p>Because of the above changes, the tracker configuration has seen some
major changes. See below for the details.</p></li>
</ol>
<p>Please, <strong>back up your database</strong> before you start the migration process. This
is as simple as copying the “db” directory and all its contents from your
tracker to somewhere safe.</p>
<section id="id7">
<h3><a class="toc-backref" href="#id78" role="doc-backlink">0.5.0 Configuration</a></h3>
<p>First up, rename your <code class="docutils literal notranslate"><span class="pre">instance_config.py</span></code> file to just <code class="docutils literal notranslate"><span class="pre">config.py</span></code>.</p>
<p>Then edit your tracker’s <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> module. It’ll currently look
like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">instance_config</span> <span class="kn">import</span> <span class="o">*</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">dbinit</span> <span class="kn">import</span> <span class="o">*</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span> <span class="c1"># in installdir (probably :)</span>
<span class="kn">from</span> <span class="nn">interfaces</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>and it needs to be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">config</span>
<span class="kn">from</span> <span class="nn">dbinit</span> <span class="kn">import</span> <span class="nb">open</span><span class="p">,</span> <span class="n">init</span>
<span class="kn">from</span> <span class="nn">interfaces</span> <span class="kn">import</span> <span class="n">Client</span><span class="p">,</span> <span class="n">MailGW</span>
</pre></div>
</div>
<p>Due to the new templating having a top-level <code class="docutils literal notranslate"><span class="pre">page</span></code> that defines links for
searching, indexes, adding items etc, the following variables are no longer
used:</p>
<ul class="simple">
<li><p>HEADER_INDEX_LINKS</p></li>
<li><p>HEADER_ADD_LINKS</p></li>
<li><p>HEADER_SEARCH_LINKS</p></li>
<li><p>SEARCH_FILTERS</p></li>
<li><p>DEFAULT_INDEX</p></li>
<li><p>UNASSIGNED_INDEX</p></li>
<li><p>USER_INDEX</p></li>
<li><p>ISSUE_FILTER</p></li>
</ul>
<p>The new security implementation will require additions to the dbinit module,
but also removes the need for the following tracker config variables:</p>
<ul class="simple">
<li><p>ANONYMOUS_ACCESS</p></li>
<li><p>ANONYMOUS_REGISTER</p></li>
</ul>
<p>but requires two new variables which define the Roles assigned to users who
register through the web and e-mail interfaces:</p>
<ul class="simple">
<li><p>NEW_WEB_USER_ROLES</p></li>
<li><p>NEW_EMAIL_USER_ROLES</p></li>
</ul>
<p>in both cases, ‘User’ is a good initial setting. To emulate
<code class="docutils literal notranslate"><span class="pre">ANONYMOUS_ACCESS='deny'</span></code>, remove all “View” Permissions from the
“Anonymous” Role. To emulate <code class="docutils literal notranslate"><span class="pre">ANONYMOUS_REGISTER='deny'</span></code>, remove the “Web
Registration” and/or the “Email Registration” Permission from the “Anonymous”
Role. See the section on customising security in the <a class="reference external" href="customizing.html">customisation
documentation</a> for more information.</p>
<p>Finally, the following config variables have been renamed to make more sense:</p>
<ul class="simple">
<li><p>INSTANCE_HOME -&gt; TRACKER_HOME</p></li>
<li><p>INSTANCE_NAME -&gt; TRACKER_NAME</p></li>
<li><p>ISSUE_TRACKER_WEB -&gt; TRACKER_WEB</p></li>
<li><p>ISSUE_TRACKER_EMAIL -&gt; TRACKER_EMAIL</p></li>
</ul>
</section>
<section id="schema-specification">
<h3><a class="toc-backref" href="#id79" role="doc-backlink">0.5.0 Schema Specification</a></h3>
<section id="database-backend-changes">
<h4><a class="toc-backref" href="#id80" role="doc-backlink">0.5.0 Database backend changes</a></h4>
<p>Your select_db module in your tracker has changed a fair bit. Where it used
to contain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># WARNING: DO NOT EDIT THIS FILE!!!</span>
<span class="kn">from</span> <span class="nn">roundup.backends.back_anydbm</span> <span class="kn">import</span> <span class="n">Database</span>
</pre></div>
</div>
<p>it must now contain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># WARNING: DO NOT EDIT THIS FILE!!!</span>
<span class="kn">from</span> <span class="nn">roundup.backends.back_anydbm</span> <span class="kn">import</span> <span class="n">Database</span><span class="p">,</span> <span class="n">Class</span><span class="p">,</span> <span class="n">FileClass</span><span class="p">,</span> <span class="n">IssueClass</span>
</pre></div>
</div>
<p>Yes, I realise the irony of the “DO NOT EDIT THIS FILE” statement :)
Note the addition of the Class, FileClass, IssueClass imports. These are very
important, as they’re going to make the next change work too. You now need to
modify the top of the dbinit module in your tracker from:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">instance_config</span>
<span class="kn">from</span> <span class="nn">roundup</span> <span class="kn">import</span> <span class="n">roundupdb</span>
<span class="kn">from</span> <span class="nn">select_db</span> <span class="kn">import</span> <span class="n">Database</span>

<span class="kn">from</span> <span class="nn">roundup.roundupdb</span> <span class="kn">import</span> <span class="n">Class</span><span class="p">,</span> <span class="n">FileClass</span>

<span class="k">class</span> <span class="nc">Database</span><span class="p">(</span><span class="n">roundupdb</span><span class="o">.</span><span class="n">Database</span><span class="p">,</span> <span class="n">select_db</span><span class="o">.</span><span class="n">Database</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Creates a hybrid database from:</span>
<span class="sd">         . the selected database back-end from select_db</span>
<span class="sd">         . the roundup extensions from roundupdb</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">IssueClass</span><span class="p">(</span><span class="n">roundupdb</span><span class="o">.</span><span class="n">IssueClass</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; issues need the email information</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">config</span>
<span class="kn">from</span> <span class="nn">select_db</span> <span class="kn">import</span> <span class="n">Database</span><span class="p">,</span> <span class="n">Class</span><span class="p">,</span> <span class="n">FileClass</span><span class="p">,</span> <span class="n">IssueClass</span>
</pre></div>
</div>
<p>Yes, remove the Database and IssueClass definitions and those other imports.
They’re not needed any more!</p>
<p>Look for places in dbinit.py where <code class="docutils literal notranslate"><span class="pre">instance_config</span></code> is used too, and
rename them <code class="docutils literal notranslate"><span class="pre">config</span></code>.</p>
</section>
<section id="journalling-changes">
<h4><a class="toc-backref" href="#id81" role="doc-backlink">0.5.0 Journalling changes</a></h4>
<p>Journalling has been optimised for storage. Journalling of links has been
turned back on by default. If your tracker has a large user base, you may wish
to turn off journalling of nosy list, message author and message recipient
link and unlink events. You do this by adding <code class="docutils literal notranslate"><span class="pre">do_journal='no'</span></code> to the Class
initialisation in your dbinit. For example, your <em>msg</em> class initialisation
probably looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">msg</span> <span class="o">=</span> <span class="n">FileClass</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">,</span>
                <span class="n">author</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">),</span> <span class="n">recipients</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">),</span>
                <span class="n">date</span><span class="o">=</span><span class="n">Date</span><span class="p">(),</span>         <span class="n">summary</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">files</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">),</span>
                <span class="n">messageid</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>  <span class="n">inreplyto</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
</pre></div>
</div>
<p>to turn off journalling of author and recipient link events, add
<code class="docutils literal notranslate"><span class="pre">do_journal='no'</span></code> to the <code class="docutils literal notranslate"><span class="pre">author=Link(&quot;user&quot;)</span></code> part of the statement,
like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">msg</span> <span class="o">=</span> <span class="n">FileClass</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">,</span>
                <span class="n">author</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">do_journal</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">),</span>
                <span class="n">recipients</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">do_journal</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">),</span>
                <span class="n">date</span><span class="o">=</span><span class="n">Date</span><span class="p">(),</span>         <span class="n">summary</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">files</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">),</span>
                <span class="n">messageid</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>  <span class="n">inreplyto</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
</pre></div>
</div>
<p>Nosy list link event journalling is actually turned off by default now. If you
want to turn it on, change to your issue class’ nosy list, change its
definition from:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">issue</span> <span class="o">=</span> <span class="n">IssueClass</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">&quot;issue&quot;</span><span class="p">,</span>
                <span class="n">assignedto</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">),</span> <span class="n">topic</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">&quot;keyword&quot;</span><span class="p">),</span>
                <span class="n">priority</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">&quot;priority&quot;</span><span class="p">),</span> <span class="n">status</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">issue</span> <span class="o">=</span> <span class="n">IssueClass</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">&quot;issue&quot;</span><span class="p">,</span> <span class="n">nosy</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">do_journal</span><span class="o">=</span><span class="s1">&#39;yes&#39;</span><span class="p">),</span>
                <span class="n">assignedto</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">),</span> <span class="n">topic</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">&quot;keyword&quot;</span><span class="p">),</span>
                <span class="n">priority</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">&quot;priority&quot;</span><span class="p">),</span> <span class="n">status</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>noting that your definition of the nosy Multilink will override the normal one.</p>
</section>
<section id="user-schema-changes">
<h4><a class="toc-backref" href="#id82" role="doc-backlink">0.5.0 User schema changes</a></h4>
<p>Users have two more properties, “queries” and “roles”. You’ll have something
like this in your dbinit module now:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                <span class="n">username</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>   <span class="n">password</span><span class="o">=</span><span class="n">Password</span><span class="p">(),</span>
                <span class="n">address</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>    <span class="n">realname</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">phone</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>      <span class="n">organisation</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">alternate_addresses</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
<span class="n">user</span><span class="o">.</span><span class="n">setkey</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>and you’ll need to add the new properties and the new “query” class to it
like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">&quot;query&quot;</span><span class="p">,</span>
                <span class="n">klass</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>     <span class="n">name</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">url</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
<span class="n">query</span><span class="o">.</span><span class="n">setkey</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>

<span class="c1"># Note: roles is a comma-separated string of Role names</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                <span class="n">username</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>   <span class="n">password</span><span class="o">=</span><span class="n">Password</span><span class="p">(),</span>
                <span class="n">address</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>    <span class="n">realname</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">phone</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>      <span class="n">organisation</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">alternate_addresses</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">queries</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s1">&#39;query&#39;</span><span class="p">),</span> <span class="n">roles</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
<span class="n">user</span><span class="o">.</span><span class="n">setkey</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The “queries” property is used to store off the user’s favourite database
queries. The “roles” property is explained below in <a class="reference internal" href="#security-settings">0.5.0 Security
Settings</a>.</p>
</section>
<section id="security-settings">
<h4><a class="toc-backref" href="#id83" role="doc-backlink">0.5.0 Security Settings</a></h4>
<p>See the <a class="reference external" href="security-history.html">security documentation</a> for an explanation of how the new security
system works. In a nutshell though, the security is handled as a four step
process:</p>
<ol class="arabic simple">
<li><p>Permissions are defined as having a name and optionally a hyperdb class
they’re specific to,</p></li>
<li><p>Roles are defined that have one or more Permissions,</p></li>
<li><p>Users are assigned Roles in their “roles” property, and finally</p></li>
<li><p>Roundup checks that users have appropriate Permissions at appropriate times
(like editing issues).</p></li>
</ol>
<p>Your tracker dbinit module’s <em>open</em> function now has to define any
Permissions that are specific to your tracker, and also the assignment
of Permissions to Roles. At the moment, your open function
ends with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">detectors</span>
<span class="n">detectors</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

<span class="k">return</span> <span class="n">db</span>
</pre></div>
</div>
<p>and what we need to do is insert some commands that will set up the security
parameters. Right above the <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">detectors</span></code> line, you’ll want to insert
these lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># SECURITY SETTINGS</span>
<span class="c1">#</span>
<span class="c1"># new permissions for this schema</span>
<span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="s1">&#39;issue&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">:</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Edit&quot;</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="n">cl</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;User is allowed to edit &quot;</span><span class="o">+</span><span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;View&quot;</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="n">cl</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;User is allowed to access &quot;</span><span class="o">+</span><span class="n">cl</span><span class="p">)</span>

<span class="c1"># Assign the access and edit permissions for issue, file and message</span>
<span class="c1"># to regular users now</span>
<span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="s1">&#39;issue&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;msg&#39;</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">&#39;View&#39;</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">&#39;Edit&#39;</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="c1"># and give the regular users access to the web and email interface</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">&#39;Web Access&#39;</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">&#39;Email Access&#39;</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

<span class="c1"># May users view other user information? Comment these lines out</span>
<span class="c1"># if you don&#39;t want them to</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">&#39;View&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

<span class="c1"># Assign the appropriate permissions to the anonymous user&#39;s Anonymous</span>
<span class="c1"># Role. Choices here are:</span>
<span class="c1"># - Allow anonymous users to register through the web</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">&#39;Web Registration&#39;</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;Anonymous&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="c1"># - Allow anonymous (new) users to register through the email gateway</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">&#39;Email Registration&#39;</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;Anonymous&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="c1"># - Allow anonymous users access to the &quot;issue&quot; class of data</span>
<span class="c1">#   Note: this also grants access to related information like files,</span>
<span class="c1">#         messages, statuses etc that are linked to issues</span>
<span class="c1">#p = db.security.getPermission(&#39;View&#39;, &#39;issue&#39;)</span>
<span class="c1">#db.security.addPermissionToRole(&#39;Anonymous&#39;, p)</span>
<span class="c1"># - Allow anonymous users access to edit the &quot;issue&quot; class of data</span>
<span class="c1">#   Note: this also grants access to create related information like</span>
<span class="c1">#         files and messages etc that are linked to issues</span>
<span class="c1">#p = db.security.getPermission(&#39;Edit&#39;, &#39;issue&#39;)</span>
<span class="c1">#db.security.addPermissionToRole(&#39;Anonymous&#39;, p)</span>

<span class="c1"># oh, g&#39;wan, let anonymous access the web interface too</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">getPermission</span><span class="p">(</span><span class="s1">&#39;Web Access&#39;</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;Anonymous&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>Note in the comments there the places where you might change the permissions
to restrict users or grant users more access. If you’ve created additional
classes that users should be able to edit and view, then you should add them
to the “new permissions for this schema” section at the start of the security
block. Then add them to the “Assign the access and edit permissions” section
too, so people actually have the new Permission you’ve created.</p>
<p>One final change is needed that finishes off the security system’s
initialisation. We need to add a call to <code class="docutils literal notranslate"><span class="pre">db.post_init()</span></code> at the end of the
dbinit open() function. Add it like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">detectors</span>
<span class="n">detectors</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

<span class="c1"># schema is set up - run any post-initialisation</span>
<span class="n">db</span><span class="o">.</span><span class="n">post_init</span><span class="p">()</span>
<span class="k">return</span> <span class="n">db</span>
</pre></div>
</div>
<p>You may verify the setup of Permissions and Roles using the new
“<code class="docutils literal notranslate"><span class="pre">roundup-admin</span> <span class="pre">security</span></code>” command.</p>
</section>
<section id="user-changes">
<h4><a class="toc-backref" href="#id84" role="doc-backlink">0.5.0 User changes</a></h4>
<p>To support all those schema changes, you’ll need to massage your user database
a little too, to:</p>
<ol class="arabic simple">
<li><p>make sure there’s an “anonymous” user - this user is mandatory now and is
the one that unknown users are logged in as.</p></li>
<li><p>make sure all users have at least one Role.</p></li>
</ol>
<p>If you don’t have the “anonymous” user, create it now with the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">roundup</span><span class="o">-</span><span class="n">admin</span> <span class="n">create</span> <span class="n">user</span> <span class="n">username</span><span class="o">=</span><span class="n">anonymous</span> <span class="n">roles</span><span class="o">=</span><span class="n">Anonymous</span>
</pre></div>
</div>
<p>making sure the capitalisation is the same as above. Once you’ve done that,
you’ll need to set the roles property on all users to a reasonable default.
The admin user should get “Admin”, the anonymous user “Anonymous”
and all other users “User”. The <code class="docutils literal notranslate"><span class="pre">fixroles.py</span></code> script in the tools directory
will do this. Run it like so (where python is your python 2+ binary):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">tools</span><span class="o">/</span><span class="n">fixroles</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">tracker</span> <span class="n">home</span><span class="o">&gt;</span> <span class="n">fixroles</span>
</pre></div>
</div>
</section>
</section>
<section id="cgi-interface-changes">
<h3><a class="toc-backref" href="#id85" role="doc-backlink">0.5.0 CGI interface changes</a></h3>
<p>The CGI interface code was completely reorganised and largely rewritten. The
end result is that this section of your tracker interfaces module will need
changing from:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">roundup</span> <span class="kn">import</span> <span class="n">cgi_client</span><span class="p">,</span> <span class="n">mailgw</span>
<span class="kn">from</span> <span class="nn">roundup.i18n</span> <span class="kn">import</span> <span class="n">_</span>

<span class="k">class</span> <span class="nc">Client</span><span class="p">(</span><span class="n">cgi_client</span><span class="o">.</span><span class="n">Client</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; derives basic CGI implementation from the standard module,</span>
<span class="sd">        with any specific extensions</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">roundup</span> <span class="kn">import</span> <span class="n">mailgw</span>
<span class="kn">from</span> <span class="nn">roundup.cgi</span> <span class="kn">import</span> <span class="n">client</span>

<span class="k">class</span> <span class="nc">Client</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">Client</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; derives basic CGI implementation from the standard module,</span>
<span class="sd">        with any specific extensions</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>You will also need to install the new version of roundup.cgi from the source
cgi-bin directory if you’re using it.</p>
</section>
<section id="html-templating">
<h3><a class="toc-backref" href="#id86" role="doc-backlink">0.5.0 HTML templating</a></h3>
<p>You’ll want to make a backup of your current tracker html directory. You
should then copy the html directory from the Roundup source “classic” template
and modify it according to your local schema changes.</p>
<p>If you need help with the new templating system, please ask questions on the
roundup-users mailing list (available through the roundup web page on
sourceforge, <a class="reference external" href="https://www.roundup-tracker.org/">https://www.roundup-tracker.org/</a>.</p>
</section>
<section id="detectors">
<h3><a class="toc-backref" href="#id87" role="doc-backlink">0.5.0 Detectors</a></h3>
<p>The nosy reactor has been updated to handle the tracker not having an
“assignedto” property on issues. You may want to copy it into your tracker’s
detectors directory. Chances are you’ve already fixed it though :)</p>
</section>
</section>
<section id="migrating-from-0-4-1-to-0-4-2">
<h2><a class="toc-backref" href="#id88" role="doc-backlink">Migrating from 0.4.1 to 0.4.2</a></h2>
<section id="id8">
<h3><a class="toc-backref" href="#id89" role="doc-backlink">0.4.2 Configuration</a></h3>
<p>The USER_INDEX definition introduced in 0.4.1 was too restrictive in its
allowing replacement of ‘assignedto’ with the user’s userid. Users must change
the None value of ‘assignedto’ to ‘CURRENT USER’ (the string, in quotes) for
the replacement behaviour to occur now.</p>
<p>The new configuration variables are:</p>
<ul class="simple">
<li><p>EMAIL_KEEP_QUOTED_TEXT</p></li>
<li><p>EMAIL_LEAVE_BODY_UNCHANGED</p></li>
<li><p>ADD_RECIPIENTS_TO_NOSY</p></li>
</ul>
<p>See the sample configuration files in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">classic</span><span class="o">/</span><span class="n">instance_config</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>and:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">extended</span><span class="o">/</span><span class="n">instance_config</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>and the <a class="reference external" href="customizing.html">customisation documentation</a> for information on how they’re used.</p>
</section>
<section id="changes-to-detectors">
<h3><a class="toc-backref" href="#id90" role="doc-backlink">0.4.2 Changes to detectors</a></h3>
<p>You will need to copy the detectors from the distribution into your instance
home “detectors” directory. If you used the classic schema, the detectors
are in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">classic</span><span class="o">/</span><span class="n">detectors</span><span class="o">/</span>
</pre></div>
</div>
<p>If you used the extended schema, the detectors are in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">extended</span><span class="o">/</span><span class="n">detectors</span><span class="o">/</span>
</pre></div>
</div>
<p>The change means that schema-specific code has been removed from the
mail gateway and cgi interface and made into auditors:</p>
<ul class="simple">
<li><p>nosyreactor.py has now got an updatenosy auditor which updates the nosy
list with author, recipient and assignedto information.</p></li>
<li><p>statusauditor.py makes the unread or resolved -&gt; chatting changes and
presets the status of an issue to unread.</p></li>
</ul>
<p>There’s also a bug or two fixed in the nosyreactor code.</p>
</section>
<section id="html-templating-changes">
<h3><a class="toc-backref" href="#id91" role="doc-backlink">0.4.2 HTML templating changes</a></h3>
<p>The link() htmltemplate function now has a “showid” option for links and
multilinks. When true, it only displays the linked item id as the anchor
text. The link value is displayed as a tooltip using the title anchor
attribute. To use in eg. the superseder field, have something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">display</span> <span class="n">call</span><span class="o">=</span><span class="s2">&quot;field(&#39;superseder&#39;, showid=1)&quot;</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">display</span> <span class="n">call</span><span class="o">=</span><span class="s2">&quot;classhelp(&#39;issue&#39;, &#39;id,title&#39;, label=&#39;list&#39;, width=500)&quot;</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="nb">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;superseder&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span><span class="n">View</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">display</span> <span class="n">call</span><span class="o">=</span><span class="s2">&quot;link(&#39;superseder&#39;, showid=1)&quot;</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="nb">property</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The stylesheets have been cleaned up too. You may want to use the newer
versions in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/&lt;</span><span class="n">template</span><span class="o">&gt;/</span><span class="n">html</span><span class="o">/</span><span class="n">default</span><span class="o">.</span><span class="n">css</span>
</pre></div>
</div>
</section>
</section>
<section id="migrating-from-0-4-0-to-0-4-1">
<h2><a class="toc-backref" href="#id92" role="doc-backlink">Migrating from 0.4.0 to 0.4.1</a></h2>
<section id="files-storage">
<h3><a class="toc-backref" href="#id93" role="doc-backlink">0.4.1 Files storage</a></h3>
<p>Messages and files from newly created issues will be put into subdierectories
in thousands e.g. msg123 will be put into files/msg/0/msg123, file2003
will go into files/file/2/file2003. Previous messages are still found, but
could be put into this structure.</p>
</section>
<section id="id9">
<h3><a class="toc-backref" href="#id94" role="doc-backlink">0.4.1 Configuration</a></h3>
<p>To allow more fine-grained access control, the variable used to check
permission to auto-register users in the mail gateway is now called
ANONYMOUS_REGISTER_MAIL rather than overloading ANONYMOUS_REGISTER. If the
variable doesn’t exist, then ANONYMOUS_REGISTER is tested as before.</p>
<p>Configuring the links in the web header is now easier too. The following
variables have been added to the classic instance_config.py:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">HEADER_INDEX_LINKS</span>   <span class="o">-</span> <span class="n">defines</span> <span class="n">the</span> <span class="s2">&quot;index&quot;</span> <span class="n">links</span> <span class="n">to</span> <span class="n">be</span> <span class="n">made</span> <span class="n">available</span>
<span class="n">HEADER_ADD_LINKS</span>     <span class="o">-</span> <span class="n">defines</span> <span class="n">the</span> <span class="s2">&quot;add&quot;</span> <span class="n">links</span>
<span class="n">DEFAULT_INDEX</span>        <span class="o">-</span> <span class="n">specifies</span> <span class="n">the</span> <span class="n">index</span> <span class="n">view</span> <span class="k">for</span> <span class="n">DEFAULT</span>
<span class="n">UNASSIGNED_INDEX</span>     <span class="o">-</span> <span class="n">specifies</span> <span class="n">the</span> <span class="n">index</span> <span class="n">view</span> <span class="k">for</span> <span class="n">UNASSIGNED</span>
<span class="n">USER_INDEX</span>           <span class="o">-</span> <span class="n">specifies</span> <span class="n">the</span> <span class="n">index</span> <span class="n">view</span> <span class="k">for</span> <span class="n">USER</span>
</pre></div>
</div>
<p>See the &lt;roundup source&gt;/roundup/templates/classic/instance_config.py for more
information - including how the variables are to be set up. Most users will
just be able to copy the variables from the source to their instance home. If
you’ve modified the header by changing the source of the interfaces.py file in
the instance home, you’ll need to remove that customisation and move it into
the appropriate variables in instance_config.py.</p>
<p>The extended schema has similar variables added too - see the source for more
info.</p>
</section>
<section id="alternate-e-mail-addresses">
<h3><a class="toc-backref" href="#id95" role="doc-backlink">0.4.1 Alternate E-Mail Addresses</a></h3>
<p>If you add the property “alternate_addresses” to your user class, your users
will be able to register alternate email addresses that they may use to
communicate with roundup as. All email from roundup will continue to be sent
to their primary address.</p>
<p>If you have not edited the dbinit.py file in your instance home directory,
you may simply copy the new dbinit.py file from the core code. If you used
the classic schema, the interfaces file is in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">classic</span><span class="o">/</span><span class="n">dbinit</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>If you used the extended schema, the file is in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">extended</span><span class="o">/</span><span class="n">dbinit</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>If you have modified your dbinit.py file, you need to edit the dbinit.py
file in your instance home directory. Find the lines which define the user
class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">,</span>
                <span class="n">username</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>   <span class="n">password</span><span class="o">=</span><span class="n">Password</span><span class="p">(),</span>
                <span class="n">address</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>    <span class="n">realname</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">phone</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>      <span class="n">organisation</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">alternate_addresses</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
</pre></div>
</div>
<p>You will also want to add the property to the user’s details page. The
template for this is the “user.item” file in your instance home “html”
directory. Similar to above, you may copy the file from the roundup source if
you haven’t modified it. Otherwise, add the following to the template:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">display</span> <span class="n">call</span><span class="o">=</span><span class="s2">&quot;multiline(&#39;alternate_addresses&#39;)&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>with appropriate labelling etc. See the standard template for an idea.</p>
</section>
</section>
<section id="migrating-from-0-3-x-to-0-4-0">
<h2><a class="toc-backref" href="#id96" role="doc-backlink">Migrating from 0.3.x to 0.4.0</a></h2>
<section id="message-id-and-in-reply-to-addition">
<h3><a class="toc-backref" href="#id97" role="doc-backlink">0.4.0 Message-ID and In-Reply-To addition</a></h3>
<p>0.4.0 adds the tracking of messages by message-id and allows threading
using in-reply-to. Most e-mail clients support threading using this
feature, and we hope to add support for it to the web gateway. If you
have not edited the dbinit.py file in your instance home directory, you may
simply copy the new dbinit.py file from the core code. If you used the
classic schema, the interfaces file is in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">classic</span><span class="o">/</span><span class="n">dbinit</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>If you used the extended schema, the file is in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">extended</span><span class="o">/</span><span class="n">dbinit</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>If you have modified your dbinit.py file, you need to edit the dbinit.py
file in your instance home directory. Find the lines which define the msg
class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">msg</span> <span class="o">=</span> <span class="n">FileClass</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">,</span>
                <span class="n">author</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">),</span> <span class="n">recipients</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">),</span>
                <span class="n">date</span><span class="o">=</span><span class="n">Date</span><span class="p">(),</span>         <span class="n">summary</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">files</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>and add the messageid and inreplyto properties like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">msg</span> <span class="o">=</span> <span class="n">FileClass</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">,</span>
                <span class="n">author</span><span class="o">=</span><span class="n">Link</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">),</span> <span class="n">recipients</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">),</span>
                <span class="n">date</span><span class="o">=</span><span class="n">Date</span><span class="p">(),</span>         <span class="n">summary</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">files</span><span class="o">=</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">),</span>
                <span class="n">messageid</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>  <span class="n">inreplyto</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
</pre></div>
</div>
<p>Also, configuration is being cleaned up. This means that your dbinit.py will
also need to be changed in the open function. If you haven’t changed your
dbinit.py, the above copy will be enough. If you have, you’ll need to change
the line (round line 50):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">db</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span><span class="n">instance_config</span><span class="o">.</span><span class="n">DATABASE</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">db</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span><span class="n">instance_config</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id10">
<h3><a class="toc-backref" href="#id98" role="doc-backlink">0.4.0 Configuration</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">TRACKER_NAME</span></code> and <code class="docutils literal notranslate"><span class="pre">EMAIL_SIGNATURE_POSITION</span></code> have been added to the
instance_config.py. The simplest solution is to copy the default values
from template in the core source.</p>
<p>The mail gateway now checks <code class="docutils literal notranslate"><span class="pre">ANONYMOUS_REGISTER</span></code> to see if unknown users
are to be automatically registered with the tracker. If it is set to “deny”
then unknown users will not have access. If it is set to “allow” they will be
automatically registered with the tracker.</p>
</section>
<section id="cgi-script-roundup-cgi">
<h3><a class="toc-backref" href="#id99" role="doc-backlink">0.4.0 CGI script roundup.cgi</a></h3>
<p>The CGI script has been updated with some features and a bugfix, so you should
copy it from the roundup cgi-bin source directory again. Make sure you update
the ROUNDUP_INSTANCE_HOMES after the copy.</p>
</section>
<section id="nosy-reactor">
<h3><a class="toc-backref" href="#id100" role="doc-backlink">0.4.0 Nosy reactor</a></h3>
<p>The nosy reactor has also changed - copy the nosyreactor.py file from the core
source:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/&lt;</span><span class="n">template</span><span class="o">&gt;/</span><span class="n">detectors</span><span class="o">/</span><span class="n">nosyreactor</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>to your instance home “detectors” directory.</p>
</section>
<section id="id11">
<h3><a class="toc-backref" href="#id101" role="doc-backlink">0.4.0 HTML templating</a></h3>
<p>The field() function was incorrectly implemented - links and multilinks now
display as text fields when rendered using field(). To display a menu (drop-
down or select box) you need to use the menu() function.</p>
</section>
</section>
<section id="migrating-from-0-2-x-to-0-3-x">
<h2><a class="toc-backref" href="#id102" role="doc-backlink">Migrating from 0.2.x to 0.3.x</a></h2>
<section id="x-cookie-authentication-changes">
<h3><a class="toc-backref" href="#id103" role="doc-backlink">0.3.x Cookie Authentication changes</a></h3>
<p>0.3.0 introduces cookie authentication - you will need to copy the
interfaces.py file from the roundup source to your instance home to enable
authentication. If you used the classic schema, the interfaces file is in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">classic</span><span class="o">/</span><span class="n">interfaces</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>If you used the extended schema, the file is in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">extended</span><span class="o">/</span><span class="n">interfaces</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>If you have modified your interfaces.Client class, you will need to take
note of the login/logout functionality provided in roundup.cgi_client.Client
(classic schema) or roundup.cgi_client.ExtendedClient (extended schema) and
modify your instance code apropriately.</p>
</section>
<section id="x-password-encoding">
<h3><a class="toc-backref" href="#id104" role="doc-backlink">0.3.x Password encoding</a></h3>
<p>This release also introduces encoding of passwords in the database. If you
have not edited the dbinit.py file in your instance home directory, you may
simply copy the new dbinit.py file from the core code. If you used the
classic schema, the interfaces file is in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">classic</span><span class="o">/</span><span class="n">dbinit</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>If you used the extended schema, the file is in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">roundup</span> <span class="n">source</span><span class="o">&gt;/</span><span class="n">roundup</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">extended</span><span class="o">/</span><span class="n">dbinit</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>If you have modified your dbinit.py file, you may use encoded passwords:</p>
<ol class="arabic">
<li><p>Edit the dbinit.py file in your instance home directory
a. At the first code line of the open() function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="kn">from</span> <span class="nn">roundup.hyperdb</span> <span class="kn">import</span> <span class="n">String</span><span class="p">,</span> <span class="n">Date</span><span class="p">,</span> <span class="n">Link</span><span class="p">,</span> <span class="n">Multilink</span>

<span class="n">alter</span> <span class="n">to</span> <span class="n">include</span> <span class="n">Password</span><span class="p">,</span> <span class="k">as</span> <span class="n">so</span><span class="p">::</span>

 <span class="kn">from</span> <span class="nn">roundup.hyperdb</span> <span class="kn">import</span> <span class="n">String</span><span class="p">,</span> <span class="n">Password</span><span class="p">,</span> <span class="n">Date</span><span class="p">,</span> <span class="n">Link</span><span class="p">,</span> <span class="n">Multilink</span>
</pre></div>
</div>
<ol class="loweralpha" start="2">
<li><p>Where the password property is defined (around line 66):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                <span class="n">username</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>   <span class="n">password</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">address</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>    <span class="n">realname</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">phone</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>      <span class="n">organisation</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
<span class="n">user</span><span class="o">.</span><span class="n">setkey</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>alter the “password=String()” to “password=Password()”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                <span class="n">username</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>   <span class="n">password</span><span class="o">=</span><span class="n">Password</span><span class="p">(),</span>
                <span class="n">address</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>    <span class="n">realname</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>
                <span class="n">phone</span><span class="o">=</span><span class="n">String</span><span class="p">(),</span>      <span class="n">organisation</span><span class="o">=</span><span class="n">String</span><span class="p">())</span>
<span class="n">user</span><span class="o">.</span><span class="n">setkey</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</li>
<li><p>Any existing passwords in the database will remain cleartext until they
are edited. It is recommended that at a minimum the admin password be
changed immediately:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">roundup</span><span class="o">-</span><span class="n">admin</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">instance</span> <span class="n">home</span><span class="o">&gt;</span> <span class="nb">set</span> <span class="n">user1</span> <span class="n">password</span><span class="o">=&lt;</span><span class="n">new</span> <span class="n">password</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="x-configuration">
<h3><a class="toc-backref" href="#id105" role="doc-backlink">0.3.x Configuration</a></h3>
<p>FILTER_POSITION, ANONYMOUS_ACCESS, ANONYMOUS_REGISTER have been added to
the instance_config.py. Simplest solution is to copy the default values from
template in the core source.</p>
<p>MESSAGES_TO_AUTHOR has been added to the IssueClass in dbinit.py. Set to ‘yes’
to send nosy messages to the author. Default behaviour is to not send nosy
messages to the author. You will need to add MESSAGES_TO_AUTHOR to your
dbinit.py in your instance home.</p>
</section>
<section id="x-cgi-script-roundup-cgi">
<h3><a class="toc-backref" href="#id106" role="doc-backlink">0.3.x CGI script roundup.cgi</a></h3>
<p>There have been some structural changes to the roundup.cgi script - you will
need to install it again from the cgi-bin directory of the source
distribution. Make sure you update the ROUNDUP_INSTANCE_HOMES after the
copy.</p>
</section>
</section>
</section>


       
    <div class="related related-bottom">
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="tracker_templates.html" title="Roundup Tracker Templates"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="acknowledgements.html" title="Acknowledgements"
             accesskey="P">previous</a></li>
        <li><a href="index.html">Roundup 2.5.0 documentation</a></li> 
      </ul>
    </div>
    </main>
    <div class="footer">
        &copy; Copyright 2009-2025, Richard Jones, Roundup-Team.
    </div>
  </body>
</html>